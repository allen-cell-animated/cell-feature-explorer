(self.webpackChunkcell_feature_explorer=self.webpackChunkcell_feature_explorer||[]).push([[283,524],{6580:()=>{},28625:()=>{},42634:()=>{},46987:(e,t,n)=>{"use strict";var r={};n.r(r),n.d(r,{clearDatasetValues:()=>Te,receiveAlbumData:()=>Ue,receiveAvailableDatasets:()=>Fe,receiveDataForPlot:()=>Be,receiveFileInfoData:()=>Ne,receiveMeasuredFeatureDefs:()=>Me,receiveViewerChannelSettings:()=>Ge,requestAlbumData:()=>Ve,requestAvailableDatasets:()=>Ie,requestCellFileInfoData:()=>je,requestFeatureData:()=>Re,requestViewerChannelSettings:()=>ze,setLoadingText:()=>He,setShowSmallScreenWarning:()=>Ke,stopLoading:()=>Le});var a={};n.r(a),n.d(a,{getAllAlbumData:()=>Je,getCategoricalFeatureKeys:()=>dt,getDatasets:()=>lt,getFileInfo:()=>at,getIsLoading:()=>$e,getLabelsPerCell:()=>st,getLoadingText:()=>et,getMeasuredFeatureArrays:()=>ct,getMeasuredFeaturesDefs:()=>rt,getMeasuredFeaturesKeys:()=>ut,getMegasets:()=>nt,getMegasetsByNewest:()=>it,getMitoticKeyPerCell:()=>pt,getMitoticStageNames:()=>ft,getPerCellDataForPlot:()=>Qe,getShowSmallScreenWarning:()=>tt,getViewerChannelSettings:()=>ot});var o={};n.r(o),n.d(o,{getImageDataset:()=>ht});var l={};n.r(l),n.d(l,{changeAxis:()=>Kt,changeDataset:()=>sn,changeDownloadSettings:()=>nn,changeGroupByCategory:()=>Wt,changeHoveredPoint:()=>an,changeMousePosition:()=>rn,clearAllSelectedPoints:()=>Qt,clearDataset:()=>un,deselectGroupOfPoints:()=>Xt,deselectPoint:()=>Yt,lassoOrBoxSelectGroup:()=>qt,receiveFileInfoDataForCell:()=>fn,requestCellFileInfoByArrayOfCellIds:()=>hn,requestCellFileInfoByCellId:()=>pn,selectAlbum:()=>ln,selectCellFor3DViewer:()=>$t,selectPoint:()=>Zt,setAlignActive:()=>mn,setCsvUrl:()=>dn,setHoveredGalleryCard:()=>on,syncStateWithURL:()=>en,toggleApplySelectionSetColors:()=>tn,toggleFilterByCategoryName:()=>Jt,toggleGallery:()=>cn});var i={};n.r(i),n.d(i,{getAlignActive:()=>zn,getApplyColorToSelections:()=>On,getCategoryGroupColorsAndNames:()=>qn,getClickedCellsFileInfo:()=>wn,getClickedScatterPoints:()=>ir,getColorByCategoryCounts:()=>$n,getColorBySelection:()=>En,getCsvUrl:()=>Ln,getDefaultColors:()=>Sn,getDownloadConfig:()=>_n,getDownloadRoot:()=>Vn,getFeatureDefTooltip:()=>Xn,getFilteredCellData:()=>er,getFilteredColorByValues:()=>lr,getFilteredIds:()=>or,getFilteredMeasuredValues:()=>tr,getFilteredPerCellLabels:()=>nr,getFilteredXValues:()=>rr,getFilteredYValues:()=>ar,getFiltersToExclude:()=>kn,getGalleryCollapsed:()=>Nn,getGroupByCategory:()=>An,getGroupByFeatureDef:()=>Hn,getGroupByFeatureOptionsAsList:()=>Kn,getGroupingCategoryNames:()=>Wn,getGroupingCategoryNamesAsArray:()=>Yn,getHoveredCardId:()=>Fn,getHoveredPointData:()=>In,getMeasuredValues:()=>Zn,getMousePosition:()=>xn,getPlotByOnX:()=>vn,getPlotByOnY:()=>bn,getSelected3DCell:()=>Pn,getSelected3DCellFOV:()=>sr,getSelected3DCellFeatureData:()=>dr,getSelected3DCellFileInfo:()=>cr,getSelected3DCellHasTransform:()=>ur,getSelectedAlbum:()=>Tn,getSelectedAlbumFileInfo:()=>Rn,getSelectedDataset:()=>Bn,getSelectedDatasetName:()=>Gn,getSelectedGroupKeys:()=>pr,getSelectedGroups:()=>Cn,getSelectedGroupsData:()=>fr,getSelectedIdsFromUrl:()=>jn,getSelectedSetTotals:()=>hr,getSelectionSetColors:()=>Dn,getThumbnailRoot:()=>Mn,getVolumeViewerDataRoot:()=>Un,getXValues:()=>Qn,getYValues:()=>Jn});var c={};n.r(c);var s={};n.r(s);var u={};n.r(u),n.d(u,{changeImageDatasetType:()=>Xr,loadCsvDataset:()=>Yr});var d={};n.r(d);var f=n(64467),p=n(23029),h=n(92901),m=(n(22913),n(51298),n(10743),n(30502)),y=n(55373),g=n(96540),v=n(5338),b=n(71468);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var C="cell-feature-explorer",E="plotByOnX",S="plotByOnY",D="cellIds",k="features-scatter-plot",P="colorBy",O="groupBy",_="CellId",x="FOVId",I="fovThumbnailPath",F="fovVolumeviewerPath",T="thumbnailPath",N="volumeviewerPath",B=(Object.freeze([_,x,O,T,N,I,F]),"protein"),M="selectionSet",j="interphase-and-mitotic-stages",R="#6e6e6e",V={backgroundColor:"rgba(0,0,0,0)",cellName:_,chartParent:"ace-scatter-chart",circleRadius:4,histogramColor:"rgb(164,162,164)",legend:{font:{color:"rgb(255,255,255)"},orientation:"h",y:60},margin:{b:50,l:60,r:40,t:10},moveDropdownCutoffWidth:370,heightMargin:270,showLegendCutoffHeight:635,showLegendCutoffWidth:692,textColor:"rgb(255,255,255)",unselectedCircleOpacity:.5},U="Direct download is not available for this dataset.",z={purple:"#8950d9",darkGray:"#313131",mediumDarkGray:"#4b4b4b",mediumGray:"#6e6e6e",lightGray:"#a0a0a0",extraLightGray:"#d8d8d8",brightGreen:"#b2d030",brightBlue:"#00a0ff",white:"#ffffff"},G=w(w({},z),{},{headerGray:z.mediumDarkGray,collapseHeaderGray:"#464646",collapseContentGray:z.darkGray,galleryBackground:z.mediumDarkGray+"d1",linkHover:z.brightBlue}),L=n(56822),H=n(53954),K=n(85501),W=n(6406),q=n(5131),X=n(20867),Y=n(46942),Z=n.n(Y),Q=n(47152),J=n(93567);const $=n.p+"5ddc2961aa2dc5a828bc.png";var ee=g.createElement(J.A,{style:{fontSize:40},spin:!0}),te=g.createElement("img",{src:$,style:{width:"140px"},alt:"Allen Institute for Cell Science"});function ne(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ne=function(){return!!e})()}const re=function(e){function t(){return(0,p.A)(this,t),e=this,n=t,r=arguments,n=(0,H.A)(n),(0,L.A)(e,ne()?Reflect.construct(n,r||[],(0,H.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,K.A)(t,e),(0,h.A)(t,[{key:"render",value:function(){var e=this.props.selectedDataset;return g.createElement("div",{className:"style__page-header--b9ZaQ"},g.createElement(Q.A,{align:"middle"},g.createElement("a",{href:"https://allencell.org",title:"Allen Institute for Cell Science",style:{height:"41px"}},te),g.createElement("span",{className:"style__vertical-bar--gcXcn"},"|"),g.createElement("a",{href:"/",className:"style__cfe-home--DZcrh"},"Cell Feature Explorer")),g.createElement("div",{className:"style__viewer-title--j_YyS"},e),g.createElement("div",{className:"style__buttons--Ow6C4"}))}}])}(g.Component);var ae=n(2543),oe=/^https?:\/\//;function le(e,t){return"".concat(C,"/").concat(e.toUpperCase(),"/").concat(t.toUpperCase())}function ie(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=arguments.length>1?arguments[1]:void 0,a=e[r.type];return a&&a.accepts(r)?a.perform(n,r):n}}var ce=le("batch","batch-actions");function se(e){return{type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce,batch:!0,payload:e}}function ue(e){return isNaN(Number(e))?e:"F".concat(e)}function de(e){return isNaN(Number(e))?e:"C".concat(e)}function fe(e,t){return""===e?"":"".concat(e,"&id=").concat(t)}function pe(e,t){return oe.test(t)?t:e&&t?"".concat(e,"/").concat(t):""}function he(e,t){return(0,ae.find)(e,{key:t})}function me(e,t){if(!t)return"";if(!e.options)return""+t;var n=e.options[t];return n.key||n.name}var ye=le("metadata","receive"),ge=le("metadata","request"),ve=le("metadata","request-album-data"),be=le("metadata","receive-album-data"),Ae=le("metadata","set-is-loading"),we=le("metadata","set-loading-text"),Ce=le("metadata","set-show-small-screen-warning"),Ee=le("metadata","RECEIVE_AVAILABLE_DATASETS"),Se=le("metadata","REQUEST_AVAILABLE_DATASETS"),De=le("metadata","receive-measured-feature-names"),ke=le("metadata","request-cell-file-info"),Pe=le("metadata","receive-cell-file-info"),Oe=le("metadata","CLEAR_DATASET_VALUES"),_e=le("metadata","request-viewer-channel-settings"),xe=le("metadata","receive-viewer-channel-settings");function Ie(){return{type:Se}}function Fe(e){return{payload:e,type:Ee}}function Te(){return{type:Oe}}function Ne(e){return{payload:e,type:Pe}}function Be(e){return{payload:e,type:ye}}function Me(e){return{payload:e,type:De}}function je(){return{type:ke}}function Re(){return{type:ge}}function Ve(){return{type:ve}}function Ue(e){return{payload:e,type:be}}function ze(){return{type:_e}}function Ge(e){return{payload:e,type:xe}}function Le(){return{payload:!1,type:Ae}}function He(e){return{payload:e,type:we}}function Ke(e){return{payload:e,type:Ce}}var We=n(10467),qe=n(54756),Xe=n.n(qe),Ye=n(14534),Ze=n(97132),Qe=function(e){return e.metadata.featureData},Je=function(e){return e.metadata.albums},$e=function(e){return e.metadata.isLoading},et=function(e){return e.metadata.loadingText},tt=function(e){return e.metadata.showSmallScreenWarning},nt=function(e){return e.metadata.megasets},rt=function(e){return e.metadata.measuredFeaturesDefs},at=function(e){return e.metadata.cellFileInfo},ot=function(e){return e.metadata.viewerChannelSettings},lt=(0,Ze.Mz)([nt],function(e){var t=[];return e.forEach(function(e){(0,ae.forEach)(e.datasets,function(e){t.push(e)})}),t}),it=(0,Ze.Mz)([nt],function(e){return e.sort(function(e,t){return t.dateCreated.seconds-e.dateCreated.seconds})}),ct=(0,Ze.Mz)([Qe],function(e){return e.values}),st=(0,Ze.Mz)([Qe],function(e){return e.labels}),ut=(0,Ze.Mz)([rt],function(e){return(0,ae.map)(e,"key")}),dt=(0,Ze.Mz)([rt],function(e){return(0,ae.map)((0,ae.filter)(e,"discrete"),"key")}),ft=(0,Ze.Mz)([rt],function(e){var t=he(e,j);return t&&t.discrete?t.options:{}}),pt=(0,Ze.Mz)([ct],function(e){return e[j]||[]}),ht=function(e){return e.imageDataset.imageDataset},mt=function(e){return le("selection",e)},yt=mt("deselect-file"),gt=mt("change-group-by-category"),vt=mt("select_group"),bt=mt("deselect-point"),At=mt("select-point"),wt=mt("deselect-all-points"),Ct=mt("toggle-filter-by-category-name"),Et=mt("open-cell-in-3d"),St=mt("apply-selection-set-color"),Dt=mt("deselect-group"),kt=mt("set-download-config"),Pt=mt("set-mouse-position"),Ot=mt("sync-with-url"),_t=mt("change-hovered-point"),xt=mt("change-hovered-gallery-card"),It=mt("change-selected-album"),Ft=mt("toggle-gallery"),Tt=mt("set-align-active"),Nt=mt("REQUEST_CELL_FILE_INFO_BY_CELL_ID"),Bt=mt("RECEIVE_CELL_FILE_INFO"),Mt=mt("RECEIVE_SELECTED_FILE_INFO"),jt=mt("RECEIVE_FILE_INFO_FOR_ALBUM_CELLS"),Rt=mt("SELECT_ARRAY_OF_POINTS"),Vt=mt("RECEIVE_FILE_INFO_FOR_SELECTED_ARRAY_OF_CELLS"),Ut=mt("set-dataset"),zt=mt("change-dataset"),Gt=mt("clear-dataset"),Lt=mt("set-csv-url"),Ht=["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"];function Kt(e,t){return{axisId:e,payload:t,type:yt}}function Wt(e){return{payload:e,type:gt}}function qt(e,t){return{key:e,payload:t,type:vt}}function Xt(e){return{payload:e,type:Dt}}function Yt(e){return{payload:e,type:bt}}function Zt(e){return{payload:e,type:At}}function Qt(){return{type:wt}}function Jt(e){return{payload:e,type:Ct}}function $t(e){return{payload:e,type:Et}}function en(e){return{payload:e,type:Ot}}function tn(e){return{payload:e,type:St}}function nn(e){return{payload:e,type:kt}}function rn(e){return{payload:e,type:Pt}}function an(e){return{payload:e,type:_t}}function on(e){return{payload:e,type:xt}}function ln(e){return{payload:e,type:It}}function cn(e){return{payload:e,type:Ft}}function sn(e){return{payload:e,type:zt}}function un(){return{type:Gt}}function dn(e){return{payload:e,type:Lt}}function fn(e){return{payload:e,type:Bt}}function pn(e){return{payload:e,type:Nt}}function hn(e){return{payload:e,type:Rt}}function mn(e){return{payload:e,type:Tt}}function yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var vn=function(e){return e.selection.plotByOnX},bn=function(e){return e.selection.plotByOnY},An=function(e){return e.selection.groupBy},wn=function(e){return e.selection.selectedPoints},Cn=function(e){return e.selection.selectedGroups},En=function(e){return e.selection.colorBy},Sn=function(e){return e.selection.defaultColors},Dn=function(e){return e.selection.selectedGroupColors},kn=function(e){return e.selection.filterExclude},Pn=function(e){return e.selection.cellSelectedFor3D},On=function(e){return e.selection.applySelectionSetColoring},_n=function(e){return e.selection.downloadConfig},xn=function(e){return e.selection.mousePosition},In=function(e){return e.selection.hoveredPointData},Fn=function(e){return e.selection.hoveredCardId},Tn=function(e){return e.selection.selectedAlbum},Nn=function(e){return e.selection.galleryCollapsed},Bn=function(e){return e.selection.dataset},Mn=function(e){return e.selection.thumbnailRoot},jn=function(e){return e.selection.initSelectedPoints},Rn=function(e){return e.selection.selectedAlbumFileInfo},Vn=function(e){return e.selection.downloadRoot},Un=function(e){return e.selection.volumeViewerDataRoot},zn=function(e){return e.selection.alignActive},Gn=(0,Ze.Mz)([Bn],function(e){return e.split("_v")[0]}),Ln=function(e){return e.selection.csvUrl},Hn=(0,Ze.Mz)([rt,An],function(e,t){var n=he((0,ae.map)(e),t);return n&&n.discrete?n:{}}),Kn=(0,Ze.Mz)([Hn],function(e){return(0,ae.isEmpty)(e)?[]:(0,ae.sortBy)(e.options,"name")}),Wn=(0,Ze.Mz)([Kn],function(e){return(0,ae.map)(e,"name")}),qn=(0,Ze.Mz)([En,An,rt,dt],function(e,t,n,r){if((0,ae.includes)(r,e)){var a=he(n,e);if(a&&a.discrete){var o=a.options;return(0,ae.map)(o,function(n,r){var a;return a=t===e?n.key||n.name:r,{color:n.color,name:a,label:n.name}})}}return[]});function Xn(e,t){var n=(0,ae.find)(t,{key:e});return n&&n.tooltip?n.tooltip:""}var Yn=(0,Ze.Mz)([Qe,Hn],function(e,t){var n=t.key;return n?(0,ae.map)(e.values[n],function(e){var n=null!==e?e.toString():"";return me(t,n)}):(console.log("Missing groupBy category key"),[])}),Zn=(0,Ze.Mz)([Qe],function(e){return e.values||{}}),Qn=(0,Ze.Mz)([Zn,vn],function(e,t){return e[t]?e[t]:[]}),Jn=(0,Ze.Mz)([Zn,bn],function(e,t){return e[t]?e[t]:[]}),$n=(0,Ze.Mz)([Qe,En,rt],function(e,t,n){var r=he(n,t);if(r&&r.discrete){var a=r.options,o=(0,ae.map)(a,"count");if((0,ae.filter)(o,function(e){return void 0!==e}).length)return o;var l=(0,ae.reduce)(e.values[t],function(e,t){var n=null!==t?t.toString():"NaN";return e[n]?e[n]++:e[n]=1,e},{});return(0,ae.values)(l)}return[]}),er=(0,Ze.Mz)([ut,kn,Qe,An,Yn],function(e,t,n,r,a){if(!t.length)return gn(gn({},n),{},{labels:gn(gn({},n.labels),{},(0,f.A)({},r,a))});for(var o=[],l={},i=[],c=[],s=[],u=[],d=function(r){var d=a[r];if(!(0,ae.includes)(t,d)){var f,p,h=n.labels.cellIds[r];i.push(h),o.push(d),c.push(n.labels.thumbnailPaths[r]),s.push(null!==(f=null===(p=n.labels.sourcePaths)||void 0===p?void 0:p[r])&&void 0!==f?f:""),u.push(n.indices[r]),e.forEach(function(e){l[e]||(l[e]=[]),l[e].push(n.values[e][r])})}},p=0;p<n.labels.cellIds.length;p++)d(p);return{indices:u,values:l,labels:(0,f.A)((0,f.A)((0,f.A)((0,f.A)({},r,o),D,i),"thumbnailPaths",c),"sourcePaths",s)}}),tr=(0,Ze.Mz)([er],function(e){return e.values||{}}),nr=(0,Ze.Mz)([er],function(e){return e.labels||{}}),rr=(0,Ze.Mz)([tr,vn],function(e,t){return e[t]?e[t]:[]}),ar=(0,Ze.Mz)([tr,bn],function(e,t){return e[t]||[]}),or=(0,Ze.Mz)([nr],function(e){return e[D]||[]}),lr=(0,Ze.Mz)([er,En,An],function(e,t,n){return e.labels&&gn(gn({},e.values),{},(0,f.A)({},n,e.labels[n]))[t]||[]}),ir=(0,Ze.Mz)([wn],function(e){return(0,ae.map)(e,_)}),cr=(0,Ze.Mz)([Pn,wn,Yn,Qe],function(e,t,n,r){var a=function(e,t){return(0,ae.find)(e,function(e){return e[_].toString()===t})}(t,e)||{},o=-1;return(0,ae.isEmpty)(a)?a:gn(gn({index:o=void 0!==a.index?a.index:r.labels.cellIds.indexOf(e)},a),{},(0,f.A)({},O,n[o]))}),sr=(0,Ze.Mz)([cr],function(e){return(0,ae.isEmpty)(e)?"":e[x].toString()}),ur=(0,Ze.Mz)([cr],function(e){return!!e.transform}),dr=(0,Ze.Mz)([cr,Zn],function(e,t){var n=e.index;return void 0===n?{}:(0,ae.mapValues)(t,function(e){return e[n]})}),fr=(0,Ze.Mz)([Qe,Cn,vn,bn,Dn],function(e,t,n,r,a){var o=[],l=[],i=[];return(0,ae.mapValues)(t,function(t,c){t.forEach(function(t){o.push(a[c]),l.push(e.values[n][t.pointIndex]),i.push(e.values[r][t.pointIndex])})}),{color:o,x:l,y:i}}),pr=(0,Ze.Mz)([Cn],function(e){return(0,ae.keys)(e)}),hr=(0,Ze.Mz)([Cn],function(e){return(0,ae.map)(e,function(e){return e.length})}),mr=(0,Ye.A)({process:function(e,t,n){var r=(0,e.getState)();return ht(r).getAvailableDatasets().then(function(e){return t(Fe(e))}).catch(function(e){console.log(e)}).then(function(){return n()})},type:Se}),yr=function(e){return Math.floor(Math.random()*e)},gr=function(e,t,n){return null!==e[n]&&null!==t[n]},vr=function(e,t,n){for(var r=e,a=0;a<r;){var o=yr(e);if(gr(t,n,o))return o;a++}return 0},br=(0,Ye.A)({process:function(e,t,n){return(0,We.A)(Xe().mark(function r(){var a,o,l,i,c;return Xe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.getState,o=a(),l=ht(o),!tt(a())){r.next=1;break}return r.abrupt("return");case 1:return t(He("Loading plot data, may take several seconds to a minute...")),i=[],r.next=2,l.getMeasuredFeatureDefs();case 2:return c=r.sent,i.push(Me(c)),r.abrupt("return",l.getFeatureData().then(function(e){return e?(i.push(Be(e)),t(se(i)),e):n()}).then(function(e){if(!e)return n();var r=jn(o),a=0;if(r.length)t(hn(r));else{var l=e.labels[D],i=vn(o),c=bn(o),s=e.values[i],u=e.values[c];i&&c&&(a=vr(l.length,s,u)),t(Zt({id:e.labels[D][a],index:a}))}Pn(o)||t($t({id:e.labels[D][a]})),t(Le())}).catch(function(e){console.log(e)}).then(function(){return n()}));case 3:case"end":return r.stop()}},r)}))()},type:ge}),Ar=(0,Ye.A)({process:function(e,t,n){var r=(0,e.getState)(),a=ht(r);return t(He("Loading album data...")),a.getAlbumData().then(n).catch(function(e){console.log(e)}).then(function(){return n()})},processOptions:{successType:be},type:ve}),wr=(0,Ye.A)({process:function(e,t,n){var r=(0,e.getState)();return ht(r).getViewerChannelSettings().then(function(e){return t(Ge(e)),e}).then(n).catch(function(e){console.log(e)}).then(function(){return n()})},type:_e});function Cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Sr={albums:[],cellFileInfo:[],isLoading:!0,loadingText:"",showSmallScreenWarning:!1,megasets:[],featureData:{indices:[],values:{},labels:{}},measuredFeaturesDefs:[],viewerChannelSettings:{}};const Dr={actions:r,logics:[Ar,br,mr,wr],reducer:ie((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},ye,{accepts:function(e){return e.type===ye},perform:function(e,t){return Er(Er({},e),{},{featureData:t.payload})}}),Oe,{accepts:function(e){return e.type===Oe},perform:function(e){return Er(Er({},e),{},{cellFileInfo:Sr.cellFileInfo,isLoading:Sr.isLoading,featureData:Sr.featureData,measuredFeaturesDefs:Sr.measuredFeaturesDefs,viewerChannelSettings:Sr.viewerChannelSettings})}}),Ee,{accepts:function(e){return e.type===Ee},perform:function(e,t){return Er(Er({},e),{},{megasets:t.payload})}}),Pe,{accepts:function(e){return e.type===Pe},perform:function(e,t){return Er(Er({},e),{},{cellFileInfo:t.payload})}}),be,{accepts:function(e){return e.type===be},perform:function(e,t){return Er(Er({},e),{},{albums:t.payload})}}),xe,{accepts:function(e){return e.type===xe},perform:function(e,t){return Er(Er({},e),{},{viewerChannelSettings:t.payload})}}),Ae,{accepts:function(e){return e.type===Ae},perform:function(e,t){return Er(Er({},e),{},{isLoading:t.payload,loadingText:t.payload?e.loadingText:Sr.loadingText})}}),we,{accepts:function(e){return e.type===we},perform:function(e,t){return Er(Er({},e),{},{loadingText:t.payload})}}),Ce,{accepts:function(e){return e.type===Ce},perform:function(e,t){return Er(Er({},e),{},{showSmallScreenWarning:t.payload})}}),De,{accepts:function(e){return e.type===De},perform:function(e,t){return Er(Er({},e),{},{measuredFeaturesDefs:t.payload})}}),Sr),selectors:a,types:c};var kr,Pr=n(60436);function Or(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Or(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Or(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var xr={applySelectionSetColoring:!0,cellSelectedFor3D:"",colorBy:"",dataset:"",csvUrl:"",downloadConfig:{key:"",type:""},filterExclude:[],galleryCollapsed:!0,hoveredCardId:"",hoveredPointData:null,mousePosition:{pageX:0,pageY:0},plotByOnX:"",plotByOnY:"",groupBy:"",defaultColors:["#bbcd22","#ff9900","#FFEE1E","#FD92B6","#33a02c","#F07C4C","#c26cff","#f0486e","#0099ff","#ffc35c","#33ffff","#ff6633","#a6cee3","#cab2d6","#b15928","#e8af39","#537eff","#61d900","#ff8ae8","#FF4d4d","#c26cff","#aeaeae","#ff44ff","#6a3d9a","#ffff99","#ff00de","#24bcfa","#84df11","#ecc560","#ff72ff","#f58117","#f8311b","#5791db","#11a89a","#a70009","#ff6200","#fddb02","#f7db78","#f9a558"],selectedAlbum:0,selectedAlbumFileInfo:[],selectedGroupColors:{},selectedGroups:{},selectedPoints:[],initSelectedPoints:[],thumbnailRoot:"",downloadRoot:"",volumeViewerDataRoot:"",alignActive:!1};const Ir=ie((kr={},(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)(kr,Ut,{accepts:function(e){return e.type===Ut},perform:function(e,t){return _r(_r({},e),{},{dataset:t.payload.dataset,thumbnailRoot:t.payload.thumbnailRoot,downloadRoot:t.payload.downloadRoot,volumeViewerDataRoot:t.payload.volumeViewerDataRoot})}}),Gt,{accepts:function(e){return e.type===Gt},perform:function(){return _r({},xr)}}),Lt,{accepts:function(e){return e.type===Lt},perform:function(e,t){return _r(_r({},e),{},{csvUrl:t.payload})}}),yt,{accepts:function(e){return e.type===yt},perform:function(e,t){return _r(_r({},e),{},(0,f.A)({},t.axisId,t.payload))}}),gt,{accepts:function(e){return e.type===gt},perform:function(e,t){return _r(_r({},e),{},{groupBy:t.payload})}}),Et,{accepts:function(e){return e.type===Et},perform:function(e,t){return _r(_r({},e),{},{cellSelectedFor3D:t.payload.id})}}),vt,{accepts:function(e){return e.type===vt},perform:function(e,t){return _r(_r({},e),{},{selectedGroupColors:_r(_r({},e.selectedGroupColors),{},(0,f.A)({},t.key,Ht.splice(0,1)[0])),selectedGroups:_r(_r({},e.selectedGroups),{},(0,f.A)({},t.key,t.payload))})}}),Dt,{accepts:function(e){return e.type===Dt},perform:function(e,t){return _r(_r({},e),{},{selectedGroupColors:(0,ae.pickBy)(e.selectedGroupColors,function(e,n){return n.toString()!==t.payload.toString()}),selectedGroups:(0,ae.pickBy)(e.selectedGroups,function(e,n){return n.toString()!==t.payload.toString()})})}}),bt,{accepts:function(e){return e.type===bt},perform:function(e,t){return _r(_r({},e),{},{selectedPoints:(0,ae.filter)(e.selectedPoints,function(e){return e.CellId!==t.payload})})}}),wt,{accepts:function(e){return e.type===wt},perform:function(e){return _r(_r({},e),{},{selectedPoints:(0,Pr.A)(xr.selectedPoints)})}}),(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)(kr,Ct,{accepts:function(e){return e.type===Ct},perform:function(e,t){return _r(_r({},e),{},{filterExclude:t.payload})}}),St,{accepts:function(e){return e.type===St},perform:function(e,t){return _r(_r({},e),{},{applySelectionSetColoring:t.payload})}}),kt,{accepts:function(e){return e.type===kt},perform:function(e,t){return _r(_r({},e),{},{downloadConfig:t.payload})}}),Pt,{accepts:function(e){return e.type===Pt},perform:function(e,t){return _r(_r({},e),{},{mousePosition:t.payload})}}),_t,{accepts:function(e){return e.type===_t},perform:function(e,t){return _r(_r({},e),{},{hoveredPointData:t.payload})}}),xt,{accepts:function(e){return e.type===xt},perform:function(e,t){return _r(_r({},e),{},{hoveredCardId:t.payload})}}),It,{accepts:function(e){return e.type===It},perform:function(e,t){return _r(_r({},e),{},{selectedAlbum:t.payload})}}),Ft,{accepts:function(e){return e.type===Ft},perform:function(e,t){return _r(_r({},e),{},{galleryCollapsed:t.payload})}}),Mt,{accepts:function(e){return e.type===Mt},perform:function(e,t){return _r(_r({},e),{},{selectedPoints:(0,ae.uniqBy)([].concat((0,Pr.A)(e.selectedPoints),[t.payload]),_)})}}),Vt,{accepts:function(e){return e.type===Vt},perform:function(e,t){return _r(_r({},e),{},{selectedPoints:(0,ae.uniqBy)([].concat((0,Pr.A)(e.selectedPoints),(0,Pr.A)(t.payload)),_)})}}),(0,f.A)((0,f.A)(kr,jt,{accepts:function(e){return e.type===jt},perform:function(e,t){return _r(_r({},e),{},{selectedAlbumFileInfo:t.payload})}}),Tt,{accepts:function(e){return e.type===Tt},perform:function(e,t){return _r(_r({},e),{},{alignActive:t.payload})}})),xr);function Fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Tr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fr(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Nr=function(e){return e.cellSelectedFor3D="cellSelectedFor3D",e.colorBy="colorBy",e.dataset="dataset",e.plotByOnX="plotByOnX",e.plotByOnY="plotByOnY",e.selectedPoint="selectedPoint",e.selectedAlbum="selectedAlbum",e.galleryCollapsed="galleryCollapsed",e.csvUrl="csvUrl",e}({}),Br=function(){function e(){(0,p.A)(this,e)}return(0,h.A)(e,null,[{key:"toAppState",value:function(t){return(0,ae.reduce)(t,function(n,r,a){if(e.urlParamToStateMap.hasOwnProperty(a)){var o=e.urlParamToStateMap[a](r,t);return(0,ae.mergeWith)({},n,o,function(e,t){if(Array.isArray(e))return e.concat(t)})}return n},{})}},{key:"paramChanged",value:function(e,t,n){return!(0,ae.isEqual)(n[e],t[e])}},{key:"paramsChanged",value:function(e,t){return!(0,ae.isEqual)(t,e)}},{key:"toReduxActions",value:function(t){return(0,ae.reduce)(t,function(n,r,a){if(e.urlParamToActionCreatorMap.hasOwnProperty(a)){var o=e.urlParamToActionCreatorMap[a](r,t);if(o)return[].concat((0,Pr.A)(n),(0,Pr.A)((0,ae.castArray)(o)))}return n},[])}},{key:"toUrlSearchParameterMap",value:function(t){var n=this;return(0,ae.reduce)(t,function(t,r,a){return e.stateToUrlParamMap.hasOwnProperty(a)&&e.valueIsMeaningfulToSerialize(r)&&e.valueIsNotDefault(r,a)?Tr(Tr({},t),n.stateToUrlParamMap[a](r)):t},{})}},{key:"valueIsMeaningfulToSerialize",value:function(e){return!(!(0,ae.isBoolean)(e)&&(Array.isArray(e)||(0,ae.isString)(e)?(0,ae.isEmpty)(e):(0,ae.isNaN)(e)||(0,ae.isNil)(e)))}},{key:"valueIsNotDefault",value:function(e,t){return xr[t]!==e}}])}();function Mr(e){return!e||e.includes("localhost")||e.includes("staging")||e.includes("stg")}function jr(){return(jr=(0,We.A)(Xe().mark(function e(t){var n;return Xe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,fetch(t);case 1:if((n=e.sent).ok){e.next=2;break}throw new Error("Failed to fetch CSV dataset from url '".concat(t,"': ").concat(n.status," ").concat(n.statusText));case 2:return e.abrupt("return",n.text());case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rr(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}(0,f.A)(Br,"urlParamToActionCreatorMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},Nr.cellSelectedFor3D,function(e,t){var n=$t({id:String(e)});return(0,ae.includes)((0,ae.castArray)(t[Nr.selectedPoint]),e)?n:[Zt({id:String(e)}),n]}),Nr.colorBy,function(e){return Kt(P,String(e))}),Nr.dataset,function(e){return sn(String(e))}),Nr.csvUrl,function(e){return dn(decodeURIComponent(String(e)))}),Nr.galleryCollapsed,function(e){return cn("true"===e)}),Nr.plotByOnX,function(e){return Kt(E,String(e))}),Nr.plotByOnY,function(e){return Kt(S,String(e))}),Nr.selectedAlbum,function(e){return ln(Number(e))}),Nr.selectedPoint,function(e){return Array.isArray(e)?(0,ae.map)(e,function(e){return Zt({id:String(e)})}):Zt({id:String(e)})})),(0,f.A)(Br,"urlParamToStateMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},Nr.cellSelectedFor3D,function(e,t){var n={cellSelectedFor3D:String(e)};return(0,ae.includes)((0,ae.castArray)(t[Nr.selectedPoint]),e)||Object.assign(n,{initSelectedPoints:[String(e)]}),n}),Nr.colorBy,function(e){return(0,f.A)({},P,String(e))}),Nr.dataset,function(e){return{dataset:String(e)}}),Nr.galleryCollapsed,function(e){return{galleryCollapsed:"true"===e}}),Nr.plotByOnX,function(e){return(0,f.A)({},E,String(e))}),Nr.plotByOnY,function(e){return(0,f.A)({},S,String(e))}),Nr.selectedAlbum,function(e){return{selectedAlbum:Number(e)}}),Nr.selectedPoint,function(e){return{initSelectedPoints:(0,ae.map)((0,ae.castArray)(e),String)}})),(0,f.A)(Br,"stateToUrlParamMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({cellSelectedFor3D:function(e){return(0,f.A)({},Nr.cellSelectedFor3D,String(e))}},P,function(e){return(0,f.A)({},Nr.colorBy,String(e))}),"dataset",function(e){return(0,f.A)({},Nr.dataset,String(e))}),"csvUrl",function(e){return(0,f.A)({},Nr.csvUrl,String(encodeURIComponent(e)))}),"galleryCollapsed",function(e){return(0,f.A)({},Nr.galleryCollapsed,String(e))}),"selectedAlbum",function(e){return(0,f.A)({},Nr.selectedAlbum,String(e))}),"selectedPoints",function(e){var t=(0,ae.map)(e,function(e){return String(e[_])});return(0,f.A)({},Nr.selectedPoint,t)}),E,function(e){return(0,f.A)({},Nr.plotByOnX,String(e))}),S,function(e){return(0,f.A)({},Nr.plotByOnY,String(e))}));var Ur=(0,Ye.A)({type:Ot,process:function(e,t,n){var r=e.action.payload,a=Br.toReduxActions(r),o=(0,ae.remove)(a,{type:zt});o&&o.forEach(function(e){return t(e)}),t(se(Br.toReduxActions(r))),n()}}),zr=(0,Ye.A)({type:zt,process:function(e,t,n){return(0,We.A)(Xe().mark(function r(){var a,o,l,i,c,s,u,d,f;return Xe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.action,o=e.getState,l=o(),i=ht(l),a.payload){r.next=1;break}return r.abrupt("return",t({type:Ut,payload:a.payload}));case 1:if((s=lt(o())).length){r.next=6;break}return r.next=2,i.getAvailableDatasets();case 2:u=r.sent,d=0;case 3:if(!(d<u.length)){r.next=5;break}if(!(f=(0,ae.find)(u[d].datasets,{id:a.payload}))){r.next=4;break}return c=f,r.abrupt("continue",5);case 4:d++,r.next=3;break;case 5:r.next=7;break;case 6:c=(0,ae.find)(s,{id:a.payload});case 7:if(void 0!==c){r.next=8;break}return"csv"!==a.payload&&console.error("A dataset matching ".concat(a.payload," is not available.")),r.abrupt("return",n());case 8:i.selectDataset(c.manifest).then(function(e){var r=[Kt(E,e.defaultXAxis),Kt(S,e.defaultYAxis),Wt(e.defaultGroupBy)];e.defaultColorBy&&r.push(Kt(P,e.defaultColorBy)),t(se(r)),t({type:Ut,payload:{dataset:a.payload,thumbnailRoot:e.thumbnailRoot,downloadRoot:e.downloadRoot,volumeViewerDataRoot:e.volumeViewerDataRoot}}),t(Re()),t(ze()),n()});case 9:case"end":return r.stop()}},r)}))()}}),Gr=(0,Ye.A)({process:function(e){var t=e.action,n=(0,e.getState)();return ht(n).getFileInfoByCellId(t.payload.id.toString()).then(function(e){return e?Vr(Vr({},e),{},{index:t.payload.index}):{}}).catch(function(e){console.log(e)})},processOptions:{successType:Mt},type:At}),Lr=(0,Ye.A)({process:function(e){var t=e.action,n=(0,e.getState)(),r=ht(n),a=Qe(n),o=function(e,t){var n={};return e.sort(function(e,t){return Number(e)-Number(t)}).forEach(function(e){var r=(0,ae.indexOf)(t,e);n[e]=r}),n}(t.payload,a.labels.cellIds);return r.getFileInfoByArrayOfCellIds(t.payload).then(function(e){return(0,ae.filter)((0,ae.map)(e,function(e){return Vr(Vr({},e),{},{index:e?o[e.CellId]:-1})}))}).catch(function(e){console.log(e)})},processOptions:{successType:Vt},type:Rt});const Hr={actions:l,logics:[Ur,zr,Gr,(0,Ye.A)({process:function(e){var t=e.action,n=(0,e.getState)(),r=ht(n);return r.getFileInfoByArrayOfCellIds?r.getFileInfoByArrayOfCellIds([t.payload.toString()]).then(function(e){return(0,ae.filter)(e)}).catch(function(e){console.log(e)}):Promise.resolve({})},processOptions:{successType:jt},type:It}),Lr],reducer:Ir,selectors:i,types:s};var Kr=function(e){return le("image-dataset",e)},Wr=Kr("load-csv-dataset"),qr=Kr("change-image-dataset-type");function Xr(e){return{payload:e,type:qr}}function Yr(e){return{payload:e,type:Wr}}var Zr=n(5544),Qr=n(6653),Jr=n(84199),$r=n(79988);function ea(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ta(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ta(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}function ta(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var na="_defaultGroupByNone",ra="File ID",aa="Thumbnail",oa="File Path",la="Cell Line",ia="File Name",ca="file_id",sa="thumbnail",ua="file_path",da="file_name",fa="Link Path",pa=new Set([_,x,I,F,T,N,"transform",ra,aa,oa,ia,"File Size","Uploaded",ua,da,ca,sa,"file_size","uploaded",fa]),ha=["#27B4AE","#4047C4","#F48730","#DB4281","#7E84F4","#78DF76","#1C7AED","#7129CD","#E7C73B","#C95F1E","#188E61","#BEE952"],ma=function(e){return e[e.CONTINUOUS=0]="CONTINUOUS",e[e.DISCRETE=1]="DISCRETE",e}(ma||{});function ya(e){return null===e||"string"==typeof e&&("nan"===e.trim().toLowerCase()||!isNaN(Number(e))&&!isNaN(parseFloat(e)))}function ga(e){for(var t=0;t<e.length;t++)if(null!==e[t])return"string"==typeof e[t];return!1}function va(e){if(0===e.length)return!1;for(var t=0;t<e.length;t++)if(null!==e[t])return!0;return!1}var ba=function(){return(0,h.A)(function e(t){var n=this;(0,p.A)(this,e),(0,f.A)(this,"csvData",void 0),(0,f.A)(this,"idToIndex",void 0),(0,f.A)(this,"featureInfo",void 0),(0,f.A)(this,"defaultGroupByFeatureKey",void 0),(0,f.A)(this,"remapBffOrFmsKeys",function(e){var t=n.copyColumnIfEmpty(e,ra,_),r=n.copyColumnIfEmpty(e,ca,_);t||r||(n.copyColumnIfEmpty(e,ia,_),n.copyColumnIfEmpty(e,da,_)),n.copyColumnIfEmpty(e,aa,T),n.copyColumnIfEmpty(e,sa,T),n.copyColumnIfEmpty(e,oa,N),n.copyColumnIfEmpty(e,ua,N)}),this.csvData=[],this.idToIndex={},this.featureInfo=new Map,this.defaultGroupByFeatureKey="",this.parseCsvData(t)},[{key:"getFeatureKeysFromColumnNames",value:function(e){return Object.keys(e[0]).filter(function(e){return!pa.has(e)&&""!==e})}},{key:"getFeatureKeyClamped",value:function(e,t){var n=e.length-1;return e[Math.min(Math.max(t,0),n)]}},{key:"getFeatureDataAsColumns",value:function(e,t){var n,r=new Map,a=ea(t);try{for(a.s();!(n=a.n()).done;){var o,l=n.value,i=[],c=!0,s=ea(e);try{for(s.s();!(o=s.n()).done;){var u,d=null!==(u=o.value[l])&&void 0!==u?u:null;null===d||"string"==typeof d&&""===d.trim()?i.push(null):(i.push(d),ya(d)||(c=!1))}}catch(e){s.e(e)}finally{s.f()}if(c){var f=i.map(function(e){return e?Number.parseFloat(e):null});r.set(l,f)}else r.set(l,i)}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"parseDiscreteFeature",value:function(e,t){for(var n=new Map,r=[],a=0;a<t.length;a++){var o=t[a];if(null!==o){var l=o.trim(),i=n.get(l);i||(i={index:n.size,count:0},n.set(l,i)),i.count++,r.push(i.index)}else r.push(null)}var c,s={},u=ea(n.entries());try{for(u.s();!(c=u.n()).done;){var d=(0,Zr.A)(c.value,2),f=d[0],p=d[1],h=p.index,m=p.count;s[h.toString()]={color:ha[h%ha.length],name:f,key:f,count:m}}}catch(e){u.e(e)}finally{u.f()}return{def:{discrete:!0,displayName:e,description:e,key:e,options:s,tooltip:e},data:r}}},{key:"parseFeatures",value:function(e){this.featureInfo.clear();var t,n=this.getFeatureKeysFromColumnNames(e),r=this.getFeatureDataAsColumns(e,n),a=ea(n);try{for(a.s();!(t=a.n()).done;){var o=t.value,l=r.get(o);if(l&&va(l))if(ga(l)){var i=this.parseDiscreteFeature(o,l),c=i.def,s=i.data;this.featureInfo.set(o,{type:ma.DISCRETE,def:c,data:s})}else{var u={discrete:!1,displayName:o,description:o,key:o,tooltip:o};this.featureInfo.set(o,{type:ma.CONTINUOUS,def:u,data:l})}}}catch(e){a.e(e)}finally{a.f()}}},{key:"assignDefaultGroupByFeatureKey",value:function(e){var t=e[0];if(t&&void 0!==t[la])this.defaultGroupByFeatureKey=la;else{var n=Array.from(this.featureInfo.values()).find(function(e){return e.type===ma.DISCRETE});if(n)this.defaultGroupByFeatureKey=n.def.key;else{var r={0:{color:ha[0],name:"Default",key:"0",count:e.length}};this.featureInfo.set(na,{type:ma.DISCRETE,def:{discrete:!0,displayName:"(None)",description:"(None)",key:na,tooltip:"(None)",options:r},data:new Array(e.length).fill(0)}),this.defaultGroupByFeatureKey=na}}}},{key:"copyColumnIfEmpty",value:function(e,t,n){return void 0!==e[t]&&(void 0===e[n]||""===e[n])&&(e[n]=e[t],!0)}},{key:"parseCsvData",value:function(e){var t=Jr.parse(e,{header:!0,transformHeader:function(e){return e.trim()},skipEmptyLines:"greedy"}).data;if(this.csvData=t,0===this.csvData.length)throw new Error("No data found in CSV");for(var n=0;n<this.csvData.length;n++)this.remapBffOrFmsKeys(this.csvData[n]);for(var r=!0,a=0;a<this.csvData.length;a++){var o=this.csvData[a];if(void 0===o[_]||""===o[_].trim()){r=!1;break}}for(var l=0;l<this.csvData.length;l++){var i=this.csvData[l];r||(i[_]=l.toString()),this.idToIndex[i[_].trim()]=l}this.parseFeatures(this.csvData),this.assignDefaultGroupByFeatureKey(this.csvData)}},{key:"selectDataset",value:function(){var e=Array.from(this.featureInfo.keys());return Promise.resolve({defaultXAxis:this.getFeatureKeyClamped(e,0),defaultYAxis:this.getFeatureKeyClamped(e,1),defaultColorBy:this.defaultGroupByFeatureKey,defaultGroupBy:this.defaultGroupByFeatureKey,thumbnailRoot:"",downloadRoot:"",volumeViewerDataRoot:""})}},{key:"getAvailableDatasets",value:function(){var e={name:"csv",title:"CSV Dataset",production:!1,dateCreated:$r.A.firestore.Timestamp.now(),datasets:{csv:{name:"csv",title:"CSV Dataset",version:"1",id:"csv",description:"A dataset imported from a CSV file",index:0,userData:{}}}};return Promise.resolve([e])}},{key:"getViewerChannelSettings",value:function(){return Promise.resolve({groups:[{name:"Channels",channels:[{match:[0,1,2],enabled:!0},{match:"(.+)",enabled:!1}]}]})}},{key:"getFeatureKeyToData",value:function(){var e,t={},n=ea(this.featureInfo.entries());try{for(n.s();!(e=n.n()).done;){var r=(0,Zr.A)(e.value,2),a=r[0],o=r[1];t[a]=o.data}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getFeatureData",value:function(){for(var e=this.csvData.map(function(e,t){return t}),t=this.getFeatureKeyToData(),n=[],r=[],a=[],o=0;o<e.length;o++){var l=this.csvData[o];r.push(l[_]),n.push(l[T]||""),a.push(l[N]||l[F]||"")}return Promise.resolve({indices:e,values:t,labels:{thumbnailPaths:n,cellIds:r,sourcePaths:a}})}},{key:"getAlbumData",value:function(){return Promise.resolve([])}},{key:"getMeasuredFeatureDefs",value:function(){var e=Array.from(this.featureInfo.values()).map(function(e){return e.def});return Promise.resolve(e)}},{key:"getFileInfoByCellId",value:(t=(0,We.A)(Xe().mark(function e(t){var n,r,a,o,l,i;return Xe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.idToIndex[t])){e.next=1;break}return e.abrupt("return",Promise.resolve(void 0));case 1:if(r=this.csvData[n]){e.next=2;break}return e.abrupt("return",Promise.resolve(void 0));case 2:if(!r[fa]){e.next=4;break}return o=r[fa].split("?"),l=o[o.length-1]||"",e.next=3,(0,Qr.bT)(new URLSearchParams(l));case 3:a=e.sent;case 4:return i=(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},_,r[_]),x,r[x]),I,r[I]),F,r[F]),T,r[T]),N,r[N]),O,r[O]||this.defaultGroupByFeatureKey),"voleUrlParams",a),e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getFileInfoByArrayOfCellIds",value:(e=(0,We.A)(Xe().mark(function e(t){var n,r=this;return Xe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return r.getFileInfoByCellId(e)}),e.abrupt("return",Promise.all(n));case 1:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})}]);var e,t}();const Aa=ba,wa=[(0,Ye.A)({type:Wr,process:function(e,t,n){return(0,We.A)(Xe().mark(function r(){var a,o,l,i;return Xe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.action,o=a.payload,l=new Aa(o),t(Xr(l)),r.next=1,l.getAvailableDatasets();case 1:i=r.sent,t(Fe(i)),t(sn("csv")),n();case 2:case"end":return r.stop()}},r)}))()}})];var Ca=n(71083);n(58707),$r.A.initializeApp({apiKey:"AIzaSyD691xhXsWl-8QU_9htjZnMUd7siWVCTAE",appId:"1:40711248674:web:511cb4cede47191274237b",authDomain:"allen-cell-resource.firebaseapp.com",databaseURL:"https://allen-cell-resource.firebaseio.com",measurementId:"G-8553S8ESS7",messagingSenderId:"40711248674",projectId:"allen-cell-resource",storageBucket:"allen-cell-resource.appspot.com"});var Ea=$r.A.firestore();function Sa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Da(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sa(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sa(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ka=(0,h.A)(function e(){var t=this;(0,p.A)(this,e),(0,f.A)(this,"collectionRef",void 0),(0,f.A)(this,"featuresDataPath",void 0),(0,f.A)(this,"cellLineDataPath",void 0),(0,f.A)(this,"viewerSettingsPath",void 0),(0,f.A)(this,"thumbnailRoot",void 0),(0,f.A)(this,"downloadRoot",void 0),(0,f.A)(this,"volumeViewerDataRoot",void 0),(0,f.A)(this,"featuresDisplayOrder",void 0),(0,f.A)(this,"datasetId",void 0),(0,f.A)(this,"fileInfoPath",void 0),(0,f.A)(this,"featuresDataOrder",void 0),(0,f.A)(this,"albumPath",void 0),(0,f.A)(this,"featureDefsPath",void 0),(0,f.A)(this,"viewerChannelSettings",void 0),(0,f.A)(this,"getDoc",function(e){return Ea.doc(e).get()}),(0,f.A)(this,"getCollection",function(e){return Ea.collection(e).get()}),(0,f.A)(this,"getAvailableDatasets",function(){return Ea.collection("dataset-descriptions").get().then(function(e){var t=[];return e.forEach(function(e){var n=e.data();n.datasets=(0,ae.reduce)(n.datasets,function(e,t,n){return t.id=n,(Mr(location.hostname)||t.production)&&(e[n]=t),e},{}),(Mr(location.hostname)||n.production)&&t.push(n)}),t})}),(0,f.A)(this,"setCollectionRef",function(e){t.collectionRef=Ea.collection("cfe-datasets").doc(e)}),(0,f.A)(this,"getManifest",function(e){return Ea.doc(e).get().then(function(e){return e.data()})}),(0,f.A)(this,"selectDataset",function(e){return t.viewerChannelSettings=void 0,t.getManifest(e).then(function(e){return t.featuresDataPath=e.featuresDataPath,t.viewerSettingsPath=e.viewerSettingsPath,t.thumbnailRoot=e.thumbnailRoot,t.downloadRoot=e.downloadRoot,t.volumeViewerDataRoot=e.volumeViewerDataRoot,t.featuresDisplayOrder=e.featuresDisplayOrder,t.fileInfoPath=e.fileInfoPath,t.featuresDataOrder=e.featuresDataOrder,t.featureDefsPath=e.featureDefsPath,t.albumPath=e.albumPath,{defaultXAxis:e.xAxis.default,defaultYAxis:e.yAxis.default,defaultColorBy:e.colorBy.default,defaultGroupBy:e.groupBy.default,thumbnailRoot:e.thumbnailRoot,downloadRoot:e.downloadRoot,volumeViewerDataRoot:e.volumeViewerDataRoot}})}),(0,f.A)(this,"getViewerChannelSettings",function(){return t.viewerChannelSettings?Promise.resolve(t.viewerChannelSettings):t.viewerSettingsPath?Ca.A.get(t.viewerSettingsPath).then(function(e){return e.data}).then(function(e){return t.viewerChannelSettings=e,t.viewerChannelSettings}):Promise.resolve({})}),(0,f.A)(this,"requestSetOfFeatureDefs",function(){var e=(0,We.A)(Xe().mark(function e(n,r){var a;return Xe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.splice(0,10),e.next=1,Ea.collection(t.featureDefsPath).where("key","in",a).get();case 1:if(e.sent.forEach(function(e){var n=e.data(),a=n.key,o=t.featuresDisplayOrder.indexOf(a);r[o]=n}),!n.length){e.next=2;break}return e.abrupt("return",t.requestSetOfFeatureDefs(n,r));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),(0,f.A)(this,"getMeasuredFeatureDefs",(0,We.A)(Xe().mark(function e(){var n,r;return Xe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,Pr.A)(t.featuresDisplayOrder),r=[],e.next=1,t.requestSetOfFeatureDefs(n,r);case 1:return e.abrupt("return",r);case 2:case"end":return e.stop()}},e)}))),(0,f.A)(this,"getFeatureData",function(){return Ca.A.get(t.featuresDataPath).then(function(e){return e.data}).then(function(e){for(var n=t.featuresDisplayOrder.reduce(function(e,t){return e[t]=[],e},{}),r=[],a=[],o=[],l=[],i=0;i<e.length;i++){o.push(i);var c=e[i];c.f.forEach(function(e,r){var a=n[t.featuresDataOrder[r]];isNaN(e)?a.push(null):a.push(Number(e))},{}),r.push(c.p),a.push(c.t),l.push(c.i.toString())}return{indices:o,values:n,labels:{thumbnailPaths:a,cellIds:l}}}).catch(function(e){console.log("ERROR FETCHING FEATURE DATA:",e)})}),(0,f.A)(this,"getFileInfoByCellId",function(e){return t.getDoc("".concat(t.fileInfoPath,"/").concat(e)).then(function(e){var t=e.data();if(t)return Da(Da({},t),{},{CellId:t.CellId.toString(),FOVId:t.FOVId.toString()})})}),(0,f.A)(this,"getFileInfoByArrayOfCellIds",function(e){return Promise.all(e.map(function(e){return t.getDoc("".concat(t.fileInfoPath,"/").concat(e)).then(function(e){var t=e.data();if(t)return Da(Da({},t),{},{CellId:t.CellId.toString(),FOVId:t.FOVId.toString()})})}))}),(0,f.A)(this,"getAlbumData",function(){return t.albumPath?t.getCollection(t.albumPath).then(function(e){var t=[];return e.forEach(function(e){t.push(e.data())}),t}):Promise.resolve([])}),this.featuresDataPath="",this.viewerSettingsPath="",this.cellLineDataPath="",this.thumbnailRoot="",this.downloadRoot="",this.volumeViewerDataRoot="",this.featuresDisplayOrder=[],this.fileInfoPath="",this.datasetId="",this.featuresDataOrder=[],this.albumPath="",this.featureDefsPath="",this.collectionRef=Ea.collection("cfe-datasets").doc("v1")});function Pa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Oa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pa(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pa(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _a={imageDataset:new ka};const xa={actions:u,logics:wa,reducer:ie((0,f.A)({},qr,{accepts:function(e){return e.type===qr},perform:function(e,t){return Oa(Oa({},e),{},{imageDataset:t.payload})}}),_a),selectors:o,types:d};var Ia=n(16370),Fa=n(55957),Ta=n(58168),Na=n(11575),Ba=n(56914),Ma=n(36552),ja=n(92941);const Ra={card:"style__card--NiCPa",spacer:"style__spacer--HWBx1",loadButton:"style__loadButton--N_lqo"};var Va=Na.A.Meta;const Ua=function(e){var t=e.title,n=e.name,r=e.version,a=e.description,o=e.handleSelectDataset,l=e.link,i=e.id,c=e.userData,s=e.image,u=r.startsWith("v")?r:"v".concat(r),d=g.createElement(g.Fragment,null,g.createElement("div",null,c.isNew&&g.createElement(Ba.A,{color:"#8950d9"},"new"),t||n),g.createElement("span",{className:Ra.version},u),c.inReview&&g.createElement(g.Fragment,null,g.createElement(Ma.A,{type:"vertical"})," (in review)")),f=g.createElement(Na.A,{className:Ra.card,hoverable:!0,bordered:!1,cover:""!=s?g.createElement("img",{className:Ra.staticThumbnail,alt:"Snapshot of simulation for ".concat(t),src:s}):null,onClick:function(){return o(i)}},g.createElement(Va,{title:d,description:g.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:a}})}),g.createElement("div",{className:Ra.spacer}),g.createElement(Fa.A,{column:1,size:"small",colon:!1},c.totalCells&&g.createElement(Fa.A.Item,{label:"Number of Cells:"},c.totalCells.toLocaleString("en")),c.totalFOVs&&g.createElement(Fa.A.Item,{label:"Number of FOVs:"},c.totalFOVs.toLocaleString("en")),c.totalTaggedStructures&&g.createElement(Fa.A.Item,{label:"Number of tagged structures:"},c.totalTaggedStructures)),g.createElement(ja.Ay,{type:"primary",className:Ra.loadButton},"Load"));return l?g.createElement("a",{href:l},f):f},za=function(e){var t=e.megaset,n=e.handleSelectDataset,r=getComputedStyle(document.body).getPropertyValue("--dataset-card-width"),a=Object.keys(t.datasets).length,o=a>1?"100%":r,l=(0,ae.map)(t.datasets).sort(function(e,t){return e.index-t.index});return g.createElement("div",{key:t.name,className:"style__container--wG8VX",style:{maxWidth:o}},a>1&&g.createElement("div",{className:"style__megasetTitle--JTBkg"},t.title),g.createElement("div",{className:"style__datasetCards--UfwX8"},(0,ae.map)(l,function(e){return g.createElement(Ua,(0,Ta.A)({key:e.id},e,{handleSelectDataset:n}))})),t.extra&&g.createElement("div",{className:"style__extra--ltgun"},t.extra),t.publications&&t.publications.length>0&&g.createElement("div",{className:"style__publications--Ut6Bo"},"Publications",t.publications.map(function(e){return g.createElement("div",{key:"".concat(t.name,"-").concat(e.title),className:"style__publication--WYEYy"},g.createElement("div",{className:"style__publicationTitle--Q4rKq"},g.createElement("a",{href:e.url,target:"blank"},e.title)),g.createElement("div",{className:"style__journalDate--Ie_nT"},e.citation,"."))})))},Ga=[{date:"May/26/2021",title:"The hiPSC single-cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/21/2022",title:"The hiPSC single i1 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_i1_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/20/2022",title:"The hiPSC single M1 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_m1_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/21/2022",title:"The hiPSC single i2 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_i2_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/20/2022",title:"The hiPSC single M2 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_m2_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/19/2022",title:"The hiPSC single edge cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_edge_cell_image_dataset/tree/latest/metadata.csv"},{date:"Sep/28/2022",title:"The hiPSC single non-edge cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_nonedge_cell_image_dataset/tree/latest/metadata.csv"}],La="style__subtitle--XvF02 style__title--NfBvu",Ha="style__section--rIc_K",Ka="style__section-content--RbA_O",Wa="style__light-section--tJbzl style__section--rIc_K",qa="style__paragraph--IZ0BZ";var Xa=W.A.Content;const Ya=function(e){var t=e.handleSelectDataset,n=e.megasets;return g.createElement(W.A,null,g.createElement(Q.A,{className:Wa},g.createElement("h1",{className:La},"Welcome to Cell Feature Explorer"),g.createElement(Ia.A,{className:Ka},g.createElement("div",{className:qa},"The Cell Feature Explorer (CFE) is an online tool to access segmented and processed images of over 200,000 cells as curated datasets. Each dataset has specific measured features, such as cellular volume and mitosis stage that are described in the user interface and detailed in publications associated with each dataset. The CFE is composed of a plot, where each cell is graphed by these measured features, and a 3D viewer for in-depth visual analysis."))),g.createElement(W.A,null,g.createElement(Xa,{className:"style__content--tOv3o"},g.createElement(Q.A,{className:Ha},g.createElement("div",{className:Ka},g.createElement("h2",{className:La},"Load a dataset to get started"),g.createElement(Q.A,{className:"style__card-container--xhYX0"},n.map(function(e){return g.createElement(za,{key:e.name,megaset:e,handleSelectDataset:t})})))),g.createElement(Q.A,{className:Wa},g.createElement(Ia.A,{className:Ka},g.createElement("h2",{className:La},"Cell features in our data "),g.createElement("div",{className:qa},"hiPS cells from the"," ",g.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://www.allencell.org/cell-catalog.html"},"Allen Cell Collection")," ","grow in epithelial-like monolayer colonies when cultured on glass using our methods. We image rectangular fields of view (FOV) from these colonies in 3D, using spinning disk confocal microscopy. We collect four channels of data for each FOV, including one brightfield channel and three fluorescent channels:",g.createElement("ul",null,g.createElement("li",null,"dyed DNA "),g.createElement("li",null,"dyed cell membrane "),g.createElement("li",null,"one fluorescently labeled protein designed to visualize a particular organelle or cellular structure via endogenous tagging"))),g.createElement("div",{className:qa},"The fluorescent channels are segmented to demarcate structures and to define the boundaries of individual cells. The segmented structures are then measured, and the data for these measurements, as well as cell and nuclear shape modes (derived from a principal component analysis; please see our recent article in"," ",g.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://www.biorxiv.org/content/10.1101/2020.12.08.415562v1"},"bioRxiv"),") are made available for plotting at the top of the CFE tool page. The beautiful cells and the FOVs from which they were segmented can be explored in a 3D viewer at the bottom of the CFE tool page."))),g.createElement(Q.A,{className:Ha},g.createElement(Ia.A,{className:Ka},g.createElement("h2",{className:La},"Download cell feature data (via Quilt)"),g.createElement(Q.A,{className:Ha},g.createElement(Fa.A,{layout:"horizontal",colon:!1,column:1,style:{margin:"10px 0"}},g.createElement(Fa.A.Item,{label:"RELEASE DATE"},"DATASET"),Ga.map(function(e,t){return g.createElement(g.Fragment,null,g.createElement(Fa.A.Item,{label:e.date,key:t}," ",g.createElement("a",{target:"_blank",href:e.link,rel:"noreferrer"},e.title)))}))),g.createElement("div",{className:qa},"Once you navigate to Quilt, you can follow the instructions provided to access the cell feature data. If you need assistance, please visit the"," ",g.createElement("a",{href:"https://forum.allencell.org/tags/c/software-code/11/cell-feature-explorer"},"Allen Cell Discussion Forum"),"."))))))};var Za=n(87206),Qa=n(4118);var Ja={flex:1,width:"100%",height:"100%",backgroundColor:"red"};const $a=function(e){return e.cellId?g.createElement("div",{className:"style__cell-viewer-container--Uybfp",style:Ja},g.createElement(Qr.TV,{viewerSettings:e.viewerSettings},g.createElement(Qr.N$,(0,Ta.A)({cellId:e.cellId,imageUrl:e.baseUrl+e.cellPath,imageDownloadHref:e.cellDownloadHref,parentImageUrl:e.fovPath?e.baseUrl+e.fovPath:"",parentImageDownloadHref:e.fovDownloadHref,viewerChannelSettings:e.viewerChannelSettings,transform:e.transform,onControlPanelToggle:e.onControlPanelToggle,metadata:e.metadata,appHeight:"100%",canvasMargin:"0 0 0 0"},e.appProps)))):null};var eo=n(12121),to=n(40920);const no=function(e){var t=e.visible,n=e.handleClose,r=e.onDismissCheckboxChecked;return g.createElement(eo.A,{centered:!0,title:"Small Screen Warning",open:t,onOk:n,onCancel:n,footer:null,style:{color:"#0a0a0a"}},g.createElement("p",null,"Many features of this web tool are hidden while using it on a small screen."),g.createElement("p",null,"To access all features, including a tool to plot measurements for over 30,000 cells,"," ","please visit this web page on a larger screen."),g.createElement("div",{className:"style__checkbox-container--Oh8_b"},g.createElement(to.A,{onChange:function(e){var t=e.target;return r(t.checked)}},"Don't show this message again.")),g.createElement("div",{className:"style__button-container--uU5cj"},g.createElement(ja.Ay,{className:"style__ok-button--dUxzH",onClick:n},"OK")))};var ro=n(47852),ao=n(42754),oo=n(53691),lo=n(50770),io=n(16044),co=n(10959),so=n(40756),uo=n(45824),fo=n(63081),po=n(37977),ho=n(86336),mo=n(73586),yo=n(73938);function go(e){return vo.apply(this,arguments)}function vo(){return vo=(0,We.A)(Xe().mark(function e(t){var n,r;return Xe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new mo.A(t),e.next=1,(0,yo.rk)(n);case 1:return r=e.sent,e.abrupt("return",r);case 2:case"end":return e.stop()}},e)})),vo.apply(this,arguments)}function bo(e,t){var n=(0,g.useState)(e),r=(0,Zr.A)(n,2),a=r[0],o=r[1];return(0,g.useEffect)(function(){var n=function(){var n=(0,We.A)(Xe().mark(function n(){var r,a,l,i,c;return Xe().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a=void 0,l=null!==(r=null==t?void 0:t.volumeviewerPath)&&void 0!==r?r:null==t?void 0:t.fovVolumeviewerPath,e&&e.endsWith(".zarr")?a=e:l&&l.endsWith(".zarr")&&(a=l),!a){n.next=4;break}return n.prev=1,n.next=2,go(a);case 2:return i=n.sent,o(i),n.abrupt("return");case 3:n.prev=3,c=n.catch(1),console.error("Error generating thumbnail for file ".concat(a," :"),c);case 4:case"end":return n.stop()}},n,null,[[1,3]])}));return function(){return n.apply(this,arguments)}}();n()},[e]),a}const Ao={container:"style__container--hMtze",small:"style__small--NUf0x","action-list":"style__action-list--k3zlB",actionList:"style__action-list--k3zlB",disabled:"style__disabled--loRMz",selected:"style__selected--BN2Ob",stage:"style__stage--cgwYC",placeholderAvatar:"style__placeholderAvatar--Swup9"},wo=function(e){var t=bo(e.src,e.fileInfo),n=function(){e.handleOpenIn3D({id:e.cellID})},r=[];e.downloadHref&&r.push({key:"1",label:g.createElement("a",{href:e.downloadHref},g.createElement(so.A,null)," Segmented cell")}),e.downloadFullField&&r.push({key:"2",label:g.createElement("a",{href:e.downloadFullField},g.createElement(so.A,null)," Full field image")});var a=""!==e.downloadHref||""!==e.downloadFullField,o=[g.createElement(ja.Ay,{key:"".concat(e.cellID,"-load"),onClick:n},"3D"),g.createElement(Ma.A,{key:"".concat(e.cellID,"-0"),type:"vertical"}),g.createElement(fo.A,{key:"".concat(e.cellID,"-download"),menu:{items:r},trigger:["click"],disabled:!a},g.createElement(po.A,{key:"".concat(e.cellID,"-download"),title:a?null:U,trigger:["hover","focus"]},g.createElement(ja.Ay,{disabled:!a},g.createElement(so.A,null)))),g.createElement(Ma.A,{key:"".concat(e.cellID,"-1"),type:"vertical"}),g.createElement(ja.Ay,{key:"".concat(e.cellID,"-close"),onClick:function(){e.handleDeselectPoint(e.cellID)}},g.createElement(ro.A,null))];return g.createElement(co.A.Item,{key:e.cellID,className:Ao.container,style:{width:e.widthPx},id:e.cellID?e.cellID.toString():"",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},g.createElement(Na.A,{className:e.selected?Ao.selected:Ao.unselected,loading:e.empty,cover:t?g.createElement("img",{alt:"thumbnail of microscopy image",src:t,onClick:n}):g.createElement(uo.A,{onClick:n,style:{padding:"12px 0",fontSize:"".concat(e.widthPx/3,"px")}})},g.createElement(Na.A.Meta,{className:Z()((0,f.A)({},Ao.small,e.widthPx<170)),title:e.category,description:g.createElement(ho.A,{vertical:!0,justify:"space-between"},g.createElement(ho.A,{vertical:!0},g.createElement("span",null,e.cellID),g.createElement("span",{style:{minHeight:"1.5em"}},e.mitoticStage&&g.createElement("span",{className:Ao.stage},e.mitoticStage))),!e.empty&&g.createElement("div",{className:Ao.actionList},o))})))};var Co=n(81427);const Eo=function(e){var t=bo(e.src,e.fileInfo);return g.createElement(co.A.Item,{key:e.cellID,className:"style__container--O2RRk",id:e.cellID?e.cellID.toString():"",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},g.createElement(co.A.Item.Meta,{avatar:g.createElement("div",{onClick:function(){e.handleOpenIn3D({id:e.cellID})}},g.createElement(Co.A,{className:Z()((0,f.A)({},"style__selected--H5lki",e.selected),"style__avatar--ymR_r"),alt:"thumbnail of microscopy image",src:t,icon:g.createElement(uo.A,{className:"style__placeholder-avatar--VUJ4u"})}))}))};var So=n(1575);const Do=function(e){var t=e.setWidth,n=e.currentWidth;return g.createElement("div",{className:"gallery-card-slider"},g.createElement(ho.A,{justify:"space-between",align:"center"},g.createElement("label",{style:{color:"#BFBFBF"}},"Size:"),g.createElement(So.A,{style:{width:100},min:106,max:256,value:n,onChange:t,tooltip:{open:!1}})))};var ko=(0,Ze.Mz)([Je,Tn],function(e,t){return(0,ae.find)(e,{album_id:t})}),Po=(0,Ze.Mz)([ko],function(e){return e?e.title:"My Selections"}),Oo=(0,Ze.Mz)([ko,wn,Rn],function(e,t,n){return e?n:t}),_o=(0,Ze.Mz)([Hn,Qe,pt,Oo,Vn,Mn,ft],function(e,t,n,r,a,o,l){if((0,ae.isEmpty)(t.labels)||!r.length)return[];var i=t.values[e.key];return(0,ae.map)(r,function(r){var c,s=r[_];if((c=void 0!==r.index&&r.index>0?r.index:t.labels[D].indexOf(s))<0)return{};var u="";if(!(0,ae.isEmpty)(l)&&n.length){var d=n[c]||-1;u=l[d]?l[d].name:""}var f="";r[N]&&(f=fe(a,de(s)));var p=r[x],h="";r[F]&&(h=fe(a,ue(p)));var m=pe(o,r.thumbnailPath),y=i[c];return{cellID:s,downloadHref:f,fullFieldDownloadHref:h,category:me(e,y?y.toString():""),mitoticStage:u,src:m,fileInfo:r}})});const xo="style__container--wvA9t",Io="style__gallery-header--gOeo8";function Fo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function To(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(To=function(){return!!e})()}var No=ao.A.Search,Bo={inputStatus:void 0,message:"",thumbnailSize:128},Mo={error:"That id is not in our dataset.",success:Bo.message,warning:"That cell is already in the gallery."},jo=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,To()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"endOfAlbum",void 0),n.renderGalleryCard=n.renderGalleryCard.bind(n),n.renderMinGalleryCard=n.renderMinGalleryCard.bind(n),n.searchValidate=n.searchValidate.bind(n),n.resetSearch=n.resetSearch.bind(n),n.hoverCard=n.hoverCard.bind(n),n.unHover=n.unHover.bind(n),n.renderCollapsedView=n.renderCollapsedView.bind(n),n.renderFullView=n.renderFullView.bind(n),n.selectAlbum=n.selectAlbum.bind(n),n.closeGallery=n.closeGallery.bind(n),n.selectCell=n.selectCell.bind(n),n.endOfAlbum=g.createRef(),n.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},Bo),n}return(0,K.A)(t,e),(0,h.A)(t,[{key:"componentDidMount",value:function(){(0,this.props.getAlbumData)()}},{key:"componentDidUpdate",value:function(e){var t=this.endOfAlbum,n=this.props.clickedPoints;t.current&&e.clickedPoints.length!==n.length&&t.current.scrollIntoView({behavior:"smooth"})}},{key:"searchValidate",value:function(e){var t=this.props,n=t.clickedPoints,r=t.ids,a=t.addSearchedCell;return(0,ae.includes)((0,ae.map)(n,function(e){return e.toString()}),e)?this.setState({inputStatus:"warning",message:Mo.warning}):(0,ae.includes)(r,e)?(a({id:e}),this.setState({inputStatus:"success",message:Mo.success})):void this.setState({inputStatus:"error",message:Mo.error})}},{key:"resetSearch",value:function(){this.setState({inputStatus:Bo.inputStatus,message:Bo.message})}},{key:"selectAlbum",value:function(e){var t=e.target,n=this.props.handleSelectAlbum;t&&n(t.value)}},{key:"renderAlbumButtons",value:function(){var e=this.props,t=e.albumData,n=e.selectedAlbum,r=e.clickedPoints;return g.createElement(oo.A,{layout:"vertical",colon:!0},g.createElement(oo.A.Item,{label:"ALBUMS"},g.createElement(lo.Ay.Group,{defaultValue:n,onChange:this.selectAlbum,size:"large"},g.createElement(lo.Ay.Button,{key:"my-selections",value:0},"My Selections (".concat(r.length,")")),(0,ae.map)(t,function(e){if(e.cell_ids)return e.cell_ids.length>0&&g.createElement(lo.Ay.Button,{key:e.album_id,value:e.album_id},e.title," (",e.cell_ids.length,")")}))))}},{key:"closeGallery",value:function(){(0,this.props.toggleGallery)(!0)}},{key:"selectCell",value:function(e){var t=this.props.handleOpenIn3D;return this.closeGallery(),this.props.openViewerTab(),t(e)}},{key:"renderFullView",value:function(){var e=this,t=this.props,n=t.data,r=t.handleClearAllSelectedPoints,a=t.selectedAlbum,o=t.selectedAlbumName,l=n.length>0?n:[{empty:!0}];return g.createElement(Q.A,{id:"gallery",className:xo,gutter:32,justify:"space-between"},g.createElement("div",{className:"style__gallery-grid--gvldu"},g.createElement("div",{className:Io},g.createElement("h2",null,o),g.createElement(Do,{setWidth:function(t){return e.setState({thumbnailSize:t})},currentWidth:this.state.thumbnailSize}),n.length>0&&!a&&g.createElement(io.A,{title:"Are you sure you want to unselect all?",onConfirm:r,okText:"Yes",cancelText:"No"},g.createElement(ja.Ay,null,g.createElement(ro.A,null)," Clear All"))),g.createElement(co.A,{itemLayout:"horizontal",grid:{gutter:16},className:"style__list--T_xfO",dataSource:l,renderItem:this.renderGalleryCard,footer:g.createElement("div",{ref:this.endOfAlbum})})),g.createElement("div",{className:"style__album-side-bar--kzFBa"},g.createElement("div",{className:"style__side-bar-header--LJXyh"},g.createElement("h2",null,"Thumbnail Gallery"),g.createElement(ja.Ay,{type:"text",onClick:this.closeGallery,style:{padding:0}},g.createElement(ro.A,{style:{fontSize:"2em"}}))),g.createElement(oo.A.Item,{hasFeedback:!0,className:"style__search-for-cell--IdZGM",validateStatus:this.state.inputStatus,help:this.state.message},g.createElement(No,{placeholder:"add image by cell id",onSearch:this.searchValidate,onChange:this.resetSearch})),this.renderAlbumButtons()))}},{key:"renderCollapsedView",value:function(){var e=this.props.data,t=e.length>0?e:[{empty:!0}];return g.createElement("div",{id:"gallery",className:xo},g.createElement("div",{className:Io},g.createElement("h2",null,"Gallery")),g.createElement(co.A,{itemLayout:"horizontal",dataSource:t,renderItem:this.renderMinGalleryCard,footer:g.createElement("div",{ref:this.endOfAlbum})}))}},{key:"render",value:function(){var e=this.props.collapsed;return g.createElement(X.Ay,{theme:{components:{Radio:{colorPrimary:"#fffffa",colorPrimaryActive:"#fffc",colorPrimaryHover:"#fff"}}}},e?this.renderCollapsedView():this.renderFullView())}},{key:"hoverCard",value:function(e){var t=e.currentTarget,n=this.props.setHovered;if(t.id)return n(t.id);n(null)}},{key:"unHover",value:function(){(0,this.props.setHovered)(null)}},{key:"renderMinGalleryCard",value:function(e){var t=this.props,n=t.handleDeselectPoint,r=t.selectedCell,a=r?r.toString():"";return g.createElement(Eo,{onMouseEnter:this.hoverCard,onMouseLeave:this.unHover,category:e.category,src:e.src,selected:a===e.cellID,downloadHref:e.downloadHref,cellID:e.cellID,fileInfo:e.fileInfo,handleDeselectPoint:n,handleOpenIn3D:this.selectCell,empty:e.empty})}},{key:"renderGalleryCard",value:function(e){var t=this.props,n=t.handleDeselectPoint,r=t.selectedCell||"";return g.createElement(wo,{onMouseEnter:this.hoverCard,onMouseLeave:this.unHover,category:e.category,mitoticStage:e.mitoticStage,src:e.src,selected:r===e.cellID,downloadHref:e.downloadHref,downloadFullField:e.fullFieldDownloadHref,cellID:e.cellID,fileInfo:e.fileInfo,handleDeselectPoint:n,handleOpenIn3D:this.selectCell,empty:e.empty,widthPx:this.state.thumbnailSize})}}])}(g.Component),Ro={addSearchedCell:Zt,getAlbumData:Ve,handleClearAllSelectedPoints:Qt,handleDeselectPoint:Yt,handleOpenIn3D:$t,handleSelectAlbum:ln,setHovered:on};const Vo=(0,b.Ng)(function(e){return{albumData:Je(e),clickedPoints:ir(e),data:_o(e),ids:or(e),selectedAlbum:Tn(e),selectedAlbumName:Po(e),selectedCell:Pn(e)}},Ro)(jo);var Uo=n(30696),zo=n(90116);const Go={"plot-by-on-x":"style__plot-by-on-x--hPBYK",plotByOnX:"style__plot-by-on-x--hPBYK","plot-by-on-y":"style__plot-by-on-y--AZkRk",plotByOnY:"style__plot-by-on-y--AZkRk"};function Lo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Lo=function(){return!!e})()}var Ho=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,Lo()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).handleChange=n.handleChange.bind(n),n}return(0,K.A)(t,e),(0,h.A)(t,[{key:"handleChange",value:function(e){var t=e;this.props.onChange(t)}},{key:"render",value:function(){var e,t=this.props,n=t.classKey,r=void 0===n?"":n,a=t.value,o=t.options,l=t.tooltip,i=o.map(function(e){return{label:"".concat(e.displayName," ").concat(e.unit?"(".concat(e.unit,")"):""),key:e.key,value:e.key,tooltip:e.tooltip}}),c=null===(e=i.find(function(e){return e&&e.key===a}))||void 0===e||null===(e=e.label)||void 0===e?void 0:e.toString();return g.createElement("div",{className:Go[r]},g.createElement(po.A,{title:l},g.createElement(zo.A,{onChange:this.handleChange,value:c||a,options:i})))}}])}(g.Component),Ko=n(52120),Wo=n(26067);function qo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qo(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Yo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Yo=function(){return!!e})()}var Zo="alreadyDownloaded",Qo=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,Yo()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"popupContainerRef",void 0),n.onClose=n.onClose.bind(n),n.onDownload=n.onDownload.bind(n),n.saveDownloadUrl=n.saveDownloadUrl.bind(n),n.handleMenuClick=n.handleMenuClick.bind(n),n.handleDownloadMenuVisibleChange=n.handleDownloadMenuVisibleChange.bind(n),n.state={alreadyDownloaded:localStorage.getItem(Zo)?JSON.parse(localStorage.getItem(Zo)):{},downloadMenuVisible:!1},n.popupContainerRef=g.createRef(),n}return(0,K.A)(t,e),(0,h.A)(t,[{key:"onClose",value:function(e){var t=e.currentTarget,n=this.props.handleClose;t&&t.id&&n&&n(t.id)}},{key:"onDownload",value:function(e){var t=e.currentTarget,n=this.props.handleDownload;t&&t.id&&n&&n(t.id)}},{key:"saveDownloadUrl",value:function(e){var t=this.props.downloadConfig,n=this.state.alreadyDownloaded,r=n[t.key];r?this.setState({alreadyDownloaded:Xo(Xo({},n),{},(0,f.A)({},t.key,(0,ae.uniq)([].concat((0,Pr.A)(r),[e.key]))))}):this.setState({alreadyDownloaded:Xo(Xo({},n),{},(0,f.A)({},t.key,[e.key]))})}},{key:"handleDownloadMenuVisibleChange",value:function(e){localStorage.setItem(Zo,JSON.stringify(this.state.alreadyDownloaded)),this.setState({downloadMenuVisible:!!e})}},{key:"handleMenuClick",value:function(){var e=this.props,t=e.downloadUrls,n=e.downloadConfig,r=this.state.alreadyDownloaded[n.key];r&&r.length===t.length&&this.setState({downloadMenuVisible:!1})}},{key:"render",value:function(){var e=this,t=this.props,n=t.id,r=t.downloadUrls,a=t.downloadConfig,o=t.downloadRoot,l=this.state.alreadyDownloaded[a.key],i={items:r.map(function(t,n){return{key:n,onClick:e.saveDownloadUrl,label:g.createElement(g.Fragment,null,(0,ae.includes)(l,n.toString())?g.createElement(Wo.A,null):g.createElement(so.A,null),g.createElement("a",{href:t}," data chunk ",n+1," "))}}),onClick:this.handleMenuClick},c=""===o;return g.createElement("div",{className:"style__container--AElaZ",ref:this.popupContainerRef},g.createElement(po.A,{title:c?U:null},g.createElement(fo.A,{menu:i,trigger:["click"],onOpenChange:this.handleDownloadMenuVisibleChange,open:this.state.downloadMenuVisible,placement:"bottomRight",autoAdjustOverflow:!1,getPopupContainer:function(){return e.popupContainerRef.current||document.body}},g.createElement(ja.Ay,{size:"small",className:c?"style__disabled-download--WYcUx":"ant-dropdown-link",id:n,onClick:c?void 0:this.onDownload,disabled:c},g.createElement(so.A,null)))))}}])}(g.Component);(0,f.A)(Qo,"defaultProps",{closeable:!1,downloadUrls:[],hideable:!0});function Jo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Jo=function(){return!!e})()}var $o=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,Jo()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).onClose=n.onClose.bind(n),n}return(0,K.A)(t,e),(0,h.A)(t,[{key:"onClose",value:function(e){var t=e.currentTarget,n=this.props.handleClose;t&&t.id&&n&&n(t.id)}},{key:"render",value:function(){var e=this.props,t=e.closeable,n=e.hideable,r=e.showTooltips,a=e.disabled,o=e.id,l=e.color,i=e.name,c=e.total,s=e.onBarClicked,u=e.checked,d=e.downloadUrls,f=e.downloadConfig,p=e.downloadRoot,h=e.handleDownload,m=g.createElement("div",null,o),y=a?"style__label-disabled--_3phL":"style__label--HnODt";return g.createElement("div",{className:"style__container--r1icz"},g.createElement("div",{className:"style__first-column--qxIuw"},n&&g.createElement(to.A,{onChange:s,value:o,defaultChecked:!0,checked:u,disabled:a}),g.createElement(Ko.A,{style:{backgroundColor:l,padding:4},dot:!0}),r?g.createElement(po.A,{placement:"right",title:m},g.createElement("span",{className:y},i)):g.createElement("span",{className:y},i)),g.createElement("div",null,g.createElement("span",{className:y},c),g.createElement(Qo,{color:l,id:o,name:i,total:c,downloadConfig:f,downloadUrls:d,downloadRoot:p,handleDownload:h}),t&&g.createElement(ja.Ay,{size:"small",id:o,onClick:this.onClose},g.createElement(ro.A,null))))}}])}(g.Component);(0,f.A)($o,"defaultProps",{closeable:!1,downloadUrls:[],hideable:!0});const el=function(e){var t=e.showTooltips,n=e.closeable,r=e.downloadUrls,a=e.handleCloseSelectionSet,o=e.handleDownload,l=e.downloadConfig,i=e.downloadRoot,c=e.hideable,s=e.onBarClicked,u=e.panelData;return g.createElement(g.Fragment,null,(0,ae.map)(u,function(e){return g.createElement($o,{key:e.id,showTooltips:t,closeable:n,checked:e.checked,hideable:c,disabled:e.disabled||!1,color:e.color,name:e.name,total:e.total,id:e.id,onBarClicked:s,handleClose:a,handleDownload:o,downloadUrls:r,downloadConfig:l,downloadRoot:i})}))};var tl=n(12609);const nl="style__color-by-switch--f9FIL",rl="style__color-by-row--YXw6H",al="style__label--UPyKE",ol=function(e){return e.includeCol?g.createElement(Q.A,{className:rl,align:"middle"},g.createElement(Ia.A,{span:e.includeCol},g.createElement("label",{className:al},"Color by:"),g.createElement(tl.A,{className:nl,defaultChecked:e.defaultChecked,checkedChildren:e.checkedChildren,unCheckedChildren:e.unCheckedChildren,onChange:e.handleChange})),e.children):g.createElement(Q.A,{className:rl,align:"middle"},g.createElement("label",{className:al},e.label),g.createElement(tl.A,{className:nl,defaultChecked:e.defaultChecked,onChange:e.handleChange}))},ll="style__label--TpoXl";function il(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(il=function(){return!!e})()}var cl=function(e){function t(e){return(0,p.A)(this,t),n=this,r=t,a=[e],r=(0,H.A)(r),(0,L.A)(n,il()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a));var n,r,a}return(0,K.A)(t,e),(0,h.A)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=e.name,r=e.total;return g.createElement("div",{className:"style__container--f9hih"},g.createElement("div",{className:"style__first-column--PD1I1"},g.createElement(Ko.A,{style:{backgroundColor:t,padding:4},dot:!0}),g.createElement("span",{className:ll},n)),g.createElement("div",null,g.createElement("span",{className:ll},r)))}}])}(g.Component),sl=function(e){return e.CONTINUOUS="continuous",e.GROUPED="grouped",e}({}),ul=(0,Ze.Mz)([Qn,Jn,Yn],function(e,t,n){for(var r=new Set,a=0;a<e.length;a++)null!==e[a]&&null!==t[a]&&r.add(n[a]);return(0,Pr.A)(r)}),dl=(0,Ze.Mz)([Hn],function(e){return e.displayName}),fl=(0,Ze.Mz)([kn,Wn],function(e,t){return e.length>0&&e.length!==t.length}),pl=(0,Ze.Mz)([qn,An,En],function(e,t,n){return n===t?[]:e}),hl=(0,Ze.Mz)([An,En,Kn,kn,ul,Yn],function(e,t,n,r,a,o){var l,i,c,s,u=(0,ae.reduce)(o,function(e,t){return e[t]=(e[t]||0)+1,e},{}),d=(l=n,i=(0,ae.map)(l,function(e){return e.name}),c=(0,ae.map)(l,function(e){return e.key||""}),s=i.filter(function(e,t){return i.indexOf(e)!==t}),i.map(function(e,t){return s.includes(e)?"".concat(e," (").concat(c[t],")"):e}));return(0,ae.map)(n,function(n,o){var l,i,c,s,f=n.name,p=n.key||f,h=u[p]||n.count||0,m=!a.includes(p),y=(l=t===e,i=(0,ae.includes)(r,p),c=m,s=n.color,c?R:i?"#000":l?s:R);return{checked:!(0,ae.includes)(r,p),color:y,id:p,name:d[o],disabled:m,total:h}})}),ml=(0,Ze.Mz)([On,Dn,pr,hr],function(e,t,n,r){return(0,ae.map)(n,function(n,a){var o=e?(0,ae.values)(t)[a]:R,l=Number(n)?a:n;return{color:o,id:n.toString(),name:l.toString(),total:r[a]}})}),yl=(0,Ze.Mz)([st,Yn,_n,Cn],function(e,t,n,r){var a=[];return n.type===B?(0,ae.reduce)(t,function(t,r,a){return r===n.key&&t.push(de(e.cellIds[a])),t},a):n.type===M?r[n.key].map(function(e){return de(e.cellId)}):a}),gl=(0,Ze.Mz)([Vn,yl],function(e,t){if(""===e)return[];var n=(0,ae.chunk)(t,300);return(0,ae.map)(n,function(t){return"".concat(e).concat((0,ae.map)(t,function(e){return"&id=".concat(e)}).join(""))})});function vl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function bl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vl(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vl(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Al=(0,Ze.Mz)([er],function(e){var t=e.labels.thumbnailPaths,n=e.labels.sourcePaths,r=e.indices;return(0,ae.map)(r,function(e,r){return{index:e,thumbnailPath:t[r],srcPath:null==n?void 0:n[r]}})}),wl=(0,Ze.Mz)([rr,ar,or,Al,lr,En,An,qn,dt],function(e,t,n,r,a,o,l,i,c){var s=function(e,t){var n=!1,r=e.slice(),a=t.slice();if(r.length!==a.length)return console.error("Cannot handleNullValues between two arrays because they have unequal length"),{xValues:r,yValues:a};for(var o=0;o<r.length;o++)null===r[o]?a[o]=null:null===a[o]?r[o]=null:n=!0;return n||(r=[],a=[]),{xValues:r,yValues:a}}(e,t);return(0,ae.includes)(c,o)?{color:o===l?void 0:a,dataType:sl.GROUPED,groupSettings:i,groups:a,ids:n,x:s.xValues,y:s.yValues,customdata:r}:{color:o===l?void 0:a,dataType:sl.CONTINUOUS,ids:n,x:s.xValues,y:s.yValues,customdata:r}}),Cl=(0,Ze.Mz)([er,wn,vn,bn,Fn],function(e,t,n,r,a){return(0,ae.isEmpty)(e.values)||(0,ae.isEmpty)(e.labels)?[]:t.reduce(function(t,o){var l=o[_],i=o[x]||"",c=o[T]||"",s=e.labels[D],u=void 0!==o.index?o.index:(0,ae.findIndex)(s,function(e){return e===l}),d=e.values[n][u],f=e.values[r][u];return u>=0&&null!==d&&null!==f&&t.push({cellID:l,fovID:i,hovered:l===a,pointIndex:u,x:d,y:f,thumbnailPath:c}),t},[])}),El=(0,Ze.Mz)([wl,On,fr],function(e,t,n){var r=bl(bl({},e),{},{plotName:k});return e.dataType===sl.GROUPED&&r.dataType===sl.GROUPED&&(r.groupSettings=bl({},e.groupSettings)),{mainPlotData:r,selectedGroupPlotData:t?bl(bl({},n),{},{dataType:"continuous",plotName:"selections-scatter-plot"}):null}});function Sl(e){return function(e,t){return t.dataType===sl.GROUPED?bl(bl({},e),{},{transforms:[{groups:t.groups,nameformat:"%{group}",styles:(0,ae.map)(t.groupSettings,function(e){return{target:e.name,value:{marker:{color:e.color,opacity:V.unselectedCircleOpacity}}}}),type:"groupby"}]}):bl(bl({},e),{},{marker:bl(bl({},e.marker),{},{color:t.color,opacity:t.opacity||V.unselectedCircleOpacity})})}({hoverinfo:"none",ids:e.ids,customdata:e.customdata,marker:{size:V.circleRadius,symbol:"circle"},mode:"markers",name:e.plotName,showlegend:!1,type:"scattergl",x:e.x,y:e.y,z:[]},e)}function Dl(e){return{marker:{color:V.histogramColor,line:{color:V.textColor,width:1}},name:"x histogram",nbinsx:60,showlegend:!1,type:"histogram",x:e,yaxis:"y2"}}function kl(e){return{marker:{color:V.histogramColor,line:{color:V.textColor,width:1}},name:"y histogram",nbinsy:60,showlegend:!1,type:"histogram",xaxis:"x2",y:e}}var Pl=(0,Ze.Mz)([El],function(e){var t=e.mainPlotData,n=e.selectedGroupPlotData,r=[Dl(t.x),kl(t.y),Sl(t)];return n&&r.push(Sl(n)),r}),Ol=(0,Ze.Mz)([rt],function(e){return e}),_l=(0,Ze.Mz)([rt],function(e){return e}),xl=(0,Ze.Mz)([rt,dl],function(e){return e}),Il=(0,Ze.Mz)([rt,dl],function(e){return e.filter(function(e){return e.discrete})}),Fl=function(e){return{tickText:(0,ae.map)(e,"name"),tickValues:(0,ae.map)(e,function(e,t){return Number(t)})}},Tl=(0,Ze.Mz)([vn,rt],function(e,t){var n=he(t,e);return n&&n.discrete?Fl(n.options):{tickText:[""],tickValues:[0]}}),Nl=(0,Ze.Mz)([bn,rt],function(e,t){var n=(0,ae.find)(t,{key:e});return n&&n.discrete?Fl(n.options):{tickText:[""],tickValues:[0]}}),Bl=(0,Ze.Mz)([In,Yn],function(e,t){return e&&t.length&&void 0!==e.index?bl(bl({},e),{},(0,f.A)({},O,t[e.index])):e});const Ml={"feature-select-row":"style__feature-select-row--eh5Bh",featureSelectRow:"style__feature-select-row--eh5Bh",collapse:"style__collapse--wx7CK","interactive-legend-container":"style__interactive-legend-container--gmX26",interactiveLegendContainer:"style__interactive-legend-container--gmX26","interactive-legend-header":"style__interactive-legend-header--pn9jS",interactiveLegendHeader:"style__interactive-legend-header--pn9jS"};function jl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(jl=function(){return!!e})()}var Rl=Uo.A.Panel,Vl=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,jl()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).onBarClicked=n.onBarClicked.bind(n),n.onActivePanelChange=n.onActivePanelChange.bind(n),n.renderTaggedStructuresPanel=n.renderTaggedStructuresPanel.bind(n),n.renderSelectionPanel=n.renderSelectionPanel.bind(n),n.allOnOff=n.allOnOff.bind(n),n.onCategorySetDownloadButtonClicked=n.onCategorySetDownloadButtonClicked.bind(n),n.onSelectionSetDownloadButtonClicked=n.onSelectionSetDownloadButtonClicked.bind(n),n}return(0,K.A)(t,e),(0,h.A)(t,[{key:"onBarClicked",value:function(e){var t=e.target,n=this.props,r=n.handleFilterByCategoryName,a=n.filtersToExclude;r((0,ae.includes)(a,t.value)?(0,ae.filter)(a,function(e){return e!==t.value}):[].concat((0,Pr.A)(a),[t.value]))}},{key:"onCategorySetDownloadButtonClicked",value:function(e){(0,this.props.handleChangeDownloadSettings)({key:e,type:B})}},{key:"onSelectionSetDownloadButtonClicked",value:function(e){(0,this.props.handleChangeDownloadSettings)({key:e,type:M})}},{key:"allOnOff",value:function(e){var t=e.target,n=this.props,r=n.handleFilterByCategoryName,a=n.interactivePanelData;if(t.checked)return r([]);r(a.map(function(e){return e.id}))}},{key:"onActivePanelChange",value:function(e){(0,this.props.onPanelClicked)(e)}},{key:"renderSelectionPanel",value:function(){var e=this.props,t=e.downloadUrls,n=e.downloadConfig,r=e.downloadRoot,a=e.handleApplyColorSwitchChange,o=e.selectionSetsPanelData,l=e.handleCloseSelectionSet;return 0===o.length?g.createElement("span",null,"No selected sets yet. Make a selection on the plot using the",g.createElement("strong",null," Lasso Select")," or",g.createElement("strong",null," Box Select")," tools on the plot, and it will get saved here."):g.createElement(g.Fragment,null,g.createElement(ol,{defaultChecked:!0,handleChange:a,label:"Show selections: "}),g.createElement("div",null,g.createElement(el,{closeable:!0,hideable:!1,showTooltips:!1,handleCloseSelectionSet:l,panelData:o,downloadUrls:t,downloadConfig:n,downloadRoot:r,handleDownload:this.onSelectionSetDownloadButtonClicked})))}},{key:"renderTaggedStructuresPanel",value:function(){var e=this.props,t=e.filtersToExclude,n=e.isInIndeterminateState,r=e.interactivePanelData,a=e.downloadUrls,o=e.downloadConfig,l=e.downloadRoot,i=e.colorBy,c=e.groupBy,s=e.colorByMenuOptions,u=e.groupByDisplayOptions,d=e.handleChangeAxis,f=e.handleChangeGroupByCategory,p=e.colorForPlot,h=e.categoryCounts,m=e.categoricalFeatures,y=(0,ae.includes)(m,i)&&i!==c;return g.createElement(g.Fragment,null,g.createElement(Q.A,{className:Ml.featureSelectRow},g.createElement(Ia.A,{span:4},"Color by:"),g.createElement(Ia.A,{span:20},g.createElement(Ho,{value:i.toString(),options:s,onChange:function(e){d(P,e)},tooltip:Xn(i.toString(),s)}))),g.createElement(Q.A,{className:Ml.featureSelectRow},g.createElement(Ia.A,{span:4},"Group by:"),g.createElement(Ia.A,{span:20},g.createElement(Ho,{value:c.toString(),options:u,onChange:function(e){f(e)},tooltip:Xn(c.toString(),u)}))),g.createElement("div",{className:Ml.interactiveLegendContainer},g.createElement("div",null,g.createElement("div",{className:Ml.interactiveLegendHeader},g.createElement(to.A,{indeterminate:n,checked:0===t.length,onChange:this.allOnOff},"Show/Hide all"),g.createElement("span",{className:Ml.label},"# of cells")),g.createElement(el,{closeable:!1,showTooltips:!0,panelData:r,downloadUrls:a,downloadConfig:o,downloadRoot:l,hideable:!0,onBarClicked:this.onBarClicked,handleDownload:this.onCategorySetDownloadButtonClicked})),y&&g.createElement(Q.A,{className:Ml.featureSelectRow},g.createElement("div",{className:Ml.interactiveLegendHeader},g.createElement("div",null," Color legend "),g.createElement("span",{className:Ml.label},"# of cells")),p.map(function(e,t){return g.createElement(cl,{color:e.color,name:e.label,key:e.name,total:h[t]})}))))}},{key:"render",value:function(){var e=this.props,t=e.defaultActiveKey,n=e.openKeys,r=e.panelKeys;return g.createElement(Uo.A,{className:Ml.collapse,defaultActiveKey:t,activeKey:n,onChange:this.onActivePanelChange},g.createElement(Rl,{key:r[0],header:"Plot configuration"},this.renderTaggedStructuresPanel()),g.createElement(Rl,{key:r[1],header:"Selected sets"},this.renderSelectionPanel()))}}])}(g.Component),Ul={handleApplyColorSwitchChange:Hr.actions.toggleApplySelectionSetColors,handleChangeAxis:Hr.actions.changeAxis,handleChangeGroupByCategory:Hr.actions.changeGroupByCategory,handleChangeDownloadSettings:Hr.actions.changeDownloadSettings,handleCloseSelectionSet:Hr.actions.deselectGroupOfPoints,handleFilterByCategoryName:Hr.actions.toggleFilterByCategoryName};const zl=(0,b.Ng)(function(e){return{categoryCounts:Hr.selectors.getColorByCategoryCounts(e),colorBy:Hr.selectors.getColorBySelection(e),groupBy:Hr.selectors.getGroupByCategory(e),colorByMenuOptions:xl(e),groupByDisplayOptions:Il(e),colorForPlot:pl(e),categoricalFeatures:Dr.selectors.getCategoricalFeatureKeys(e),downloadConfig:Hr.selectors.getDownloadConfig(e),downloadUrls:gl(e),downloadRoot:Vn(e),filtersToExclude:Hr.selectors.getFiltersToExclude(e),groupByTitle:dl(e),interactivePanelData:hl(e),selectionSetsPanelData:ml(e),isInIndeterminateState:fl(e)}},Ul)(Vl);var Gl=n(28073),Ll=n(29248),Hl=n(91236);function Kl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Wl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kl(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kl(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ql(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ql=function(){return!!e})()}var Xl={color:V.textColor,domain:[.86,1],hoverformat:"f",linecolor:V.textColor,showgrid:!1,tickcolor:V.textColor,zeroline:!0},Yl=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,ql()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).makeAnnotations=n.makeAnnotations.bind(n),n.clickedAnnotation=n.clickedAnnotation.bind(n),n.resize=n.resize.bind(n),n.state={layout:{annotations:n.makeAnnotations(),autosize:!0,height:window.innerHeight-V.heightMargin,hovermode:"closest",legend:V.legend,margin:V.margin,paper_bgcolor:V.backgroundColor,plot_bgcolor:V.backgroundColor,xaxis:n.makeAxis([0,.85],".1f",!1,e.xAxisType,e.xTickConversion),xaxis2:Xl,yaxis:n.makeAxis([0,.85],".1f",!1,e.yAxisType,e.yTickConversion),yaxis2:Xl},height:window.innerHeight,showFullAnnotation:!0},n}return(0,K.A)(t,e),(0,h.A)(t,[{key:"componentDidUpdate",value:function(e,t){var n=this.props,r=n.xAxisType,a=n.yAxisType,o=n.xTickConversion,l=n.yTickConversion;o===e.xTickConversion&&l===e.yTickConversion||this.setState({layout:Wl(Wl({},this.state.layout),{},{annotations:this.makeAnnotations(),xaxis:this.makeAxis([0,.85],".1f",!1,r,o),yaxis:this.makeAxis([0,.85],".1f",!1,a,l)})}),this.state.height!==t.height&&this.setState({layout:Wl(Wl({},this.state.layout),{},{height:this.state.height-V.heightMargin})})}},{key:"resize",value:function(){this.setState(function(){return{height:window.innerHeight}})}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"clickedAnnotation",value:function(){this.setState({showFullAnnotation:!1})}},{key:"makeAxis",value:function(e,t,n,r,a){return{color:V.textColor,domain:e,hoverformat:t,linecolor:V.textColor,showgrid:!1,tickcolor:V.textColor,tickmode:r,ticktext:a.tickText,tickvals:a.tickValues,zeroline:n}}},{key:"makeAnnotations",value:function(){var e=this,t=this.props.annotations,n=function(e,t){return t?"Cell ".concat(e.cellID,"<br><i>click thumbnail in gallery<br>on the right to load in 3D</i>"):e.hovered?"Cell ".concat(e.cellID):""};return t.map(function(r,a){var o=a+1===t.length&&e.state.showFullAnnotation,l=!!o||!!r.hovered;return{align:"left",arrowcolor:r.hovered?"#7440f1":"#ffffffab",arrowhead:6,ax:0,ay:o?-60:r.hovered?-20:0,bgcolor:"#00000094",bordercolor:r.hovered?"#7440f1":"#ffffffab",borderpad:l?4:0,borderwidth:1,captureevents:!0,cellID:r.cellID,font:{color:"#ffffff",family:"tahoma, arial, verdana, sans-serif",size:11},fovID:r.fovID,pointIndex:r.pointIndex,text:n(r,o),x:r.x,y:r.y}})}},{key:"makeLayout",value:function(){var e=this.props,t=e.xAxisType,n=e.xTickConversion,r=e.yAxisType,a=e.yTickConversion,o=this.state.height;return{annotations:this.makeAnnotations(),autosize:!0,height:o-V.heightMargin,hovermode:"closest",legend:V.legend,margin:V.margin,paper_bgcolor:V.backgroundColor,plot_bgcolor:V.backgroundColor,xaxis:this.makeAxis([0,.85],".1f",!1,t,n),xaxis2:Xl,yaxis:this.makeAxis([0,.85],".1f",!1,r,a),yaxis2:Xl}}},{key:"render",value:function(){var e=this.props,t=e.onPointClicked,n=e.onPointHovered,r=e.onPointUnhovered,a=e.onGroupSelected,o=e.plotDataArray;return g.createElement(Hl.A,{data:o,useResizeHandler:!0,layout:this.state.layout,config:{responsive:!0,displayModeBar:!0,displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud","toImage","resetScale2d","hoverClosestCartesian","hoverCompareCartesian","toggleSpikelines"]},onClick:t,onClickAnnotation:this.clickedAnnotation,onHover:n,onUnhover:r,onSelected:a})}}])}(g.Component),Zl=g.forwardRef(function(e,t){return g.createElement("div",{ref:t,style:{left:"".concat(e.pageX+10,"px"),top:"".concat(e.pageY,"px"),position:"absolute"}},e.children)});Zl.displayName="MouseFollower";const Ql=Zl;var Jl=Na.A.Meta;const $l=function(e){var t=e.src?g.createElement("img",{alt:"thumbnail of microscopy image",src:e.src}):g.createElement("div",{className:"style__placeholder-container--ofudX"},g.createElement(uo.A,null));return g.createElement(Na.A,{className:"style__container--GYGx9",cover:t},g.createElement(Jl,{description:e.description,title:e.title}))};function ei(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ei=function(){return!!e})()}var ti=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,ei()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"popoverContainer",void 0),(0,f.A)(n,"thumbnailTimeout",0),n.popoverContainer=g.createRef(),n.state={cellIdToZarrThumbnailUrl:new Map},n.onPointClicked=n.onPointClicked.bind(n),n.onPointHovered=n.onPointHovered.bind(n),n.onPointUnhovered=n.onPointUnhovered.bind(n),n.onGroupSelected=n.onGroupSelected.bind(n),n.onPlotUnhovered=n.onPlotUnhovered.bind(n),n.renderPopover=n.renderPopover.bind(n),n}return(0,K.A)(t,e),(0,h.A)(t,[{key:"onPointClicked",value:function(e){var t=e.points,n=this.props,r=n.clickedPoints,a=n.handleSelectPoint,o=n.handleDeselectPoint;t.forEach(function(e){e.data.name===k&&((0,ae.includes)(r,e.id)?o(e.id):e.fullData.marker.opacity&&a({id:e.id,index:e.customdata.index}))})}},{key:"updateThumbnails",value:function(e,t){this.setState(function(n){var r=n.cellIdToZarrThumbnailUrl;r.delete(e);var a=[[e,t]].concat((0,Pr.A)(Array.from(r.entries()))).slice(0,250);return{cellIdToZarrThumbnailUrl:new Map(a)}})}},{key:"loadThumbnailForZarr",value:(n=(0,We.A)(Xe().mark(function e(t,n){var r,a;return Xe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.cellIdToZarrThumbnailUrl.has(t)){e.next=1;break}return e.abrupt("return");case 1:if(null!==this.state.cellIdToZarrThumbnailUrl.get(t)){e.next=2;break}return e.abrupt("return");case 2:if(this.updateThumbnails(t,null),!n||!n.endsWith(".zarr")){e.next=6;break}return e.prev=3,e.next=4,go(n);case 4:r=e.sent,this.updateThumbnails(t,r),e.next=6;break;case 5:e.prev=5,a=e.catch(3),console.error("Error generating thumbnail for Zarr:",a);case 6:case"end":return e.stop()}},e,this,[[3,5]])})),function(e,t){return n.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.state.cellIdToZarrThumbnailUrl.clear()}},{key:"onPointHovered",value:function(e){var t=this,n=e.points,r=e.event,a=this.props,o=a.filtersToExclude,l=a.updateMousePosition,i=a.changeHoveredPoint;l({pageX:r.pageX,pageY:r.pageY}),n.forEach(function(e){e.data.name!==k||(0,ae.includes)(o,e.fullData.name)?i(null):(window.clearTimeout(t.thumbnailTimeout),i((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},_,e.id),"index",e.customdata.index),"thumbnailPath",e.customdata.thumbnailPath),"srcPath",e.customdata.srcPath)),t.loadThumbnailForZarr(e.id,e.customdata.srcPath))})}},{key:"onPointUnhovered",value:function(){var e=this;this.thumbnailTimeout=window.setTimeout(function(){return e.props.changeHoveredPoint(null)},500)}},{key:"onPlotUnhovered",value:function(e){var t=e.relatedTarget,n=this.props.changeHoveredPoint;t.className&&n(null)}},{key:"onGroupSelected",value:function(e){if(e){var t=e.points,n=this.props,r=n.handleLassoOrBoxSelect,a=n.handleSelectionToolUsed;r(Date.now().valueOf().toString(),(0,ae.map)((0,ae.filter)(t,function(e){return e.data.name===k}),function(e){return{pointIndex:e.customdata.index,cellId:e.id}})),a()}}},{key:"renderPopover",value:function(){var e,t=this.props,n=t.hoveredPointData,r=t.galleryCollapsed,a=pe(t.thumbnailRoot,(null==n?void 0:n.thumbnailPath)||"");return!a&&null!=n&&n.CellId&&(a=null!==(e=this.state.cellIdToZarrThumbnailUrl.get(n.CellId))&&void 0!==e?e:void 0),n&&r&&g.createElement($l,{title:n[O]||"",description:n[_].toString(),src:a})}},{key:"render",value:function(){var e=this,t=this.props,n=t.annotations,r=t.plotDataArray,a=t.mousePosition,o=t.xDropDownValue,l=t.yDropDownValue,i=t.yDropDownOptions,c=t.xDropDownOptions,s=t.handleChangeAxis,u=t.yTickConversion,d=t.xTickConversion,f=t.categoricalFeatures;if(0===r.length)return null;var p=this.renderPopover();return g.createElement(g.Fragment,null,g.createElement(Ql,{ref:this.popoverContainer,pageX:a.pageX,pageY:a.pageY},g.createElement(Gl.A,{placement:"right",content:p,open:!!p,getPopupContainer:function(){return e.popoverContainer.current||document.body},id:"thumbnail-popover"})),g.createElement("div",{id:"main-plot",className:"style__container--UHk47",onMouseLeave:this.onPlotUnhovered},g.createElement(Ho,{classKey:E,value:o,options:c,onChange:function(e){s(E,e)},tooltip:Xn(o,c)}),g.createElement("div",{className:"style__glossary-link--A_hFy"},g.createElement("a",{href:"https://www.allencell.org/glossary-of-cell-features-v2.html",target:"_blank",rel:"noreferrer"},g.createElement(Ll.A,null)," Open axis glossary")),g.createElement(Ho,{classKey:S,value:l,options:i,onChange:function(e){s(S,e)},tooltip:Xn(l,i)}),g.createElement(Yl,{plotDataArray:r,onPointClicked:this.onPointClicked,annotations:n,onGroupSelected:this.onGroupSelected,onPointHovered:this.onPointHovered,onPointUnhovered:this.onPointUnhovered,xAxisType:(0,ae.includes)(f,o)?"array":"auto",yAxisType:(0,ae.includes)(f,l)?"array":"auto",yTickConversion:u,xTickConversion:d})))}}]);var n}(g.Component),ni={changeHoveredPoint:Hr.actions.changeHoveredPoint,handleChangeAxis:Hr.actions.changeAxis,handleDeselectPoint:Hr.actions.deselectPoint,handleLassoOrBoxSelect:Hr.actions.lassoOrBoxSelectGroup,handleSelectPoint:Hr.actions.selectPoint,requestCellFileInfoData:Dr.actions.requestCellFileInfoData,requestFeatureData:Dr.actions.requestFeatureData,updateMousePosition:Hr.actions.changeMousePosition};const ri=(0,b.Ng)(function(e){return{annotations:Cl(e),clickedPoints:Hr.selectors.getClickedScatterPoints(e),categoricalFeatures:Dr.selectors.getCategoricalFeatureKeys(e),filtersToExclude:Hr.selectors.getFiltersToExclude(e),galleryCollapsed:Hr.selectors.getGalleryCollapsed(e),hoveredPointData:Bl(e),mousePosition:Hr.selectors.getMousePosition(e),plotDataArray:Pl(e),thumbnailRoot:Hr.selectors.getThumbnailRoot(e),xDropDownOptions:Ol(e),xDropDownValue:Hr.selectors.getPlotByOnX(e),xTickConversion:Tl(e),yDropDownOptions:_l(e),yDropDownValue:Hr.selectors.getPlotByOnY(e),yTickConversion:Nl(e)}},ni)(ti);function ai(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ai=function(){return!!e})()}var oi=W.A.Content,li=W.A.Sider,ii=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,ai()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"state",{defaultActiveKey:[t.panelKeys[0]],openKeys:[t.panelKeys[0]],width:window.innerWidth}),(0,f.A)(e,"onSelectionToolUsed",function(){e.setState({openKeys:(0,ae.uniq)([].concat((0,Pr.A)(e.state.openKeys),[t.panelKeys[1]]))})}),(0,f.A)(e,"onPanelClicked",function(t){e.setState({openKeys:t})}),e}return(0,K.A)(t,e),(0,h.A)(t,[{key:"render",value:function(){var e=this.state,n=e.openKeys,r=e.defaultActiveKey;return g.createElement(W.A,null,g.createElement(li,{className:"style__color-menu--BxPlR",width:500,collapsible:!1,collapsedWidth:250},g.createElement(zl,{panelKeys:t.panelKeys,openKeys:n,defaultActiveKey:r,onPanelClicked:this.onPanelClicked})),g.createElement(oi,{className:"style__content--Akt8J"},g.createElement("div",null,g.createElement(ri,{handleSelectionToolUsed:this.onSelectionToolUsed}))))}}])}(g.Component);(0,f.A)(ii,"panelKeys",["groupings","selections"]);const ci=ii;var si=n(40961);const ui=function(e){var t=e.aligned,n=e.setAligned,r=e.parent;return(0,si.createPortal)(g.createElement(g.Fragment,null,g.createElement("span",{className:"viewer-toolbar-group"},g.createElement("span",null,"Alignment"),g.createElement(po.A,{title:"For the associated publication, single cell images were aligned before feature extraction. The apical basal axis of the cell (which is the z-axis in the lab frame of reference) was preserved and we aligned the cells by rotation in the xy-plane. Cells and nuclei are rotated such that the longest cell axis falls along the x-axis.",placement:"bottom"},g.createElement(Ll.A,null))),g.createElement("span",{className:"viewer-toolbar-group"},g.createElement(lo.Ay.Group,{value:t,onChange:function(e){var t=e.target;return n(t.value)}},g.createElement(po.A,{title:"Turn off alignment",placement:"bottom"},g.createElement(lo.Ay.Button,{key:0,value:!1},"Off")),g.createElement(po.A,{title:"Turn on alignment",placement:"bottom"},g.createElement(lo.Ay.Button,{key:1,value:!0},"On"))))),r)};function di(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fi(e,t){var n,r=t.unit,a=t.discrete;return null==e?"".concat(e):a?t.options?"".concat(null===(n=t.options[e.toString()])||void 0===n?void 0:n.name):e.toString():r&&!["unitless","stage"].includes(r)?"".concat(e," ").concat({degrees:"deg"}[r]||r):"".concat(e)}var pi=(0,Ze.Mz)([dr,rt],function(e,t){var n,r={},a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return di(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?di(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,l=e[o.key];r[o.displayName]=fi(l,o)}}catch(e){a.e(e)}finally{a.f()}return{metadata:r}}),hi=(0,Ze.Mz)([cr,Un,Vn,ot,zn,pi],function(e,t,n,r,a,o){var l,i;if((0,ae.isEmpty)(e))return{};var c=e.CellId,s="",u="",d="",f="";return e.volumeviewerPath?(s=e.volumeviewerPath,d=fe(n,de(e?e.CellId:"")),e.fovVolumeviewerPath&&(u=e.fovVolumeviewerPath,f=fe(n,ue(e?e.FOVId:"")))):(s=e.fovVolumeviewerPath,c=e.FOVId,d=fe(n,ue(e?e.FOVId:""))),""===t||t.endsWith("/")||(t+="/"),{cellId:c,baseUrl:t,cellPath:s,fovPath:u,cellDownloadHref:d,fovDownloadHref:f,transform:a?e.transform:void 0,metadata:o.metadata,viewerChannelSettings:r,appProps:null===(l=e.voleUrlParams)||void 0===l?void 0:l.args,viewerSettings:null===(i=e.voleUrlParams)||void 0===i?void 0:i.viewerSettings}}),mi=(0,Ze.Mz)([cr,Hn],function(e,t){var n="",r="";return(0,ae.isEmpty)(e)?{cellId:"",label:n,value:r}:{cellId:e.volumeviewerPath?e.CellId:e.FOVId,label:n=t.displayName,value:r=e[O]||""}});const yi={hidden:"style__hidden--Yt5Mb",content:"style__content--Qbl_8",blur:"style__blur--hXBmU",header:"style__header--sNdkU",alert:"style__alert--etQWL","header-main":"style__header-main--QL9nX",headerMain:"style__header-main--QL9nX","viewer-menu-bar":"style__viewer-menu-bar--kpkWV",viewerMenuBar:"style__viewer-menu-bar--kpkWV","viewer-title-container":"style__viewer-title-container--j1Clp",viewerTitleContainer:"style__viewer-title-container--j1Clp","viewer-title":"style__viewer-title--eb2aw",viewerTitle:"style__viewer-title--eb2aw",label:"style__label--LPNpV",sider:"style__sider--ECAaP","tabbed-menu":"style__tabbed-menu--j4E0E",tabbedMenu:"style__tabbed-menu--j4E0E","plot-icon":"style__plot-icon--D0Ck4",plotIcon:"style__plot-icon--D0Ck4","cube-icon":"style__cube-icon--twFXq",cubeIcon:"style__cube-icon--twFXq"};function gi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(gi=function(){return!!e})()}var vi=W.A.Content,bi=W.A.Sider,Ai="plot",wi="3d-viewer",Ci=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,gi()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"alignContainer",document.createElement("span")),(0,f.A)(e,"state",{defaultActiveKey:[t.panelKeys[0]],dontShowSmallScreenWarningAgain:!1,openKeys:[t.panelKeys[0]],width:window.innerWidth,currentTab:Ai,controlPanelCollapsed:!1}),(0,f.A)(e,"componentDidMount",function(){e.props.setShowSmallScreenWarning(window.innerWidth<=768),window.addEventListener("resize",e.updateDimensions)}),(0,f.A)(e,"componentDidUpdate",function(t,n){var r,a=e.state.currentTab;e.props.showAlignControl&&(e.alignContainer.style.setProperty("display","flex"),e.alignContainer.style.setProperty("text-wrap","nowrap"),e.alignContainer.style.setProperty("margin-right","6px"),null===(r=document.querySelector(".viewer-toolbar-left"))||void 0===r||r.prepend(e.alignContainer)),n.currentTab!==a&&a===wi&&window.dispatchEvent(new Event("resize"))}),(0,f.A)(e,"updateDimensions",function(){if(window.innerWidth!==e.state.width){var t=window.innerWidth<=768&&!e.state.dontShowSmallScreenWarningAgain;e.setState({width:window.innerWidth}),e.props.setShowSmallScreenWarning(t)}}),(0,f.A)(e,"onSelectionToolUsed",function(){e.setState({openKeys:(0,ae.uniq)([].concat((0,Pr.A)(e.state.openKeys),[t.panelKeys[1]]))})}),(0,f.A)(e,"onPanelClicked",function(t){e.setState({openKeys:t})}),(0,f.A)(e,"onControlPanelToggle",function(t){e.setState({controlPanelCollapsed:t})}),(0,f.A)(e,"handleClose",function(){e.props.setShowSmallScreenWarning(!1),e.props.requestFeatureData()}),(0,f.A)(e,"onDismissCheckboxChecked",function(t){e.setState({dontShowSmallScreenWarningAgain:t})}),(0,f.A)(e,"handleTabClick",function(t){e.setState({currentTab:t.key})}),e}return(0,K.A)(t,e),(0,h.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.galleryCollapsed,r=t.toggleGallery,a=t.showSmallScreenWarning,o=t.viewerHeader,l=this.state,i=l.currentTab,c=l.controlPanelCollapsed,s=Z()([yi.content,(0,f.A)({},yi.hidden,i!==wi)]),u=Z()([yi.content,(0,f.A)({},yi.hidden,i===wi)]),d=[{label:g.createElement(g.Fragment,null,g.createElement("span",{className:Z()(["icon-moon","anticon",yi.plotIcon])}),"Plot"),key:Ai},{label:g.createElement(g.Fragment,null,g.createElement("span",{className:Z()(["icon-moon","anticon",yi.cubeIcon])}),"3D Viewer"),key:wi}],p=g.createElement(W.A,null,g.createElement(W.A,{className:n?yi.noBlur:yi.blur},g.createElement(Qa.Y9,{style:{margin:"0",padding:"0",width:"100%"}},g.createElement("div",{className:c?Z()([yi.viewerMenuBar,yi.viewerMenuBarCollapsed]):yi.viewerMenuBar},g.createElement(X.Ay,{theme:{token:{colorPrimary:"#fff",colorSplit:"transparent"}}},g.createElement(Za.A,{className:yi.tabbedMenu,onClick:this.handleTabClick,selectedKeys:[this.state.currentTab],mode:"horizontal",items:d})),g.createElement("div",{className:yi.viewerTitleContainer},g.createElement("p",{className:yi.viewerTitle,style:this.state.currentTab!==wi?{display:"none"}:{}},g.createElement("span",{className:yi.label},"Viewing cell: "),this.props.viewerHeader.cellId,g.createElement("span",{className:yi.label},", ",o.label,": "),this.props.viewerHeader.value)))),g.createElement(W.A,null,g.createElement(no,{handleClose:this.handleClose,onDismissCheckboxChecked:this.onDismissCheckboxChecked,visible:a}),g.createElement(vi,{className:u},g.createElement(ci,null)),g.createElement(vi,{className:s},g.createElement($a,(0,Ta.A)({onControlPanelToggle:this.onControlPanelToggle},this.props.volumeViewerProps)),this.props.showAlignControl&&g.createElement(ui,{parent:this.alignContainer,aligned:this.props.alignActive,setAligned:this.props.setAlignActive})))),g.createElement(bi,{style:{right:"0",width:"100px",position:"absolute",backgroundColor:G.galleryBackground},width:"100%",collapsible:!0,collapsed:n,onCollapse:r,defaultCollapsed:!0,collapsedWidth:100,className:yi.sider,reverseArrow:!0},g.createElement(Vo,{collapsed:n,toggleGallery:r,openViewerTab:function(){return e.setState({currentTab:wi})}})));return g.createElement(X.Ay,{theme:{components:{Layout:{headerHeight:56},Checkbox:{colorPrimary:G.mediumDarkGray,colorPrimaryHover:G.mediumGray}}}},p)}}])}(g.Component);(0,f.A)(Ci,"panelKeys",["groupings","selections"]);var Ei={toggleGallery:Hr.actions.toggleGallery,setShowSmallScreenWarning:Dr.actions.setShowSmallScreenWarning,requestFeatureData:Dr.actions.requestFeatureData,setAlignActive:Hr.actions.setAlignActive};const Si=(0,b.Ng)(function(e){return{galleryCollapsed:Hr.selectors.getGalleryCollapsed(e),volumeViewerProps:hi(e),thumbnailRoot:Hr.selectors.getThumbnailRoot(e),showSmallScreenWarning:Dr.selectors.getShowSmallScreenWarning(e),viewerHeader:mi(e),showAlignControl:Hr.selectors.getSelected3DCellHasTransform(e),alignActive:Hr.selectors.getAlignActive(e)}},Ei)(Ci),Di=function(e){var t=e.isLoading,n=e.loadingText;return t?g.createElement("div",{className:"style__container--JMiFX"},g.createElement("p",{className:"loading-icon"},ee),g.createElement("p",{className:"loading-text"},n||"Loading data...")):null},ki="style__is-loading--LzhrV";function Pi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Pi=function(){return!!e})()}var Oi=W.A.Header,_i={algorithm:q.A.darkAlgorithm,token:{colorPrimary:G.purple,colorBgBase:G.darkGray,colorTextHeading:G.white,fontWeightStrong:600,borderRadius:4,borderRadiusSM:4,borderRadiusLG:4,colorLink:G.brightBlue,colorLinkHover:G.linkHover,colorIcon:G.white,colorBgElevated:G.darkGray},components:{Button:{colorPrimary:G.purple,primaryShadow:"0 0px 0 transparent",defaultShadow:"0 0px 0 transparent"},Checkbox:{borderRadiusSM:2},Collapse:{contentBg:G.collapseContentGray,headerBg:G.collapseHeaderGray},Layout:{headerBg:G.headerGray,headerColor:G.white,siderBg:G.collapseContentGray},Modal:{contentBg:G.extraLightGray,headerBg:G.extraLightGray,colorIcon:G.mediumGray},Menu:{colorBgElevated:G.darkGray},Select:{colorTextQuaternary:G.white},Slider:{trackBg:G.lightGray,trackHoverBg:G.extraLightGray,handleColor:G.white,dotActiveBorderColor:G.white,handleActiveColor:G.white,colorPrimaryBorderHover:G.white},Tooltip:{colorBgSpotlight:"rgba(0, 0, 0, 0.85)"}}},xi=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,Pi()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"componentDidMount",function(){if(e.props.csvUrl)try{(function(e){return jr.apply(this,arguments)})(e.props.csvUrl).then(e.props.loadCsvDataset)}catch(e){window.alert("Could not load CSV dataset from URL. See browser console for details."),console.error("Error loading CSV dataset from URL:",e)}e.props.requestAvailableDatasets()}),(0,f.A)(e,"handleSelectDataset",function(t){e.props.changeDataset(t)}),e}return(0,K.A)(t,e),(0,h.A)(t,[{key:"render",value:function(){var e=this.props,t=e.isLoading,n=e.loadingText,r=e.selectedDataset,a=e.megasets,o=t&&!!r,l=Z()(["style__container--_3WDP",(0,f.A)({},ki,o)]);return g.createElement(X.Ay,{theme:_i},g.createElement("div",{className:Z()(["style__wrapper--wsMnE",(0,f.A)({},ki,o)])},g.createElement(W.A,{className:l},g.createElement(Di,{isLoading:o,loadingText:n}),g.createElement(Oi,{className:"style__nav-bar--q7jPo"},g.createElement(re,{selectedDataset:r})),g.createElement(W.A,null,r?g.createElement(Si,null):g.createElement(Ya,{megasets:a,handleSelectDataset:this.handleSelectDataset})))))}}])}(g.Component),Ii={changeDataset:Hr.actions.changeDataset,requestAvailableDatasets:Dr.actions.requestAvailableDatasets,loadCsvDataset:xa.actions.loadCsvDataset};const Fi=(0,b.Ng)(function(e){return{isLoading:Dr.selectors.getIsLoading(e),loadingText:Dr.selectors.getLoadingText(e),selectedDataset:Hr.selectors.getSelectedDataset(e),megasets:Dr.selectors.getMegasetsByNewest(e),csvUrl:Hr.selectors.getCsvUrl(e)}},Ii)(xi);var Ti=n(14644),Ni=n(21852);function Bi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Mi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bi(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bi(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ji=function(e){var t=e.slice(0,5);return e.length>5&&t.push("...and ".concat(e.length-5," more")),t},Ri=function(e){return{indices:ji(e.indices),values:(0,ae.mapValues)(e.values,ji),labels:(0,ae.mapValues)(e.labels,ji)}},Vi=function(e){return e.type===ye?Mi(Mi({},e),{},{payload:Ri(e.payload)}):e.type===ce?Mi(Mi({},e),{},{payload:e.payload.map(Vi)}):e},Ui=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;Ui?Ui({actionSanitizer:Vi,stateSanitizer:function(e){return Mi(Mi({},e),{},{metadata:Mi(Mi({},e.metadata),{},{featureData:Ri(e.metadata.featureData)})})}}):Ti.Zz;var zi={metadata:Dr.reducer,selection:Hr.reducer,imageDataset:xa.reducer},Gi=[].concat((0,Pr.A)(Dr.logics),(0,Pr.A)(Hr.logics),(0,Pr.A)(xa.logics)),Li={httpClient:Ca.A},Hi=Object.freeze({metadata:Sr,selection:xr,imageDataset:_a});function Ki(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Wi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ki(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ki(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var qi=function(){return(0,h.A)(function e(t){(0,p.A)(this,e),this.history=t},[{key:"getParams",value:function(){return function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],o=e[a];("string"==typeof o||Array.isArray(o)&&"string"==typeof o[0])&&(t[a]=o)}return t}((0,y.parse)(this.history.location.search,{ignoreQueryPrefix:!0}))}},{key:"pushParams",value:function(e){this.history.push(Wi(Wi({},this.history.location),{},{search:(0,y.stringify)(e)}))}},{key:"pushParam",value:function(e,t){this.pushParams(Wi(Wi({},this.getParams()),{},(0,f.A)({},e,t)))}},{key:"replaceParams",value:function(e){this.history.replace(Wi(Wi({},this.history.location),{},{search:(0,y.stringify)(e)}))}},{key:"onParamRemoved",value:function(e,t){var n=!1;this.history.listen(function(r){(0,y.parse)(r.search,{ignoreQueryPrefix:!0})[e]?n=!0:n&&(t(),n=!1)})}}])}(),Xi=new qi((0,m.zR)()),Yi=function(e){var t=(0,Ni.A)(Gi);t.addDeps(Li);var n=(0,Ti.Tw)(t),r=function(e,t){return function n(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=arguments.length>1?arguments[1]:void 0;return function(e){return e&&e.batch&&Array.isArray(e.payload)}(a)?a.payload.reduce(n,r):e(r,a)}}((0,Ti.HY)(zi),Hi);if(e){var a=(0,ae.merge)({},Hi,e);return(0,Ti.y$)(r,a,n)}return(0,Ti.y$)(r,n)}({selection:Wi(Wi({},xr),Br.toAppState(Xi.getParams()))});Yi.dispatch(Hr.actions.syncStateWithURL(Xi.getParams())),Xi.onParamRemoved("dataset",function(){Yi.dispatch(Hr.actions.clearDataset()),Yi.dispatch(Dr.actions.clearDatasetValues())}),Yi.subscribe(function(){var e=Yi.getState(),t=Br.toUrlSearchParameterMap(e.selection),n=Xi.getParams();Br.paramChanged(Nr.dataset,t,n)&&Xi.pushParam(Nr.dataset,t.dataset),Br.paramsChanged(t,n)&&Xi.replaceParams(t)});var Zi=document.getElementById(C);null===Zi?console.error("App container (#".concat(C,") missing!")):(0,v.H)(Zi).render(g.createElement(b.Kq,{store:Yi},g.createElement(Fi,null)))},56266:()=>{},56504:()=>{}},e=>{e.O(0,[962,617,333],()=>e(e.s=46987)),e.O()}]);