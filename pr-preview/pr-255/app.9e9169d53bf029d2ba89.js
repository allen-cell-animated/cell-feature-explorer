(self.webpackChunkcell_feature_explorer=self.webpackChunkcell_feature_explorer||[]).push([[283,524],{6580:()=>{},28625:()=>{},30626:(e,t,n)=>{"use strict";var r={};n.r(r),n.d(r,{changeAxis:()=>rt,changeDataset:()=>At,changeDownloadSettings:()=>mt,changeGroupByCategory:()=>at,changeHoveredPoint:()=>yt,changeMousePosition:()=>ht,clearAllSelectedPoints:()=>st,clearDataset:()=>wt,deselectGroupOfPoints:()=>lt,deselectPoint:()=>it,lassoOrBoxSelectGroup:()=>ot,receiveFileInfoDataForCell:()=>Et,requestCellFileInfoByArrayOfCellIds:()=>Dt,requestCellFileInfoByCellId:()=>St,selectAlbum:()=>vt,selectCellFor3DViewer:()=>dt,selectPoint:()=>ct,setAlignActive:()=>kt,setCsvUrl:()=>Ct,setHoveredGalleryCard:()=>gt,syncStateWithURL:()=>ft,toggleApplySelectionSetColors:()=>pt,toggleFilterByCategoryName:()=>ut,toggleGallery:()=>bt});var a={};n.r(a),n.d(a,{clearDatasetValues:()=>fn,receiveAlbumData:()=>bn,receiveAvailableDatasets:()=>dn,receiveDataForPlot:()=>mn,receiveFileInfoData:()=>pn,receiveMeasuredFeatureDefs:()=>hn,receiveViewerChannelSettings:()=>wn,requestAlbumData:()=>vn,requestAvailableDatasets:()=>un,requestCellFileInfoData:()=>yn,requestFeatureData:()=>gn,requestViewerChannelSettings:()=>An,setLoadingText:()=>En,setShowSmallScreenWarning:()=>Sn,stopLoading:()=>Cn});var o={};n.r(o),n.d(o,{getAllAlbumData:()=>Pn,getCategoricalFeatureKeys:()=>Vn,getDatasets:()=>Bn,getFileInfo:()=>Fn,getIsLoading:()=>On,getLabelsPerCell:()=>Rn,getLoadingText:()=>xn,getMeasuredFeatureArrays:()=>Mn,getMeasuredFeaturesDefs:()=>Tn,getMeasuredFeaturesKeys:()=>Un,getMegasets:()=>In,getMegasetsByNewest:()=>jn,getMitoticKeyPerCell:()=>Gn,getMitoticStageNames:()=>zn,getPerCellDataForPlot:()=>kn,getShowSmallScreenWarning:()=>_n,getViewerChannelSettings:()=>Nn});var l={};n.r(l),n.d(l,{getImageDataset:()=>Ln});var i={};n.r(i),n.d(i,{getAlignActive:()=>Cr,getApplyColorToSelections:()=>sr,getCategoryGroupColorsAndNames:()=>Or,getClickedCellsFileInfo:()=>nr,getClickedScatterPoints:()=>Gr,getColorByCategoryCounts:()=>Nr,getColorBySelection:()=>ar,getCsvUrl:()=>Sr,getDefaultColors:()=>or,getDownloadConfig:()=>ur,getDownloadRoot:()=>Ar,getFeatureDefTooltip:()=>xr,getFilteredCellData:()=>Br,getFilteredColorByValues:()=>zr,getFilteredIds:()=>Vr,getFilteredMeasuredValues:()=>jr,getFilteredPerCellLabels:()=>Mr,getFilteredXValues:()=>Rr,getFilteredYValues:()=>Ur,getFiltersToExclude:()=>ir,getGalleryCollapsed:()=>hr,getGroupByCategory:()=>tr,getGroupByFeatureDef:()=>Dr,getGroupByFeatureOptionsAsList:()=>kr,getGroupingCategoryNames:()=>Pr,getGroupingCategoryNamesAsArray:()=>_r,getHoveredCardId:()=>pr,getHoveredPointData:()=>fr,getMeasuredValues:()=>Ir,getMousePosition:()=>dr,getPlotByOnX:()=>$n,getPlotByOnY:()=>er,getSelected3DCell:()=>cr,getSelected3DCellFOV:()=>Hr,getSelected3DCellFeatureData:()=>Wr,getSelected3DCellFileInfo:()=>Lr,getSelected3DCellHasTransform:()=>Kr,getSelectedAlbum:()=>mr,getSelectedAlbumFileInfo:()=>br,getSelectedDataset:()=>yr,getSelectedDatasetName:()=>Er,getSelectedGroupKeys:()=>Xr,getSelectedGroups:()=>rr,getSelectedGroupsData:()=>qr,getSelectedIdsFromUrl:()=>vr,getSelectedSetTotals:()=>Yr,getSelectionSetColors:()=>lr,getThumbnailRoot:()=>gr,getVolumeViewerDataRoot:()=>wr,getXValues:()=>Tr,getYValues:()=>Fr});var c={};n.r(c);var s={};n.r(s),n.d(s,{changeImageDatasetType:()=>ea,loadCsvDataset:()=>ta});var u={};n.r(u);var d={};n.r(d);var f=n(64467),p=n(23029),m=n(92901),h=(n(22913),n(51298),n(10743),n(30502)),y=n(55373),g=n(96540),v=n(5338),b=n(71468);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var C="cell-feature-explorer",E="plotByOnX",S="plotByOnY",D="cellIds",k="features-scatter-plot",P="colorBy",O="groupBy",x="CellId",_="FOVId",I="fovThumbnailPath",T="fovVolumeviewerPath",F="thumbnailPath",N="volumeviewerPath",B=(Object.freeze([x,_,O,F,N,I,T]),"protein"),j="selectionSet",M="interphase-and-mitotic-stages",R="#6e6e6e",U={backgroundColor:"rgba(0,0,0,0)",cellName:x,chartParent:"ace-scatter-chart",circleRadius:4,histogramColor:"rgb(164,162,164)",legend:{font:{color:"rgb(255,255,255)"},orientation:"h",y:60},margin:{b:50,l:60,r:40,t:10},moveDropdownCutoffWidth:370,heightMargin:270,showLegendCutoffHeight:635,showLegendCutoffWidth:692,textColor:"rgb(255,255,255)",unselectedCircleOpacity:.5},V="Direct download is not available for this dataset.",z={purple:"#8950d9",darkGray:"#313131",mediumDarkGray:"#4b4b4b",mediumGray:"#6e6e6e",lightGray:"#a0a0a0",extraLightGray:"#d8d8d8",brightGreen:"#b2d030",brightBlue:"#00a0ff",white:"#ffffff"},G=w(w({},z),{},{headerGray:z.mediumDarkGray,collapseHeaderGray:"#464646",collapseContentGray:z.darkGray,galleryBackground:z.mediumDarkGray+"d1",linkHover:z.brightBlue}),L=n(56822),H=n(53954),K=n(85501),W=n(6406),q=n(5131),X=n(20867),Y=n(46942),Z=n.n(Y),Q=n(47152),J=n(93567);const $=n.p+"5ddc2961aa2dc5a828bc.png";var ee=g.createElement(J.A,{style:{fontSize:40},spin:!0}),te=g.createElement("img",{src:$,style:{width:"140px"},alt:"Allen Institute for Cell Science"});var ne=n(10467),re=n(5544),ae=n(54756),oe=n.n(ae),le=n(77028),ie=n(92941),ce=n(704),se=n(86336),ue=n(50770),de=n(34716),fe=n(28392),pe=n(17286),me=n(67956),he=n(2543),ye=/^https?:\/\//;function ge(e,t){return"".concat(C,"/").concat(e.toUpperCase(),"/").concat(t.toUpperCase())}function ve(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=arguments.length>1?arguments[1]:void 0,a=e[r.type];return a&&a.accepts(r)?a.perform(n,r):n}}var be=ge("batch","batch-actions");function Ae(e){return{type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:be,batch:!0,payload:e}}function we(e){return isNaN(Number(e))?e:"F".concat(e)}function Ce(e){return isNaN(Number(e))?e:"C".concat(e)}function Ee(e,t){return""===e?"":"".concat(e,"&id=").concat(t)}function Se(e,t){return ye.test(t)?t:e&&t?"".concat(e,"/").concat(t):""}function De(e,t){return(0,he.find)(e,{key:t})}function ke(e,t){if(!t)return"";if(!e.options)return""+t;var n=e.options[t];return n.key||n.name}var Pe=function(e){return ge("selection",e)},Oe=Pe("deselect-file"),xe=Pe("change-group-by-category"),_e=Pe("select_group"),Ie=Pe("deselect-point"),Te=Pe("select-point"),Fe=Pe("deselect-all-points"),Ne=Pe("toggle-filter-by-category-name"),Be=Pe("open-cell-in-3d"),je=Pe("apply-selection-set-color"),Me=Pe("deselect-group"),Re=Pe("set-download-config"),Ue=Pe("set-mouse-position"),Ve=Pe("sync-with-url"),ze=Pe("change-hovered-point"),Ge=Pe("change-hovered-gallery-card"),Le=Pe("change-selected-album"),He=Pe("toggle-gallery"),Ke=Pe("set-align-active"),We=Pe("REQUEST_CELL_FILE_INFO_BY_CELL_ID"),qe=Pe("RECEIVE_CELL_FILE_INFO"),Xe=Pe("RECEIVE_SELECTED_FILE_INFO"),Ye=Pe("RECEIVE_FILE_INFO_FOR_ALBUM_CELLS"),Ze=Pe("SELECT_ARRAY_OF_POINTS"),Qe=Pe("RECEIVE_FILE_INFO_FOR_SELECTED_ARRAY_OF_CELLS"),Je=Pe("set-dataset"),$e=Pe("change-dataset"),et=Pe("clear-dataset"),tt=Pe("set-csv-url"),nt=["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"];function rt(e,t){return{axisId:e,payload:t,type:Oe}}function at(e){return{payload:e,type:xe}}function ot(e,t){return{key:e,payload:t,type:_e}}function lt(e){return{payload:e,type:Me}}function it(e){return{payload:e,type:Ie}}function ct(e){return{payload:e,type:Te}}function st(){return{type:Fe}}function ut(e){return{payload:e,type:Ne}}function dt(e){return{payload:e,type:Be}}function ft(e){return{payload:e,type:Ve}}function pt(e){return{payload:e,type:je}}function mt(e){return{payload:e,type:Re}}function ht(e){return{payload:e,type:Ue}}function yt(e){return{payload:e,type:ze}}function gt(e){return{payload:e,type:Ge}}function vt(e){return{payload:e,type:Le}}function bt(e){return{payload:e,type:He}}function At(e){return{payload:e,type:$e}}function wt(){return{type:et}}function Ct(e){return{payload:e,type:tt}}function Et(e){return{payload:e,type:qe}}function St(e){return{payload:e,type:We}}function Dt(e){return{payload:e,type:Ze}}function kt(e){return{payload:e,type:Ke}}var Pt,Ot=n(14534),xt=n(60436);function _t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_t(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Tt={applySelectionSetColoring:!0,cellSelectedFor3D:"",colorBy:"",dataset:"",csvUrl:"",downloadConfig:{key:"",type:""},filterExclude:[],galleryCollapsed:!0,hoveredCardId:"",hoveredPointData:null,mousePosition:{pageX:0,pageY:0},plotByOnX:"",plotByOnY:"",groupBy:"",defaultColors:["#bbcd22","#ff9900","#FFEE1E","#FD92B6","#33a02c","#F07C4C","#c26cff","#f0486e","#0099ff","#ffc35c","#33ffff","#ff6633","#a6cee3","#cab2d6","#b15928","#e8af39","#537eff","#61d900","#ff8ae8","#FF4d4d","#c26cff","#aeaeae","#ff44ff","#6a3d9a","#ffff99","#ff00de","#24bcfa","#84df11","#ecc560","#ff72ff","#f58117","#f8311b","#5791db","#11a89a","#a70009","#ff6200","#fddb02","#f7db78","#f9a558"],selectedAlbum:0,selectedAlbumFileInfo:[],selectedGroupColors:{},selectedGroups:{},selectedPoints:[],initSelectedPoints:[],thumbnailRoot:"",downloadRoot:"",volumeViewerDataRoot:"",alignActive:!1};const Ft=ve((Pt={},(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)(Pt,Je,{accepts:function(e){return e.type===Je},perform:function(e,t){return It(It({},e),{},{dataset:t.payload.dataset,thumbnailRoot:t.payload.thumbnailRoot,downloadRoot:t.payload.downloadRoot,volumeViewerDataRoot:t.payload.volumeViewerDataRoot})}}),et,{accepts:function(e){return e.type===et},perform:function(){return It({},Tt)}}),tt,{accepts:function(e){return e.type===tt},perform:function(e,t){return It(It({},e),{},{csvUrl:t.payload})}}),Oe,{accepts:function(e){return e.type===Oe},perform:function(e,t){return It(It({},e),{},(0,f.A)({},t.axisId,t.payload))}}),xe,{accepts:function(e){return e.type===xe},perform:function(e,t){return It(It({},e),{},{groupBy:t.payload})}}),Be,{accepts:function(e){return e.type===Be},perform:function(e,t){return It(It({},e),{},{cellSelectedFor3D:t.payload.id})}}),_e,{accepts:function(e){return e.type===_e},perform:function(e,t){return It(It({},e),{},{selectedGroupColors:It(It({},e.selectedGroupColors),{},(0,f.A)({},t.key,nt.splice(0,1)[0])),selectedGroups:It(It({},e.selectedGroups),{},(0,f.A)({},t.key,t.payload))})}}),Me,{accepts:function(e){return e.type===Me},perform:function(e,t){return It(It({},e),{},{selectedGroupColors:(0,he.pickBy)(e.selectedGroupColors,function(e,n){return n.toString()!==t.payload.toString()}),selectedGroups:(0,he.pickBy)(e.selectedGroups,function(e,n){return n.toString()!==t.payload.toString()})})}}),Ie,{accepts:function(e){return e.type===Ie},perform:function(e,t){return It(It({},e),{},{selectedPoints:(0,he.filter)(e.selectedPoints,function(e){return e.CellId!==t.payload})})}}),Fe,{accepts:function(e){return e.type===Fe},perform:function(e){return It(It({},e),{},{selectedPoints:(0,xt.A)(Tt.selectedPoints)})}}),(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)(Pt,Ne,{accepts:function(e){return e.type===Ne},perform:function(e,t){return It(It({},e),{},{filterExclude:t.payload})}}),je,{accepts:function(e){return e.type===je},perform:function(e,t){return It(It({},e),{},{applySelectionSetColoring:t.payload})}}),Re,{accepts:function(e){return e.type===Re},perform:function(e,t){return It(It({},e),{},{downloadConfig:t.payload})}}),Ue,{accepts:function(e){return e.type===Ue},perform:function(e,t){return It(It({},e),{},{mousePosition:t.payload})}}),ze,{accepts:function(e){return e.type===ze},perform:function(e,t){return It(It({},e),{},{hoveredPointData:t.payload})}}),Ge,{accepts:function(e){return e.type===Ge},perform:function(e,t){return It(It({},e),{},{hoveredCardId:t.payload})}}),Le,{accepts:function(e){return e.type===Le},perform:function(e,t){return It(It({},e),{},{selectedAlbum:t.payload})}}),He,{accepts:function(e){return e.type===He},perform:function(e,t){return It(It({},e),{},{galleryCollapsed:t.payload})}}),Xe,{accepts:function(e){return e.type===Xe},perform:function(e,t){return It(It({},e),{},{selectedPoints:(0,he.uniqBy)([].concat((0,xt.A)(e.selectedPoints),[t.payload]),x)})}}),Qe,{accepts:function(e){return e.type===Qe},perform:function(e,t){return It(It({},e),{},{selectedPoints:(0,he.uniqBy)([].concat((0,xt.A)(e.selectedPoints),(0,xt.A)(t.payload)),x)})}}),(0,f.A)((0,f.A)(Pt,Ye,{accepts:function(e){return e.type===Ye},perform:function(e,t){return It(It({},e),{},{selectedAlbumFileInfo:t.payload})}}),Ke,{accepts:function(e){return e.type===Ke},perform:function(e,t){return It(It({},e),{},{alignActive:t.payload})}})),Tt);function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var jt=function(e){return e.cellSelectedFor3D="cellSelectedFor3D",e.colorBy="colorBy",e.dataset="dataset",e.plotByOnX="plotByOnX",e.plotByOnY="plotByOnY",e.selectedPoint="selectedPoint",e.selectedAlbum="selectedAlbum",e.galleryCollapsed="galleryCollapsed",e.csvUrl="csvUrl",e}({}),Mt=function(){function e(){(0,p.A)(this,e)}return(0,m.A)(e,null,[{key:"toAppState",value:function(t){return(0,he.reduce)(t,function(n,r,a){if(e.urlParamToStateMap.hasOwnProperty(a)){var o=e.urlParamToStateMap[a](r,t);return(0,he.mergeWith)({},n,o,function(e,t){if(Array.isArray(e))return e.concat(t)})}return n},{})}},{key:"paramChanged",value:function(e,t,n){return!(0,he.isEqual)(n[e],t[e])}},{key:"paramsChanged",value:function(e,t){return!(0,he.isEqual)(t,e)}},{key:"toReduxActions",value:function(t){return(0,he.reduce)(t,function(n,r,a){if(e.urlParamToActionCreatorMap.hasOwnProperty(a)){var o=e.urlParamToActionCreatorMap[a](r,t);if(o)return[].concat((0,xt.A)(n),(0,xt.A)((0,he.castArray)(o)))}return n},[])}},{key:"toUrlSearchParameterMap",value:function(t){var n=this;return(0,he.reduce)(t,function(t,r,a){return e.stateToUrlParamMap.hasOwnProperty(a)&&e.valueIsMeaningfulToSerialize(r)&&e.valueIsNotDefault(r,a)?Bt(Bt({},t),n.stateToUrlParamMap[a](r)):t},{})}},{key:"valueIsMeaningfulToSerialize",value:function(e){return!(!(0,he.isBoolean)(e)&&(Array.isArray(e)||(0,he.isString)(e)?(0,he.isEmpty)(e):(0,he.isNaN)(e)||(0,he.isNil)(e)))}},{key:"valueIsNotDefault",value:function(e,t){return Tt[t]!==e}}])}();(0,f.A)(Mt,"urlParamToActionCreatorMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},jt.cellSelectedFor3D,function(e,t){var n=dt({id:String(e)});return(0,he.includes)((0,he.castArray)(t[jt.selectedPoint]),e)?n:[ct({id:String(e)}),n]}),jt.colorBy,function(e){return rt(P,String(e))}),jt.dataset,function(e){return At(String(e))}),jt.csvUrl,function(e){return Ct(decodeURIComponent(String(e)))}),jt.galleryCollapsed,function(e){return bt("true"===e)}),jt.plotByOnX,function(e){return rt(E,String(e))}),jt.plotByOnY,function(e){return rt(S,String(e))}),jt.selectedAlbum,function(e){return vt(Number(e))}),jt.selectedPoint,function(e){return Array.isArray(e)?(0,he.map)(e,function(e){return ct({id:String(e)})}):ct({id:String(e)})})),(0,f.A)(Mt,"urlParamToStateMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},jt.cellSelectedFor3D,function(e,t){var n={cellSelectedFor3D:String(e)};return(0,he.includes)((0,he.castArray)(t[jt.selectedPoint]),e)||Object.assign(n,{initSelectedPoints:[String(e)]}),n}),jt.colorBy,function(e){return(0,f.A)({},P,String(e))}),jt.dataset,function(e){return{dataset:String(e)}}),jt.galleryCollapsed,function(e){return{galleryCollapsed:"true"===e}}),jt.plotByOnX,function(e){return(0,f.A)({},E,String(e))}),jt.plotByOnY,function(e){return(0,f.A)({},S,String(e))}),jt.selectedAlbum,function(e){return{selectedAlbum:Number(e)}}),jt.selectedPoint,function(e){return{initSelectedPoints:(0,he.map)((0,he.castArray)(e),String)}})),(0,f.A)(Mt,"stateToUrlParamMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({cellSelectedFor3D:function(e){return(0,f.A)({},jt.cellSelectedFor3D,String(e))}},P,function(e){return(0,f.A)({},jt.colorBy,String(e))}),"dataset",function(e){return(0,f.A)({},jt.dataset,String(e))}),"csvUrl",function(e){return(0,f.A)({},jt.csvUrl,String(encodeURIComponent(e)))}),"galleryCollapsed",function(e){return(0,f.A)({},jt.galleryCollapsed,String(e))}),"selectedAlbum",function(e){return(0,f.A)({},jt.selectedAlbum,String(e))}),"selectedPoints",function(e){var t=(0,he.map)(e,function(e){return String(e[x])});return(0,f.A)({},jt.selectedPoint,t)}),E,function(e){return(0,f.A)({},jt.plotByOnX,String(e))}),S,function(e){return(0,f.A)({},jt.plotByOnY,String(e))}));var Rt={"/allen/aics/":"https://dev-aics-dtp-001.int.allencell.org/"},Ut=/^(https?:\/\/)/;function Vt(e){return!e||e.includes("localhost")||e.includes("staging")||e.includes("stg")}function zt(e,t,n){return e.split(t).join(n)}function Gt(e){return e=zt(e,"\\","/"),(e=zt(e,"//","/")).startsWith("//")&&(e=e.slice(1)),e}function Lt(e){return Gt(e).startsWith("/allen/")}function Ht(e){return Ut.test(e)}function Kt(e){e=Gt(e);for(var t=0,n=Object.keys(Rt);t<n.length;t++){var r=n[t];if(e.startsWith(r))return e.replace(r,Rt[r])}return null}function Wt(e){return qt.apply(this,arguments)}function qt(){return(qt=(0,ne.A)(oe().mark(function e(t){var n,r,a;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}throw new Error("No URL provided.");case 1:if(!Lt(t)){e.next=3;break}if(!(n=Kt(t))){e.next=2;break}t=n,e.next=3;break;case 2:throw new Error("'".concat(t,"' is an Allen path, but could not be converted to an HTTPS URL. ")+"The provided path may not be servable over HTTPS. Please submit an issue ticket if you believe this is incorrect.");case 3:return console.log("Fetching CSV dataset from url: ".concat(t)),e.next=4,fetch(t);case 4:if((r=e.sent).ok){e.next=5;break}throw new Error("Failed to fetch CSV dataset from url '".concat(t,"': ").concat(r.status," ").concat(r.statusText));case 5:return e.next=6,r.text();case 6:return a=e.sent,e.abrupt("return",{url:t,text:a});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Xt=ge("metadata","receive"),Yt=ge("metadata","request"),Zt=ge("metadata","request-album-data"),Qt=ge("metadata","receive-album-data"),Jt=ge("metadata","set-is-loading"),$t=ge("metadata","set-loading-text"),en=ge("metadata","set-show-small-screen-warning"),tn=ge("metadata","RECEIVE_AVAILABLE_DATASETS"),nn=ge("metadata","REQUEST_AVAILABLE_DATASETS"),rn=ge("metadata","receive-measured-feature-names"),an=ge("metadata","request-cell-file-info"),on=ge("metadata","receive-cell-file-info"),ln=ge("metadata","CLEAR_DATASET_VALUES"),cn=ge("metadata","request-viewer-channel-settings"),sn=ge("metadata","receive-viewer-channel-settings");function un(){return{type:nn}}function dn(e){return{payload:e,type:tn}}function fn(){return{type:ln}}function pn(e){return{payload:e,type:on}}function mn(e){return{payload:e,type:Xt}}function hn(e){return{payload:e,type:rn}}function yn(){return{type:an}}function gn(){return{type:Yt}}function vn(){return{type:Zt}}function bn(e){return{payload:e,type:Qt}}function An(){return{type:cn}}function wn(e){return{payload:e,type:sn}}function Cn(){return{payload:!1,type:Jt}}function En(e){return{payload:e,type:$t}}function Sn(e){return{payload:e,type:en}}var Dn=n(97132),kn=function(e){return e.metadata.featureData},Pn=function(e){return e.metadata.albums},On=function(e){return e.metadata.isLoading},xn=function(e){return e.metadata.loadingText},_n=function(e){return e.metadata.showSmallScreenWarning},In=function(e){return e.metadata.megasets},Tn=function(e){return e.metadata.measuredFeaturesDefs},Fn=function(e){return e.metadata.cellFileInfo},Nn=function(e){return e.metadata.viewerChannelSettings},Bn=(0,Dn.Mz)([In],function(e){var t=[];return e.forEach(function(e){(0,he.forEach)(e.datasets,function(e){t.push(e)})}),t}),jn=(0,Dn.Mz)([In],function(e){return e.sort(function(e,t){return t.dateCreated.seconds-e.dateCreated.seconds})}),Mn=(0,Dn.Mz)([kn],function(e){return e.values}),Rn=(0,Dn.Mz)([kn],function(e){return e.labels}),Un=(0,Dn.Mz)([Tn],function(e){return(0,he.map)(e,"key")}),Vn=(0,Dn.Mz)([Tn],function(e){return(0,he.map)((0,he.filter)(e,"discrete"),"key")}),zn=(0,Dn.Mz)([Tn],function(e){var t=De(e,M);return t&&t.discrete?t.options:{}}),Gn=(0,Dn.Mz)([Mn],function(e){return e[M]||[]}),Ln=function(e){return e.imageDataset.imageDataset};function Hn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hn(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Wn=(0,Ot.A)({type:Ve,process:function(e,t,n){var r=e.action.payload,a=Mt.toReduxActions(r),o=(0,he.remove)(a,{type:$e});o&&o.forEach(function(e){return t(e)}),t(Ae(Mt.toReduxActions(r))),n()}}),qn=(0,Ot.A)({type:$e,process:function(e,t,n){return(0,ne.A)(oe().mark(function r(){var a,o,l,i,c,s,u,d,f;return oe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.action,o=e.getState,l=o(),i=Ln(l),a.payload){r.next=1;break}return r.abrupt("return",t({type:Je,payload:a.payload}));case 1:if((s=Bn(o())).length){r.next=6;break}return r.next=2,i.getAvailableDatasets();case 2:u=r.sent,d=0;case 3:if(!(d<u.length)){r.next=5;break}if(!(f=(0,he.find)(u[d].datasets,{id:a.payload}))){r.next=4;break}return c=f,r.abrupt("continue",5);case 4:d++,r.next=3;break;case 5:r.next=7;break;case 6:c=(0,he.find)(s,{id:a.payload});case 7:if(void 0!==c){r.next=8;break}return"csv"!==a.payload&&console.error("A dataset matching ".concat(a.payload," is not available.")),r.abrupt("return",n());case 8:i.selectDataset(c.manifest).then(function(e){var r=[rt(E,e.defaultXAxis),rt(S,e.defaultYAxis),at(e.defaultGroupBy)];e.defaultColorBy&&r.push(rt(P,e.defaultColorBy)),t(Ae(r)),t({type:Je,payload:{dataset:a.payload,thumbnailRoot:e.thumbnailRoot,downloadRoot:e.downloadRoot,volumeViewerDataRoot:e.volumeViewerDataRoot}}),t(gn()),t(An()),n()});case 9:case"end":return r.stop()}},r)}))()}}),Xn=(0,Ot.A)({process:function(e){var t=e.action,n=(0,e.getState)();return Ln(n).getFileInfoByCellId(t.payload.id.toString()).then(function(e){return e?Kn(Kn({},e),{},{index:t.payload.index}):{}}).catch(function(e){console.log(e)})},processOptions:{successType:Xe},type:Te}),Yn=(0,Ot.A)({process:function(e){var t=e.action,n=(0,e.getState)(),r=Ln(n),a=kn(n),o=function(e,t){var n={};return e.sort(function(e,t){return Number(e)-Number(t)}).forEach(function(e){var r=(0,he.indexOf)(t,e);n[e]=r}),n}(t.payload,a.labels.cellIds);return r.getFileInfoByArrayOfCellIds(t.payload).then(function(e){return(0,he.filter)((0,he.map)(e,function(e){return Kn(Kn({},e),{},{index:e?o[e.CellId]:-1})}))}).catch(function(e){console.log(e)})},processOptions:{successType:Qe},type:Ze});const Zn=[Wn,qn,Xn,(0,Ot.A)({process:function(e){var t=e.action,n=(0,e.getState)(),r=Ln(n);return r.getFileInfoByArrayOfCellIds?r.getFileInfoByArrayOfCellIds([t.payload.toString()]).then(function(e){return(0,he.filter)(e)}).catch(function(e){console.log(e)}):Promise.resolve({})},processOptions:{successType:Ye},type:Le}),Yn];function Qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $n=function(e){return e.selection.plotByOnX},er=function(e){return e.selection.plotByOnY},tr=function(e){return e.selection.groupBy},nr=function(e){return e.selection.selectedPoints},rr=function(e){return e.selection.selectedGroups},ar=function(e){return e.selection.colorBy},or=function(e){return e.selection.defaultColors},lr=function(e){return e.selection.selectedGroupColors},ir=function(e){return e.selection.filterExclude},cr=function(e){return e.selection.cellSelectedFor3D},sr=function(e){return e.selection.applySelectionSetColoring},ur=function(e){return e.selection.downloadConfig},dr=function(e){return e.selection.mousePosition},fr=function(e){return e.selection.hoveredPointData},pr=function(e){return e.selection.hoveredCardId},mr=function(e){return e.selection.selectedAlbum},hr=function(e){return e.selection.galleryCollapsed},yr=function(e){return e.selection.dataset},gr=function(e){return e.selection.thumbnailRoot},vr=function(e){return e.selection.initSelectedPoints},br=function(e){return e.selection.selectedAlbumFileInfo},Ar=function(e){return e.selection.downloadRoot},wr=function(e){return e.selection.volumeViewerDataRoot},Cr=function(e){return e.selection.alignActive},Er=(0,Dn.Mz)([yr],function(e){return e.split("_v")[0]}),Sr=function(e){return e.selection.csvUrl},Dr=(0,Dn.Mz)([Tn,tr],function(e,t){var n=De((0,he.map)(e),t);return n&&n.discrete?n:{}}),kr=(0,Dn.Mz)([Dr],function(e){return(0,he.isEmpty)(e)?[]:(0,he.sortBy)(e.options,"name")}),Pr=(0,Dn.Mz)([kr],function(e){return(0,he.map)(e,"name")}),Or=(0,Dn.Mz)([ar,tr,Tn,Vn],function(e,t,n,r){if((0,he.includes)(r,e)){var a=De(n,e);if(a&&a.discrete){var o=a.options;return(0,he.map)(o,function(n,r){var a;return a=t===e?n.key||n.name:r,{color:n.color,name:a,label:n.name}})}}return[]});function xr(e,t){var n=(0,he.find)(t,{key:e});return n&&n.tooltip?n.tooltip:""}var _r=(0,Dn.Mz)([kn,Dr],function(e,t){var n=t.key;return n?(0,he.map)(e.values[n],function(e){var n=null!==e?e.toString():"";return ke(t,n)}):(console.log("Missing groupBy category key"),[])}),Ir=(0,Dn.Mz)([kn],function(e){return e.values||{}}),Tr=(0,Dn.Mz)([Ir,$n],function(e,t){return e[t]?e[t]:[]}),Fr=(0,Dn.Mz)([Ir,er],function(e,t){return e[t]?e[t]:[]}),Nr=(0,Dn.Mz)([kn,ar,Tn],function(e,t,n){var r=De(n,t);if(r&&r.discrete){var a=r.options,o=(0,he.map)(a,"count");if((0,he.filter)(o,function(e){return void 0!==e}).length)return o;var l=(0,he.reduce)(e.values[t],function(e,t){var n=null!==t?t.toString():"NaN";return e[n]?e[n]++:e[n]=1,e},{});return(0,he.values)(l)}return[]}),Br=(0,Dn.Mz)([Un,ir,kn,tr,_r],function(e,t,n,r,a){if(!t.length)return Jn(Jn({},n),{},{labels:Jn(Jn({},n.labels),{},(0,f.A)({},r,a))});for(var o=[],l={},i=[],c=[],s=[],u=[],d=function(r){var d=a[r];if(!(0,he.includes)(t,d)){var f,p,m=n.labels.cellIds[r];i.push(m),o.push(d),c.push(n.labels.thumbnailPaths[r]),s.push(null!==(f=null===(p=n.labels.sourcePaths)||void 0===p?void 0:p[r])&&void 0!==f?f:""),u.push(n.indices[r]),e.forEach(function(e){l[e]||(l[e]=[]),l[e].push(n.values[e][r])})}},p=0;p<n.labels.cellIds.length;p++)d(p);return{indices:u,values:l,labels:(0,f.A)((0,f.A)((0,f.A)((0,f.A)({},r,o),D,i),"thumbnailPaths",c),"sourcePaths",s)}}),jr=(0,Dn.Mz)([Br],function(e){return e.values||{}}),Mr=(0,Dn.Mz)([Br],function(e){return e.labels||{}}),Rr=(0,Dn.Mz)([jr,$n],function(e,t){return e[t]?e[t]:[]}),Ur=(0,Dn.Mz)([jr,er],function(e,t){return e[t]||[]}),Vr=(0,Dn.Mz)([Mr],function(e){return e[D]||[]}),zr=(0,Dn.Mz)([Br,ar,tr],function(e,t,n){return e.labels&&Jn(Jn({},e.values),{},(0,f.A)({},n,e.labels[n]))[t]||[]}),Gr=(0,Dn.Mz)([nr],function(e){return(0,he.map)(e,x)}),Lr=(0,Dn.Mz)([cr,nr,_r,kn],function(e,t,n,r){var a=function(e,t){return(0,he.find)(e,function(e){return e[x].toString()===t})}(t,e)||{},o=-1;return(0,he.isEmpty)(a)?a:Jn(Jn({index:o=void 0!==a.index?a.index:r.labels.cellIds.indexOf(e)},a),{},(0,f.A)({},O,n[o]))}),Hr=(0,Dn.Mz)([Lr],function(e){return(0,he.isEmpty)(e)?"":e[_].toString()}),Kr=(0,Dn.Mz)([Lr],function(e){return!!e.transform}),Wr=(0,Dn.Mz)([Lr,Ir],function(e,t){var n=e.index;return void 0===n?{}:(0,he.mapValues)(t,function(e){return e[n]})}),qr=(0,Dn.Mz)([kn,rr,$n,er,lr],function(e,t,n,r,a){var o=[],l=[],i=[];return(0,he.mapValues)(t,function(t,c){t.forEach(function(t){o.push(a[c]),l.push(e.values[n][t.pointIndex]),i.push(e.values[r][t.pointIndex])})}),{color:o,x:l,y:i}}),Xr=(0,Dn.Mz)([rr],function(e){return(0,he.keys)(e)}),Yr=(0,Dn.Mz)([rr],function(e){return(0,he.map)(e,function(e){return e.length})});const Zr={actions:r,logics:Zn,reducer:Ft,selectors:i,types:c};var Qr=function(e){return ge("image-dataset",e)},Jr=Qr("load-csv-dataset"),$r=Qr("change-image-dataset-type");function ea(e){return{payload:e,type:$r}}function ta(e){return{payload:e,type:Jr}}var na=n(6653),ra=n(84199),aa=n(79988);function oa(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return la(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?la(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}function la(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ia="_defaultGroupByNone",ca="File ID",sa="Thumbnail",ua="File Path",da="Cell Line",fa="File Name",pa="file_id",ma="thumbnail",ha="file_path",ya="file_name",ga="Link Path",va=new Set([x,_,I,T,F,N,"transform",ca,sa,ua,fa,"File Size","Uploaded",ha,ya,pa,ma,"file_size","uploaded",ga]),ba=["#27B4AE","#4047C4","#F48730","#DB4281","#7E84F4","#78DF76","#1C7AED","#7129CD","#E7C73B","#C95F1E","#188E61","#BEE952"],Aa=function(e){return e[e.CONTINUOUS=0]="CONTINUOUS",e[e.DISCRETE=1]="DISCRETE",e}(Aa||{});function wa(e){return null===e||"string"==typeof e&&("nan"===e.trim().toLowerCase()||!isNaN(Number(e))&&!isNaN(parseFloat(e)))}function Ca(e){for(var t=0;t<e.length;t++)if(null!==e[t])return"string"==typeof e[t];return!1}function Ea(e){if(0===e.length)return!1;for(var t=0;t<e.length;t++)if(null!==e[t])return!0;return!1}var Sa=function(){return(0,m.A)(function e(t){var n=this;(0,p.A)(this,e),(0,f.A)(this,"csvData",void 0),(0,f.A)(this,"idToIndex",void 0),(0,f.A)(this,"featureInfo",void 0),(0,f.A)(this,"defaultGroupByFeatureKey",void 0),(0,f.A)(this,"remapBffOrFmsKeys",function(e){var t=n.copyColumnIfEmpty(e,ca,x),r=n.copyColumnIfEmpty(e,pa,x);t||r||(n.copyColumnIfEmpty(e,fa,x),n.copyColumnIfEmpty(e,ya,x)),n.copyColumnIfEmpty(e,sa,F),n.copyColumnIfEmpty(e,ma,F),n.copyColumnIfEmpty(e,ua,N),n.copyColumnIfEmpty(e,ha,N)}),this.csvData=[],this.idToIndex={},this.featureInfo=new Map,this.defaultGroupByFeatureKey="",this.parseCsvData(t)},[{key:"getFeatureKeysFromColumnNames",value:function(e){return Object.keys(e[0]).filter(function(e){return!va.has(e)&&""!==e})}},{key:"getFeatureKeyClamped",value:function(e,t){var n=e.length-1;return e[Math.min(Math.max(t,0),n)]}},{key:"getFeatureDataAsColumns",value:function(e,t){var n,r=new Map,a=oa(t);try{for(a.s();!(n=a.n()).done;){var o,l=n.value,i=[],c=!0,s=oa(e);try{for(s.s();!(o=s.n()).done;){var u,d=null!==(u=o.value[l])&&void 0!==u?u:null;null===d||"string"==typeof d&&""===d.trim()?i.push(null):(i.push(d),wa(d)||(c=!1))}}catch(e){s.e(e)}finally{s.f()}if(c){var f=i.map(function(e){return e?Number.parseFloat(e):null});r.set(l,f)}else r.set(l,i)}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"parseDiscreteFeature",value:function(e,t){for(var n=new Map,r=[],a=0;a<t.length;a++){var o=t[a];if(null!==o){var l=o.trim(),i=n.get(l);i||(i={index:n.size,count:0},n.set(l,i)),i.count++,r.push(i.index)}else r.push(null)}var c,s={},u=oa(n.entries());try{for(u.s();!(c=u.n()).done;){var d=(0,re.A)(c.value,2),f=d[0],p=d[1],m=p.index,h=p.count;s[m.toString()]={color:ba[m%ba.length],name:f,key:f,count:h}}}catch(e){u.e(e)}finally{u.f()}return{def:{discrete:!0,displayName:e,description:e,key:e,options:s,tooltip:e},data:r}}},{key:"parseFeatures",value:function(e){this.featureInfo.clear();var t,n=this.getFeatureKeysFromColumnNames(e),r=this.getFeatureDataAsColumns(e,n),a=oa(n);try{for(a.s();!(t=a.n()).done;){var o=t.value,l=r.get(o);if(l&&Ea(l))if(Ca(l)){var i=this.parseDiscreteFeature(o,l),c=i.def,s=i.data;this.featureInfo.set(o,{type:Aa.DISCRETE,def:c,data:s})}else{var u={discrete:!1,displayName:o,description:o,key:o,tooltip:o};this.featureInfo.set(o,{type:Aa.CONTINUOUS,def:u,data:l})}}}catch(e){a.e(e)}finally{a.f()}}},{key:"assignDefaultGroupByFeatureKey",value:function(e){var t=e[0];if(t&&void 0!==t[da])this.defaultGroupByFeatureKey=da;else{var n=Array.from(this.featureInfo.values()).find(function(e){return e.type===Aa.DISCRETE});if(n)this.defaultGroupByFeatureKey=n.def.key;else{var r={0:{color:ba[0],name:"Default",key:"0",count:e.length}};this.featureInfo.set(ia,{type:Aa.DISCRETE,def:{discrete:!0,displayName:"(None)",description:"(None)",key:ia,tooltip:"(None)",options:r},data:new Array(e.length).fill(0)}),this.defaultGroupByFeatureKey=ia}}}},{key:"copyColumnIfEmpty",value:function(e,t,n){return void 0!==e[t]&&(void 0===e[n]||""===e[n])&&(e[n]=e[t],!0)}},{key:"parseCsvData",value:function(e){var t=ra.parse(e,{header:!0,transformHeader:function(e){return e.trim()},skipEmptyLines:"greedy"}).data;if(this.csvData=t,0===this.csvData.length)throw new Error("No data found in CSV");for(var n=0;n<this.csvData.length;n++)this.remapBffOrFmsKeys(this.csvData[n]);for(var r=!0,a=0;a<this.csvData.length;a++){var o=this.csvData[a];if(void 0===o[x]||""===o[x].trim()){r=!1;break}}for(var l=0;l<this.csvData.length;l++){var i=this.csvData[l];r||(i[x]=l.toString()),this.idToIndex[i[x].trim()]=l}this.parseFeatures(this.csvData),this.assignDefaultGroupByFeatureKey(this.csvData)}},{key:"selectDataset",value:function(){var e=Array.from(this.featureInfo.keys());return Promise.resolve({defaultXAxis:this.getFeatureKeyClamped(e,0),defaultYAxis:this.getFeatureKeyClamped(e,1),defaultColorBy:this.defaultGroupByFeatureKey,defaultGroupBy:this.defaultGroupByFeatureKey,thumbnailRoot:"",downloadRoot:"",volumeViewerDataRoot:""})}},{key:"getAvailableDatasets",value:function(){var e={name:"csv",title:"CSV Dataset",production:!1,dateCreated:aa.A.firestore.Timestamp.now(),datasets:{csv:{name:"csv",title:"CSV Dataset",version:"1",id:"csv",description:"A dataset imported from a CSV file",index:0,userData:{}}}};return Promise.resolve([e])}},{key:"getViewerChannelSettings",value:function(){return Promise.resolve({groups:[{name:"Channels",channels:[{match:[0,1,2],enabled:!0},{match:"(.+)",enabled:!1}]}]})}},{key:"getFeatureKeyToData",value:function(){var e,t={},n=oa(this.featureInfo.entries());try{for(n.s();!(e=n.n()).done;){var r=(0,re.A)(e.value,2),a=r[0],o=r[1];t[a]=o.data}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getFeatureData",value:function(){for(var e=this.csvData.map(function(e,t){return t}),t=this.getFeatureKeyToData(),n=[],r=[],a=[],o=0;o<e.length;o++){var l=this.csvData[o];r.push(l[x]),n.push(l[F]||""),a.push(l[N]||l[T]||"")}return Promise.resolve({indices:e,values:t,labels:{thumbnailPaths:n,cellIds:r,sourcePaths:a}})}},{key:"getAlbumData",value:function(){return Promise.resolve([])}},{key:"getMeasuredFeatureDefs",value:function(){var e=Array.from(this.featureInfo.values()).map(function(e){return e.def});return Promise.resolve(e)}},{key:"getFileInfoByCellId",value:(t=(0,ne.A)(oe().mark(function e(t){var n,r,a,o,l,i;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.idToIndex[t])){e.next=1;break}return e.abrupt("return",Promise.resolve(void 0));case 1:if(r=this.csvData[n]){e.next=2;break}return e.abrupt("return",Promise.resolve(void 0));case 2:if(!r[ga]){e.next=4;break}return o=r[ga].split("?"),l=o[o.length-1]||"",e.next=3,(0,na.bT)(new URLSearchParams(l));case 3:a=e.sent;case 4:return i=(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},x,r[x]),_,r[_]),I,r[I]),T,r[T]),F,r[F]),N,r[N]),O,r[O]||this.defaultGroupByFeatureKey),"voleUrlParams",a),e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getFileInfoByArrayOfCellIds",value:(e=(0,ne.A)(oe().mark(function e(t){var n,r=this;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return r.getFileInfoByCellId(e)}),e.abrupt("return",Promise.all(n));case 1:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})}]);var e,t}();const Da=Sa,ka=[(0,Ot.A)({type:Jr,process:function(e,t,n){return(0,ne.A)(oe().mark(function r(){var a,o,l,i,c;return oe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.action,o=a.payload,r.prev=1,l=new Da(o),r.next=2,l.getAvailableDatasets();case 2:i=r.sent,t(dn(i)),t(At("csv")),t(ea(l)),r.next=4;break;case 3:r.prev=3,c=r.catch(1),console.error("Error loading CSV dataset:",c);case 4:return r.prev=4,n(),r.finish(4);case 5:case"end":return r.stop()}},r,null,[[1,3,4,5]])}))()}})];var Pa=n(71083);n(58707),aa.A.initializeApp({apiKey:"AIzaSyD691xhXsWl-8QU_9htjZnMUd7siWVCTAE",appId:"1:40711248674:web:511cb4cede47191274237b",authDomain:"allen-cell-resource.firebaseapp.com",databaseURL:"https://allen-cell-resource.firebaseio.com",measurementId:"G-8553S8ESS7",messagingSenderId:"40711248674",projectId:"allen-cell-resource",storageBucket:"allen-cell-resource.appspot.com"});var Oa=aa.A.firestore();function xa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xa(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xa(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ia=(0,m.A)(function e(){var t=this;(0,p.A)(this,e),(0,f.A)(this,"collectionRef",void 0),(0,f.A)(this,"featuresDataPath",void 0),(0,f.A)(this,"cellLineDataPath",void 0),(0,f.A)(this,"viewerSettingsPath",void 0),(0,f.A)(this,"thumbnailRoot",void 0),(0,f.A)(this,"downloadRoot",void 0),(0,f.A)(this,"volumeViewerDataRoot",void 0),(0,f.A)(this,"featuresDisplayOrder",void 0),(0,f.A)(this,"datasetId",void 0),(0,f.A)(this,"fileInfoPath",void 0),(0,f.A)(this,"featuresDataOrder",void 0),(0,f.A)(this,"albumPath",void 0),(0,f.A)(this,"featureDefsPath",void 0),(0,f.A)(this,"viewerChannelSettings",void 0),(0,f.A)(this,"getDoc",function(e){return Oa.doc(e).get()}),(0,f.A)(this,"getCollection",function(e){return Oa.collection(e).get()}),(0,f.A)(this,"getAvailableDatasets",function(){return Oa.collection("dataset-descriptions").get().then(function(e){var t=[];return e.forEach(function(e){var n=e.data();n.datasets=(0,he.reduce)(n.datasets,function(e,t,n){return t.id=n,(Vt(location.hostname)||t.production)&&(e[n]=t),e},{}),(Vt(location.hostname)||n.production)&&t.push(n)}),t})}),(0,f.A)(this,"setCollectionRef",function(e){t.collectionRef=Oa.collection("cfe-datasets").doc(e)}),(0,f.A)(this,"getManifest",function(e){return Oa.doc(e).get().then(function(e){return e.data()})}),(0,f.A)(this,"selectDataset",function(e){return t.viewerChannelSettings=void 0,t.getManifest(e).then(function(e){return t.featuresDataPath=e.featuresDataPath,t.viewerSettingsPath=e.viewerSettingsPath,t.thumbnailRoot=e.thumbnailRoot,t.downloadRoot=e.downloadRoot,t.volumeViewerDataRoot=e.volumeViewerDataRoot,t.featuresDisplayOrder=e.featuresDisplayOrder,t.fileInfoPath=e.fileInfoPath,t.featuresDataOrder=e.featuresDataOrder,t.featureDefsPath=e.featureDefsPath,t.albumPath=e.albumPath,{defaultXAxis:e.xAxis.default,defaultYAxis:e.yAxis.default,defaultColorBy:e.colorBy.default,defaultGroupBy:e.groupBy.default,thumbnailRoot:e.thumbnailRoot,downloadRoot:e.downloadRoot,volumeViewerDataRoot:e.volumeViewerDataRoot}})}),(0,f.A)(this,"getViewerChannelSettings",function(){return t.viewerChannelSettings?Promise.resolve(t.viewerChannelSettings):t.viewerSettingsPath?Pa.A.get(t.viewerSettingsPath).then(function(e){return e.data}).then(function(e){return t.viewerChannelSettings=e,t.viewerChannelSettings}):Promise.resolve({})}),(0,f.A)(this,"requestSetOfFeatureDefs",function(){var e=(0,ne.A)(oe().mark(function e(n,r){var a;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.splice(0,10),e.next=1,Oa.collection(t.featureDefsPath).where("key","in",a).get();case 1:if(e.sent.forEach(function(e){var n=e.data(),a=n.key,o=t.featuresDisplayOrder.indexOf(a);r[o]=n}),!n.length){e.next=2;break}return e.abrupt("return",t.requestSetOfFeatureDefs(n,r));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),(0,f.A)(this,"getMeasuredFeatureDefs",(0,ne.A)(oe().mark(function e(){var n,r;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,xt.A)(t.featuresDisplayOrder),r=[],e.next=1,t.requestSetOfFeatureDefs(n,r);case 1:return e.abrupt("return",r);case 2:case"end":return e.stop()}},e)}))),(0,f.A)(this,"getFeatureData",function(){return Pa.A.get(t.featuresDataPath).then(function(e){return e.data}).then(function(e){for(var n=t.featuresDisplayOrder.reduce(function(e,t){return e[t]=[],e},{}),r=[],a=[],o=[],l=[],i=0;i<e.length;i++){o.push(i);var c=e[i];c.f.forEach(function(e,r){var a=n[t.featuresDataOrder[r]];isNaN(e)?a.push(null):a.push(Number(e))},{}),r.push(c.p),a.push(c.t),l.push(c.i.toString())}return{indices:o,values:n,labels:{thumbnailPaths:a,cellIds:l}}}).catch(function(e){console.log("ERROR FETCHING FEATURE DATA:",e)})}),(0,f.A)(this,"getFileInfoByCellId",function(e){return t.getDoc("".concat(t.fileInfoPath,"/").concat(e)).then(function(e){var t=e.data();if(t)return _a(_a({},t),{},{CellId:t.CellId.toString(),FOVId:t.FOVId.toString()})})}),(0,f.A)(this,"getFileInfoByArrayOfCellIds",function(e){return Promise.all(e.map(function(e){return t.getDoc("".concat(t.fileInfoPath,"/").concat(e)).then(function(e){var t=e.data();if(t)return _a(_a({},t),{},{CellId:t.CellId.toString(),FOVId:t.FOVId.toString()})})}))}),(0,f.A)(this,"getAlbumData",function(){return t.albumPath?t.getCollection(t.albumPath).then(function(e){var t=[];return e.forEach(function(e){t.push(e.data())}),t}):Promise.resolve([])}),this.featuresDataPath="",this.viewerSettingsPath="",this.cellLineDataPath="",this.thumbnailRoot="",this.downloadRoot="",this.volumeViewerDataRoot="",this.featuresDisplayOrder=[],this.fileInfoPath="",this.datasetId="",this.featuresDataOrder=[],this.albumPath="",this.featureDefsPath="",this.collectionRef=Oa.collection("cfe-datasets").doc("v1")});function Ta(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Fa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ta(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ta(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Na={imageDataset:new Ia};const Ba={actions:s,logics:ka,reducer:ve((0,f.A)({},$r,{accepts:function(e){return e.type===$r},perform:function(e,t){return Fa(Fa({},e),{},{imageDataset:t.payload})}}),Na),selectors:l,types:u},ja={"csv-upload":"styles__csv-upload--rx16G",csvUpload:"styles__csv-upload--rx16G"};var Ma=function(e){return e.Device="device",e.Web="web",e}(Ma||{}),Ra={loadCsvDataset:Ba.actions.loadCsvDataset,setCsvUrl:Zr.actions.setCsvUrl};const Ua=(0,b.Ng)(function(e){return{dataset:Ba.selectors.getImageDataset(e)}},Ra)(function(e){var t=(0,g.useState)(!1),n=(0,re.A)(t,2),r=n[0],a=n[1],o=(0,g.useState)(Ma.Device),l=(0,re.A)(o,2),i=l[0],c=l[1],s=(0,g.useState)(""),u=(0,re.A)(s,2),d=u[0],f=u[1],p=(0,g.useState)(""),m=(0,re.A)(p,2),h=m[0],y=m[1],v=(0,g.useState)(!1),b=(0,re.A)(v,2),A=b[0],w=b[1];(0,g.useEffect)(function(){a(!1)},[e.dataset]);var C=function(){var t=(0,ne.A)(oe().mark(function t(n){var r;return oe().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w(!0),t.next=1,n.text();case 1:if(0!==(r=t.sent).trim().length){t.next=2;break}return y("The provided file is empty."),w(!1),t.abrupt("return","");case 2:try{e.loadCsvDataset(r),e.setCsvUrl("")}catch(e){y(e.message)}return w(!1),t.abrupt("return","");case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),E=function(){var t=(0,ne.A)(oe().mark(function t(){var n,r,a,o,l;return oe().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(w(!0),t.prev=1,Ht(n=d.trim())||Lt(n)){t.next=2;break}throw new Error("Please enter a valid HTTP(S) URL.");case 2:return t.next=3,Wt(n);case 3:r=t.sent,a=r.url,o=r.text,e.loadCsvDataset(o),e.setCsvUrl(a),t.next=5;break;case 4:t.prev=4,l=t.catch(1),y(l.message);case 5:w(!1);case 6:case"end":return t.stop()}},t,null,[[1,4]])}));return function(){return t.apply(this,arguments)}}(),S=g.createElement(ie.Ay,{onClick:function(){return a(!1)}},"Cancel");return g.createElement(g.Fragment,null,g.createElement(ie.Ay,{onClick:function(){a(!0),w(!1),y("")}},g.createElement(le.A,null),"Load"),g.createElement(ce.A,{title:"Load a .csv dataset",open:r,onCancel:function(){return a(!1)},footer:S},g.createElement(se.A,{vertical:!0,align:"center",gap:16,style:{margin:"16px 0"}},g.createElement(ue.Ay.Group,{buttonStyle:"solid",optionType:"button",style:{display:"flex",flexDirection:"row",justifyContent:"center",width:"100%"},value:i,onChange:function(e){return c(e.target.value)},disabled:A},g.createElement(ue.Ay,{style:{minWidth:"40%",display:"flex",justifyContent:"center"},value:Ma.Device},"From your device"),g.createElement(ue.Ay,{style:{minWidth:"40%",display:"flex",justifyContent:"center"},value:Ma.Web},"From the web")),i===Ma.Device&&g.createElement("div",{style:{width:"100%"}},g.createElement(me.A,{className:ja.csvUpload,action:C,accept:".csv",multiple:!1,showUploadList:!1,disabled:A},g.createElement(se.A,{vertical:!0,align:"center"},g.createElement("p",{style:{fontSize:"30px"}},A?g.createElement(de.A,{className:ja.uploadSpinner,indicator:g.createElement(J.A,{spin:!0}),size:"large"}):g.createElement(le.A,null)),g.createElement("p",null,"Click or drag a .csv file here to load.")))),i===Ma.Web&&g.createElement(se.A,{vertical:!0,style:{width:"100%"},gap:6},g.createElement("p",{style:{margin:0}},"Provide the URL of a .csv file"),g.createElement(fe.A.Compact,{style:{width:"100%"}},g.createElement(pe.A,{placeholder:"https://example.com/dataset.csv",value:d,onChange:function(e){return f(e.target.value)},onPressEnter:E}),g.createElement(ie.Ay,{type:"primary",onClick:E,loading:A},"Load")))),h&&g.createElement("span",{style:{color:"var(--text-red)"}},h)))});function Va(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Va=function(){return!!e})()}const za=function(e){function t(){return(0,p.A)(this,t),e=this,n=t,r=arguments,n=(0,H.A)(n),(0,L.A)(e,Va()?Reflect.construct(n,r||[],(0,H.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.props.selectedDataset;return g.createElement("div",{className:"style__page-header--b9ZaQ"},g.createElement(Q.A,{align:"middle"},g.createElement("a",{href:"https://allencell.org",title:"Allen Institute for Cell Science",style:{height:"41px"}},te),g.createElement("span",{className:"style__vertical-bar--gcXcn"},"|"),g.createElement("a",{href:"/",className:"style__cfe-home--DZcrh"},"Cell Feature Explorer")),g.createElement("div",{className:"style__viewer-title--j_YyS"},e),g.createElement("div",{className:"style__buttons--Ow6C4"},g.createElement(Ua,null)))}}])}(g.Component);var Ga=(0,Ot.A)({process:function(e,t,n){var r=(0,e.getState)();return Ln(r).getAvailableDatasets().then(function(e){return t(dn(e))}).catch(function(e){console.log(e)}).then(function(){return n()})},type:nn}),La=function(e){return Math.floor(Math.random()*e)},Ha=function(e,t,n){return null!==e[n]&&null!==t[n]},Ka=function(e,t,n){for(var r=e,a=0;a<r;){var o=La(e);if(Ha(t,n,o))return o;a++}return 0},Wa=(0,Ot.A)({process:function(e,t,n){return(0,ne.A)(oe().mark(function r(){var a,o,l,i,c;return oe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.getState,o=a(),l=Ln(o),!_n(a())){r.next=1;break}return r.abrupt("return");case 1:return t(En("Loading plot data, may take several seconds to a minute...")),i=[],r.next=2,l.getMeasuredFeatureDefs();case 2:return c=r.sent,i.push(hn(c)),r.abrupt("return",l.getFeatureData().then(function(e){return e?(i.push(mn(e)),t(Ae(i)),e):n()}).then(function(e){if(!e)return n();var r=vr(o),a=0;if(r.length)t(Dt(r));else{var l=e.labels[D],i=$n(o),c=er(o),s=e.values[i],u=e.values[c];i&&c&&(a=Ka(l.length,s,u)),t(ct({id:e.labels[D][a],index:a}))}cr(o)||t(dt({id:e.labels[D][a]})),t(Cn())}).catch(function(e){console.log(e)}).then(function(){return n()}));case 3:case"end":return r.stop()}},r)}))()},type:Yt}),qa=(0,Ot.A)({process:function(e,t,n){var r=(0,e.getState)(),a=Ln(r);return t(En("Loading album data...")),a.getAlbumData().then(n).catch(function(e){console.log(e)}).then(function(){return n()})},processOptions:{successType:Qt},type:Zt}),Xa=(0,Ot.A)({process:function(e,t,n){var r=(0,e.getState)();return Ln(r).getViewerChannelSettings().then(function(e){return t(wn(e)),e}).then(n).catch(function(e){console.log(e)}).then(function(){return n()})},type:cn});function Ya(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Za(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ya(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ya(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Qa={albums:[],cellFileInfo:[],isLoading:!0,loadingText:"",showSmallScreenWarning:!1,megasets:[],featureData:{indices:[],values:{},labels:{}},measuredFeaturesDefs:[],viewerChannelSettings:{}};const Ja={actions:a,logics:[qa,Wa,Ga,Xa],reducer:ve((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},Xt,{accepts:function(e){return e.type===Xt},perform:function(e,t){return Za(Za({},e),{},{featureData:t.payload})}}),ln,{accepts:function(e){return e.type===ln},perform:function(e){return Za(Za({},e),{},{cellFileInfo:Qa.cellFileInfo,isLoading:Qa.isLoading,featureData:Qa.featureData,measuredFeaturesDefs:Qa.measuredFeaturesDefs,viewerChannelSettings:Qa.viewerChannelSettings})}}),tn,{accepts:function(e){return e.type===tn},perform:function(e,t){return Za(Za({},e),{},{megasets:t.payload})}}),on,{accepts:function(e){return e.type===on},perform:function(e,t){return Za(Za({},e),{},{cellFileInfo:t.payload})}}),Qt,{accepts:function(e){return e.type===Qt},perform:function(e,t){return Za(Za({},e),{},{albums:t.payload})}}),sn,{accepts:function(e){return e.type===sn},perform:function(e,t){return Za(Za({},e),{},{viewerChannelSettings:t.payload})}}),Jt,{accepts:function(e){return e.type===Jt},perform:function(e,t){return Za(Za({},e),{},{isLoading:t.payload,loadingText:t.payload?e.loadingText:Qa.loadingText})}}),$t,{accepts:function(e){return e.type===$t},perform:function(e,t){return Za(Za({},e),{},{loadingText:t.payload})}}),en,{accepts:function(e){return e.type===en},perform:function(e,t){return Za(Za({},e),{},{showSmallScreenWarning:t.payload})}}),rn,{accepts:function(e){return e.type===rn},perform:function(e,t){return Za(Za({},e),{},{measuredFeaturesDefs:t.payload})}}),Qa),selectors:o,types:d};var $a=n(16370),eo=n(55957),to=n(58168),no=n(11575),ro=n(56914),ao=n(36552);const oo={card:"style__card--NiCPa",spacer:"style__spacer--HWBx1",loadButton:"style__loadButton--N_lqo"};var lo=no.A.Meta;const io=function(e){var t=e.title,n=e.name,r=e.version,a=e.description,o=e.handleSelectDataset,l=e.link,i=e.id,c=e.userData,s=e.image,u=r.startsWith("v")?r:"v".concat(r),d=g.createElement(g.Fragment,null,g.createElement("div",null,c.isNew&&g.createElement(ro.A,{color:"#8950d9"},"new"),t||n),g.createElement("span",{className:oo.version},u),c.inReview&&g.createElement(g.Fragment,null,g.createElement(ao.A,{type:"vertical"})," (in review)")),f=g.createElement(no.A,{className:oo.card,hoverable:!0,bordered:!1,cover:""!=s?g.createElement("img",{className:oo.staticThumbnail,alt:"Snapshot of simulation for ".concat(t),src:s}):null,onClick:function(){return o(i)}},g.createElement(lo,{title:d,description:g.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:a}})}),g.createElement("div",{className:oo.spacer}),g.createElement(eo.A,{column:1,size:"small",colon:!1},c.totalCells&&g.createElement(eo.A.Item,{label:"Number of Cells:"},c.totalCells.toLocaleString("en")),c.totalFOVs&&g.createElement(eo.A.Item,{label:"Number of FOVs:"},c.totalFOVs.toLocaleString("en")),c.totalTaggedStructures&&g.createElement(eo.A.Item,{label:"Number of tagged structures:"},c.totalTaggedStructures)),g.createElement(ie.Ay,{type:"primary",className:oo.loadButton},"Load"));return l?g.createElement("a",{href:l},f):f},co=function(e){var t=e.megaset,n=e.handleSelectDataset,r=getComputedStyle(document.body).getPropertyValue("--dataset-card-width"),a=Object.keys(t.datasets).length,o=a>1?"100%":r,l=(0,he.map)(t.datasets).sort(function(e,t){return e.index-t.index});return g.createElement("div",{key:t.name,className:"style__container--wG8VX",style:{maxWidth:o}},a>1&&g.createElement("div",{className:"style__megasetTitle--JTBkg"},t.title),g.createElement("div",{className:"style__datasetCards--UfwX8"},(0,he.map)(l,function(e){return g.createElement(io,(0,to.A)({key:e.id},e,{handleSelectDataset:n}))})),t.extra&&g.createElement("div",{className:"style__extra--ltgun"},t.extra),t.publications&&t.publications.length>0&&g.createElement("div",{className:"style__publications--Ut6Bo"},"Publications",t.publications.map(function(e){return g.createElement("div",{key:"".concat(t.name,"-").concat(e.title),className:"style__publication--WYEYy"},g.createElement("div",{className:"style__publicationTitle--Q4rKq"},g.createElement("a",{href:e.url,target:"blank"},e.title)),g.createElement("div",{className:"style__journalDate--Ie_nT"},e.citation,"."))})))},so=[{date:"May/26/2021",title:"The hiPSC single-cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/21/2022",title:"The hiPSC single i1 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_i1_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/20/2022",title:"The hiPSC single M1 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_m1_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/21/2022",title:"The hiPSC single i2 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_i2_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/20/2022",title:"The hiPSC single M2 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_m2_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/19/2022",title:"The hiPSC single edge cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_edge_cell_image_dataset/tree/latest/metadata.csv"},{date:"Sep/28/2022",title:"The hiPSC single non-edge cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_nonedge_cell_image_dataset/tree/latest/metadata.csv"}],uo="style__subtitle--XvF02 style__title--NfBvu",fo="style__section--rIc_K",po="style__section-content--RbA_O",mo="style__light-section--tJbzl style__section--rIc_K",ho="style__paragraph--IZ0BZ";var yo=W.A.Content;const go=function(e){var t=e.handleSelectDataset,n=e.megasets;return g.createElement(W.A,null,g.createElement(Q.A,{className:mo},g.createElement("h1",{className:uo},"Welcome to Cell Feature Explorer"),g.createElement($a.A,{className:po},g.createElement("div",{className:ho},"The Cell Feature Explorer (CFE) is an online tool to access segmented and processed images of over 200,000 cells as curated datasets. Each dataset has specific measured features, such as cellular volume and mitosis stage that are described in the user interface and detailed in publications associated with each dataset. The CFE is composed of a plot, where each cell is graphed by these measured features, and a 3D viewer for in-depth visual analysis."))),g.createElement(W.A,null,g.createElement(yo,{className:"style__content--tOv3o"},g.createElement(Q.A,{className:fo},g.createElement("div",{className:po},g.createElement("h2",{className:uo},"Load a dataset to get started"),g.createElement(Q.A,{className:"style__card-container--xhYX0"},n.map(function(e){return g.createElement(co,{key:e.name,megaset:e,handleSelectDataset:t})})))),g.createElement(Q.A,{className:mo},g.createElement($a.A,{className:po},g.createElement("h2",{className:uo},"Cell features in our data "),g.createElement("div",{className:ho},"hiPS cells from the"," ",g.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://www.allencell.org/cell-catalog.html"},"Allen Cell Collection")," ","grow in epithelial-like monolayer colonies when cultured on glass using our methods. We image rectangular fields of view (FOV) from these colonies in 3D, using spinning disk confocal microscopy. We collect four channels of data for each FOV, including one brightfield channel and three fluorescent channels:",g.createElement("ul",null,g.createElement("li",null,"dyed DNA "),g.createElement("li",null,"dyed cell membrane "),g.createElement("li",null,"one fluorescently labeled protein designed to visualize a particular organelle or cellular structure via endogenous tagging"))),g.createElement("div",{className:ho},"The fluorescent channels are segmented to demarcate structures and to define the boundaries of individual cells. The segmented structures are then measured, and the data for these measurements, as well as cell and nuclear shape modes (derived from a principal component analysis; please see our recent article in"," ",g.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://www.biorxiv.org/content/10.1101/2020.12.08.415562v1"},"bioRxiv"),") are made available for plotting at the top of the CFE tool page. The beautiful cells and the FOVs from which they were segmented can be explored in a 3D viewer at the bottom of the CFE tool page."))),g.createElement(Q.A,{className:fo},g.createElement($a.A,{className:po},g.createElement("h2",{className:uo},"Download cell feature data (via Quilt)"),g.createElement(Q.A,{className:fo},g.createElement(eo.A,{layout:"horizontal",colon:!1,column:1,style:{margin:"10px 0"}},g.createElement(eo.A.Item,{label:"RELEASE DATE"},"DATASET"),so.map(function(e,t){return g.createElement(g.Fragment,null,g.createElement(eo.A.Item,{label:e.date,key:t}," ",g.createElement("a",{target:"_blank",href:e.link,rel:"noreferrer"},e.title)))}))),g.createElement("div",{className:ho},"Once you navigate to Quilt, you can follow the instructions provided to access the cell feature data. If you need assistance, please visit the"," ",g.createElement("a",{href:"https://forum.allencell.org/tags/c/software-code/11/cell-feature-explorer"},"Allen Cell Discussion Forum"),"."))))))};var vo=n(87206),bo=n(4118);var Ao={flex:1,width:"100%",height:"100%",backgroundColor:"red"};const wo=function(e){return e.cellId?g.createElement("div",{className:"style__cell-viewer-container--Uybfp",style:Ao},g.createElement(na.TV,{viewerSettings:e.viewerSettings},g.createElement(na.N$,(0,to.A)({cellId:e.cellId,imageUrl:e.baseUrl+e.cellPath,imageDownloadHref:e.cellDownloadHref,parentImageUrl:e.fovPath?e.baseUrl+e.fovPath:"",parentImageDownloadHref:e.fovDownloadHref,viewerChannelSettings:e.viewerChannelSettings,transform:e.transform,onControlPanelToggle:e.onControlPanelToggle,metadata:e.metadata,appHeight:"100%",canvasMargin:"0 0 0 0"},e.appProps)))):null};var Co=n(40920);const Eo=function(e){var t=e.visible,n=e.handleClose,r=e.onDismissCheckboxChecked;return g.createElement(ce.A,{centered:!0,title:"Small Screen Warning",open:t,onOk:n,onCancel:n,footer:null},g.createElement("p",null,"Many features of this web tool are hidden while using it on a small screen."),g.createElement("p",null,"To access all features, including a tool to plot measurements for over 30,000 cells, please visit this web page on a larger screen."),g.createElement("div",{className:"style__checkbox-container--Oh8_b"},g.createElement(Co.A,{onChange:function(e){var t=e.target;return r(t.checked)}},"Don't show this message again.")),g.createElement("div",{className:"style__button-container--uU5cj"},g.createElement(ie.Ay,{className:"style__ok-button--dUxzH",onClick:n,type:"primary"},"OK")))};var So=n(47852),Do=n(53691),ko=n(16044),Po=n(59676),Oo=n(40756),xo=n(45824),_o=n(30761),Io=n(37977),To=n(73586),Fo=n(73938);function No(e){return Bo.apply(this,arguments)}function Bo(){return Bo=(0,ne.A)(oe().mark(function e(t){var n,r;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new To.A(t),e.next=1,(0,Fo.rk)(n);case 1:return r=e.sent,e.abrupt("return",r);case 2:case"end":return e.stop()}},e)})),Bo.apply(this,arguments)}function jo(e,t){var n=(0,g.useState)(e),r=(0,re.A)(n,2),a=r[0],o=r[1];return(0,g.useEffect)(function(){var n=function(){var n=(0,ne.A)(oe().mark(function n(){var r,a,l,i,c;return oe().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a=void 0,l=null!==(r=null==t?void 0:t.volumeviewerPath)&&void 0!==r?r:null==t?void 0:t.fovVolumeviewerPath,e&&e.endsWith(".zarr")?a=e:l&&l.endsWith(".zarr")&&(a=l),!a){n.next=4;break}return n.prev=1,n.next=2,No(a);case 2:return i=n.sent,o(i),n.abrupt("return");case 3:n.prev=3,c=n.catch(1),console.error("Error generating thumbnail for file ".concat(a," :"),c);case 4:case"end":return n.stop()}},n,null,[[1,3]])}));return function(){return n.apply(this,arguments)}}();n()},[e]),a}const Mo={container:"style__container--hMtze",small:"style__small--NUf0x","action-list":"style__action-list--k3zlB",actionList:"style__action-list--k3zlB",disabled:"style__disabled--loRMz",selected:"style__selected--BN2Ob",stage:"style__stage--cgwYC",placeholderAvatar:"style__placeholderAvatar--Swup9"},Ro=function(e){var t=jo(e.src,e.fileInfo),n=function(){e.handleOpenIn3D({id:e.cellID})},r=[];e.downloadHref&&r.push({key:"1",label:g.createElement("a",{href:e.downloadHref},g.createElement(Oo.A,null)," Segmented cell")}),e.downloadFullField&&r.push({key:"2",label:g.createElement("a",{href:e.downloadFullField},g.createElement(Oo.A,null)," Full field image")});var a=""!==e.downloadHref||""!==e.downloadFullField,o=[g.createElement(ie.Ay,{key:"".concat(e.cellID,"-load"),onClick:n},"3D"),g.createElement(ao.A,{key:"".concat(e.cellID,"-0"),type:"vertical"}),g.createElement(_o.A,{key:"".concat(e.cellID,"-download"),menu:{items:r},trigger:["click"],disabled:!a},g.createElement(Io.A,{key:"".concat(e.cellID,"-download"),title:a?null:V,trigger:["hover","focus"]},g.createElement(ie.Ay,{disabled:!a},g.createElement(Oo.A,null)))),g.createElement(ao.A,{key:"".concat(e.cellID,"-1"),type:"vertical"}),g.createElement(ie.Ay,{key:"".concat(e.cellID,"-close"),onClick:function(){e.handleDeselectPoint(e.cellID)}},g.createElement(So.A,null))];return g.createElement(Po.A.Item,{key:e.cellID,className:Mo.container,style:{width:e.widthPx},id:e.cellID?e.cellID.toString():"",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},g.createElement(no.A,{className:e.selected?Mo.selected:Mo.unselected,loading:e.empty,cover:t?g.createElement("img",{alt:"thumbnail of microscopy image",src:t,onClick:n}):g.createElement(xo.A,{onClick:n,style:{padding:"12px 0",fontSize:"".concat(e.widthPx/3,"px")}})},g.createElement(no.A.Meta,{className:Z()((0,f.A)({},Mo.small,e.widthPx<170)),title:e.category,description:g.createElement(se.A,{vertical:!0,justify:"space-between"},g.createElement(se.A,{vertical:!0},g.createElement("span",null,e.cellID),g.createElement("span",{style:{minHeight:"1.5em"}},e.mitoticStage&&g.createElement("span",{className:Mo.stage},e.mitoticStage))),!e.empty&&g.createElement("div",{className:Mo.actionList},o))})))};var Uo=n(81427);const Vo=function(e){var t=jo(e.src,e.fileInfo);return g.createElement(Po.A.Item,{key:e.cellID,className:"style__container--O2RRk",id:e.cellID?e.cellID.toString():"",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},g.createElement(Po.A.Item.Meta,{avatar:g.createElement("div",{onClick:function(){e.handleOpenIn3D({id:e.cellID})}},g.createElement(Uo.A,{className:Z()((0,f.A)({},"style__selected--H5lki",e.selected),"style__avatar--ymR_r"),alt:"thumbnail of microscopy image",src:t,icon:g.createElement(xo.A,{className:"style__placeholder-avatar--VUJ4u"})}))}))};var zo=n(1575);const Go=function(e){var t=e.setWidth,n=e.currentWidth;return g.createElement("div",{className:"gallery-card-slider"},g.createElement(se.A,{justify:"space-between",align:"center"},g.createElement("label",{style:{color:"#BFBFBF"}},"Size:"),g.createElement(zo.A,{style:{width:100},min:106,max:256,value:n,onChange:t,tooltip:{open:!1}})))};var Lo=(0,Dn.Mz)([Pn,mr],function(e,t){return(0,he.find)(e,{album_id:t})}),Ho=(0,Dn.Mz)([Lo],function(e){return e?e.title:"My Selections"}),Ko=(0,Dn.Mz)([Lo,nr,br],function(e,t,n){return e?n:t}),Wo=(0,Dn.Mz)([Dr,kn,Gn,Ko,Ar,gr,zn],function(e,t,n,r,a,o,l){if((0,he.isEmpty)(t.labels)||!r.length)return[];var i=t.values[e.key];return(0,he.map)(r,function(r){var c,s=r[x];if((c=void 0!==r.index&&r.index>0?r.index:t.labels[D].indexOf(s))<0)return{};var u="";if(!(0,he.isEmpty)(l)&&n.length){var d=n[c]||-1;u=l[d]?l[d].name:""}var f="";r[N]&&(f=Ee(a,Ce(s)));var p=r[_],m="";r[T]&&(m=Ee(a,we(p)));var h=Se(o,r.thumbnailPath),y=i[c];return{cellID:s,downloadHref:f,fullFieldDownloadHref:m,category:ke(e,y?y.toString():""),mitoticStage:u,src:h,fileInfo:r}})});const qo="style__container--wvA9t",Xo="style__gallery-header--gOeo8";function Yo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Zo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Zo=function(){return!!e})()}var Qo=pe.A.Search,Jo={inputStatus:void 0,message:"",thumbnailSize:128},$o={error:"That id is not in our dataset.",success:Jo.message,warning:"That cell is already in the gallery."},el=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,Zo()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"endOfAlbum",void 0),n.renderGalleryCard=n.renderGalleryCard.bind(n),n.renderMinGalleryCard=n.renderMinGalleryCard.bind(n),n.searchValidate=n.searchValidate.bind(n),n.resetSearch=n.resetSearch.bind(n),n.hoverCard=n.hoverCard.bind(n),n.unHover=n.unHover.bind(n),n.renderCollapsedView=n.renderCollapsedView.bind(n),n.renderFullView=n.renderFullView.bind(n),n.selectAlbum=n.selectAlbum.bind(n),n.closeGallery=n.closeGallery.bind(n),n.selectCell=n.selectCell.bind(n),n.endOfAlbum=g.createRef(),n.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yo(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},Jo),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"componentDidMount",value:function(){(0,this.props.getAlbumData)()}},{key:"componentDidUpdate",value:function(e){var t=this.endOfAlbum,n=this.props.clickedPoints;t.current&&e.clickedPoints.length!==n.length&&t.current.scrollIntoView({behavior:"smooth"})}},{key:"searchValidate",value:function(e){var t=this.props,n=t.clickedPoints,r=t.ids,a=t.addSearchedCell;return(0,he.includes)((0,he.map)(n,function(e){return e.toString()}),e)?this.setState({inputStatus:"warning",message:$o.warning}):(0,he.includes)(r,e)?(a({id:e}),this.setState({inputStatus:"success",message:$o.success})):void this.setState({inputStatus:"error",message:$o.error})}},{key:"resetSearch",value:function(){this.setState({inputStatus:Jo.inputStatus,message:Jo.message})}},{key:"selectAlbum",value:function(e){var t=e.target,n=this.props.handleSelectAlbum;t&&n(t.value)}},{key:"renderAlbumButtons",value:function(){var e=this.props,t=e.albumData,n=e.selectedAlbum,r=e.clickedPoints;return g.createElement(Do.A,{layout:"vertical",colon:!0},g.createElement(Do.A.Item,{label:"ALBUMS"},g.createElement(ue.Ay.Group,{defaultValue:n,onChange:this.selectAlbum,size:"large"},g.createElement(ue.Ay.Button,{key:"my-selections",value:0},"My Selections (".concat(r.length,")")),(0,he.map)(t,function(e){if(e.cell_ids)return e.cell_ids.length>0&&g.createElement(ue.Ay.Button,{key:e.album_id,value:e.album_id},e.title," (",e.cell_ids.length,")")}))))}},{key:"closeGallery",value:function(){(0,this.props.toggleGallery)(!0)}},{key:"selectCell",value:function(e){var t=this.props.handleOpenIn3D;return this.closeGallery(),this.props.openViewerTab(),t(e)}},{key:"renderFullView",value:function(){var e=this,t=this.props,n=t.data,r=t.handleClearAllSelectedPoints,a=t.selectedAlbum,o=t.selectedAlbumName,l=n.length>0?n:[{empty:!0}];return g.createElement(Q.A,{id:"gallery",className:qo,gutter:32,justify:"space-between"},g.createElement("div",{className:"style__gallery-grid--gvldu"},g.createElement("div",{className:Xo},g.createElement("h2",null,o),g.createElement(Go,{setWidth:function(t){return e.setState({thumbnailSize:t})},currentWidth:this.state.thumbnailSize}),n.length>0&&!a&&g.createElement(ko.A,{title:"Are you sure you want to unselect all?",onConfirm:r,okText:"Yes",cancelText:"No"},g.createElement(ie.Ay,null,g.createElement(So.A,null)," Clear All"))),g.createElement(Po.A,{itemLayout:"horizontal",grid:{gutter:16},className:"style__list--T_xfO",dataSource:l,renderItem:this.renderGalleryCard,footer:g.createElement("div",{ref:this.endOfAlbum})})),g.createElement("div",{className:"style__album-side-bar--kzFBa"},g.createElement("div",{className:"style__side-bar-header--LJXyh"},g.createElement("h2",null,"Thumbnail Gallery"),g.createElement(ie.Ay,{type:"text",onClick:this.closeGallery,style:{padding:0}},g.createElement(So.A,{style:{fontSize:"2em"}}))),g.createElement(Do.A.Item,{hasFeedback:!0,className:"style__search-for-cell--IdZGM",validateStatus:this.state.inputStatus,help:this.state.message},g.createElement(Qo,{placeholder:"add image by cell id",onSearch:this.searchValidate,onChange:this.resetSearch})),this.renderAlbumButtons()))}},{key:"renderCollapsedView",value:function(){var e=this.props.data,t=e.length>0?e:[{empty:!0}];return g.createElement("div",{id:"gallery",className:qo},g.createElement("div",{className:Xo},g.createElement("h2",null,"Gallery")),g.createElement(Po.A,{itemLayout:"horizontal",dataSource:t,renderItem:this.renderMinGalleryCard,footer:g.createElement("div",{ref:this.endOfAlbum})}))}},{key:"render",value:function(){var e=this.props.collapsed;return g.createElement(X.Ay,{theme:{components:{Radio:{colorPrimary:"#fffffa",colorPrimaryActive:"#fffc",colorPrimaryHover:"#fff"}}}},e?this.renderCollapsedView():this.renderFullView())}},{key:"hoverCard",value:function(e){var t=e.currentTarget,n=this.props.setHovered;if(t.id)return n(t.id);n(null)}},{key:"unHover",value:function(){(0,this.props.setHovered)(null)}},{key:"renderMinGalleryCard",value:function(e){var t=this.props,n=t.handleDeselectPoint,r=t.selectedCell,a=r?r.toString():"";return g.createElement(Vo,{onMouseEnter:this.hoverCard,onMouseLeave:this.unHover,category:e.category,src:e.src,selected:a===e.cellID,downloadHref:e.downloadHref,cellID:e.cellID,fileInfo:e.fileInfo,handleDeselectPoint:n,handleOpenIn3D:this.selectCell,empty:e.empty})}},{key:"renderGalleryCard",value:function(e){var t=this.props,n=t.handleDeselectPoint,r=t.selectedCell||"";return g.createElement(Ro,{onMouseEnter:this.hoverCard,onMouseLeave:this.unHover,category:e.category,mitoticStage:e.mitoticStage,src:e.src,selected:r===e.cellID,downloadHref:e.downloadHref,downloadFullField:e.fullFieldDownloadHref,cellID:e.cellID,fileInfo:e.fileInfo,handleDeselectPoint:n,handleOpenIn3D:this.selectCell,empty:e.empty,widthPx:this.state.thumbnailSize})}}])}(g.Component),tl={addSearchedCell:ct,getAlbumData:vn,handleClearAllSelectedPoints:st,handleDeselectPoint:it,handleOpenIn3D:dt,handleSelectAlbum:vt,setHovered:gt};const nl=(0,b.Ng)(function(e){return{albumData:Pn(e),clickedPoints:Gr(e),data:Wo(e),ids:Vr(e),selectedAlbum:mr(e),selectedAlbumName:Ho(e),selectedCell:cr(e)}},tl)(el);var rl=n(30696),al=n(90116);const ol={"plot-by-on-x":"style__plot-by-on-x--hPBYK",plotByOnX:"style__plot-by-on-x--hPBYK","plot-by-on-y":"style__plot-by-on-y--AZkRk",plotByOnY:"style__plot-by-on-y--AZkRk"};function ll(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ll=function(){return!!e})()}var il=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,ll()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).handleChange=n.handleChange.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"handleChange",value:function(e){var t=e;this.props.onChange(t)}},{key:"render",value:function(){var e,t=this.props,n=t.classKey,r=void 0===n?"":n,a=t.value,o=t.options,l=t.tooltip,i=o.map(function(e){return{label:"".concat(e.displayName," ").concat(e.unit?"(".concat(e.unit,")"):""),key:e.key,value:e.key,tooltip:e.tooltip}}),c=null===(e=i.find(function(e){return e&&e.key===a}))||void 0===e||null===(e=e.label)||void 0===e?void 0:e.toString();return g.createElement("div",{className:ol[r]},g.createElement(Io.A,{title:l},g.createElement(al.A,{onChange:this.handleChange,value:c||a,options:i})))}}])}(g.Component),cl=n(52120),sl=n(26067);function ul(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function dl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ul(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ul(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function fl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(fl=function(){return!!e})()}var pl="alreadyDownloaded",ml=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,fl()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"popupContainerRef",void 0),n.onClose=n.onClose.bind(n),n.onDownload=n.onDownload.bind(n),n.saveDownloadUrl=n.saveDownloadUrl.bind(n),n.handleMenuClick=n.handleMenuClick.bind(n),n.handleDownloadMenuVisibleChange=n.handleDownloadMenuVisibleChange.bind(n),n.state={alreadyDownloaded:localStorage.getItem(pl)?JSON.parse(localStorage.getItem(pl)):{},downloadMenuVisible:!1},n.popupContainerRef=g.createRef(),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onClose",value:function(e){var t=e.currentTarget,n=this.props.handleClose;t&&t.id&&n&&n(t.id)}},{key:"onDownload",value:function(e){var t=e.currentTarget,n=this.props.handleDownload;t&&t.id&&n&&n(t.id)}},{key:"saveDownloadUrl",value:function(e){var t=this.props.downloadConfig,n=this.state.alreadyDownloaded,r=n[t.key];r?this.setState({alreadyDownloaded:dl(dl({},n),{},(0,f.A)({},t.key,(0,he.uniq)([].concat((0,xt.A)(r),[e.key]))))}):this.setState({alreadyDownloaded:dl(dl({},n),{},(0,f.A)({},t.key,[e.key]))})}},{key:"handleDownloadMenuVisibleChange",value:function(e){localStorage.setItem(pl,JSON.stringify(this.state.alreadyDownloaded)),this.setState({downloadMenuVisible:!!e})}},{key:"handleMenuClick",value:function(){var e=this.props,t=e.downloadUrls,n=e.downloadConfig,r=this.state.alreadyDownloaded[n.key];r&&r.length===t.length&&this.setState({downloadMenuVisible:!1})}},{key:"render",value:function(){var e=this,t=this.props,n=t.id,r=t.downloadUrls,a=t.downloadConfig,o=t.downloadRoot,l=this.state.alreadyDownloaded[a.key],i={items:r.map(function(t,n){return{key:n,onClick:e.saveDownloadUrl,label:g.createElement(g.Fragment,null,(0,he.includes)(l,n.toString())?g.createElement(sl.A,null):g.createElement(Oo.A,null),g.createElement("a",{href:t}," data chunk ",n+1," "))}}),onClick:this.handleMenuClick},c=""===o;return g.createElement("div",{className:"style__container--AElaZ",ref:this.popupContainerRef},g.createElement(Io.A,{title:c?V:null},g.createElement(_o.A,{menu:i,trigger:["click"],onOpenChange:this.handleDownloadMenuVisibleChange,open:this.state.downloadMenuVisible,placement:"bottomRight",autoAdjustOverflow:!1,getPopupContainer:function(){return e.popupContainerRef.current||document.body}},g.createElement(ie.Ay,{size:"small",className:c?"style__disabled-download--WYcUx":"ant-dropdown-link",id:n,onClick:c?void 0:this.onDownload,disabled:c},g.createElement(Oo.A,null)))))}}])}(g.Component);(0,f.A)(ml,"defaultProps",{closeable:!1,downloadUrls:[],hideable:!0});function hl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(hl=function(){return!!e})()}var yl=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,hl()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).onClose=n.onClose.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onClose",value:function(e){var t=e.currentTarget,n=this.props.handleClose;t&&t.id&&n&&n(t.id)}},{key:"render",value:function(){var e=this.props,t=e.closeable,n=e.hideable,r=e.showTooltips,a=e.disabled,o=e.id,l=e.color,i=e.name,c=e.total,s=e.onBarClicked,u=e.checked,d=e.downloadUrls,f=e.downloadConfig,p=e.downloadRoot,m=e.handleDownload,h=g.createElement("div",null,o),y=a?"style__label-disabled--_3phL":"style__label--HnODt";return g.createElement("div",{className:"style__container--r1icz"},g.createElement("div",{className:"style__first-column--qxIuw"},n&&g.createElement(Co.A,{onChange:s,value:o,defaultChecked:!0,checked:u,disabled:a}),g.createElement(cl.A,{style:{backgroundColor:l,padding:4},dot:!0}),r?g.createElement(Io.A,{placement:"right",title:h},g.createElement("span",{className:y},i)):g.createElement("span",{className:y},i)),g.createElement("div",null,g.createElement("span",{className:y},c),g.createElement(ml,{color:l,id:o,name:i,total:c,downloadConfig:f,downloadUrls:d,downloadRoot:p,handleDownload:m}),t&&g.createElement(ie.Ay,{size:"small",id:o,onClick:this.onClose},g.createElement(So.A,null))))}}])}(g.Component);(0,f.A)(yl,"defaultProps",{closeable:!1,downloadUrls:[],hideable:!0});const gl=function(e){var t=e.showTooltips,n=e.closeable,r=e.downloadUrls,a=e.handleCloseSelectionSet,o=e.handleDownload,l=e.downloadConfig,i=e.downloadRoot,c=e.hideable,s=e.onBarClicked,u=e.panelData;return g.createElement(g.Fragment,null,(0,he.map)(u,function(e){return g.createElement(yl,{key:e.id,showTooltips:t,closeable:n,checked:e.checked,hideable:c,disabled:e.disabled||!1,color:e.color,name:e.name,total:e.total,id:e.id,onBarClicked:s,handleClose:a,handleDownload:o,downloadUrls:r,downloadConfig:l,downloadRoot:i})}))};var vl=n(12609);const bl="style__color-by-switch--f9FIL",Al="style__color-by-row--YXw6H",wl="style__label--UPyKE",Cl=function(e){return e.includeCol?g.createElement(Q.A,{className:Al,align:"middle"},g.createElement($a.A,{span:e.includeCol},g.createElement("label",{className:wl},"Color by:"),g.createElement(vl.A,{className:bl,defaultChecked:e.defaultChecked,checkedChildren:e.checkedChildren,unCheckedChildren:e.unCheckedChildren,onChange:e.handleChange})),e.children):g.createElement(Q.A,{className:Al,align:"middle"},g.createElement("label",{className:wl},e.label),g.createElement(vl.A,{className:bl,defaultChecked:e.defaultChecked,onChange:e.handleChange}))},El="style__label--TpoXl";function Sl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Sl=function(){return!!e})()}var Dl=function(e){function t(e){return(0,p.A)(this,t),n=this,r=t,a=[e],r=(0,H.A)(r),(0,L.A)(n,Sl()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a));var n,r,a}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=e.name,r=e.total;return g.createElement("div",{className:"style__container--f9hih"},g.createElement("div",{className:"style__first-column--PD1I1"},g.createElement(cl.A,{style:{backgroundColor:t,padding:4},dot:!0}),g.createElement("span",{className:El},n)),g.createElement("div",null,g.createElement("span",{className:El},r)))}}])}(g.Component),kl=function(e){return e.CONTINUOUS="continuous",e.GROUPED="grouped",e}({}),Pl=(0,Dn.Mz)([Tr,Fr,_r],function(e,t,n){for(var r=new Set,a=0;a<e.length;a++)null!==e[a]&&null!==t[a]&&r.add(n[a]);return(0,xt.A)(r)}),Ol=(0,Dn.Mz)([Dr],function(e){return e.displayName}),xl=(0,Dn.Mz)([ir,Pr],function(e,t){return e.length>0&&e.length!==t.length}),_l=(0,Dn.Mz)([Or,tr,ar],function(e,t,n){return n===t?[]:e}),Il=(0,Dn.Mz)([tr,ar,kr,ir,Pl,_r],function(e,t,n,r,a,o){var l,i,c,s,u=(0,he.reduce)(o,function(e,t){return e[t]=(e[t]||0)+1,e},{}),d=(l=n,i=(0,he.map)(l,function(e){return e.name}),c=(0,he.map)(l,function(e){return e.key||""}),s=i.filter(function(e,t){return i.indexOf(e)!==t}),i.map(function(e,t){return s.includes(e)?"".concat(e," (").concat(c[t],")"):e}));return(0,he.map)(n,function(n,o){var l,i,c,s,f=n.name,p=n.key||f,m=u[p]||n.count||0,h=!a.includes(p),y=(l=t===e,i=(0,he.includes)(r,p),c=h,s=n.color,c?R:i?"#000":l?s:R);return{checked:!(0,he.includes)(r,p),color:y,id:p,name:d[o],disabled:h,total:m}})}),Tl=(0,Dn.Mz)([sr,lr,Xr,Yr],function(e,t,n,r){return(0,he.map)(n,function(n,a){var o=e?(0,he.values)(t)[a]:R,l=Number(n)?a:n;return{color:o,id:n.toString(),name:l.toString(),total:r[a]}})}),Fl=(0,Dn.Mz)([Rn,_r,ur,rr],function(e,t,n,r){var a=[];return n.type===B?(0,he.reduce)(t,function(t,r,a){return r===n.key&&t.push(Ce(e.cellIds[a])),t},a):n.type===j?r[n.key].map(function(e){return Ce(e.cellId)}):a}),Nl=(0,Dn.Mz)([Ar,Fl],function(e,t){if(""===e)return[];var n=(0,he.chunk)(t,300);return(0,he.map)(n,function(t){return"".concat(e).concat((0,he.map)(t,function(e){return"&id=".concat(e)}).join(""))})});function Bl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function jl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ml(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jl(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jl(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Rl=(0,Dn.Mz)([Br],function(e){var t=e.labels.thumbnailPaths,n=e.labels.sourcePaths,r=e.indices;return(0,he.map)(r,function(e,r){return{index:e,thumbnailPath:t[r],srcPath:null==n?void 0:n[r]}})}),Ul=(0,Dn.Mz)([Rr,Ur,Vr,Rl,zr,ar,tr,Or,Vn],function(e,t,n,r,a,o,l,i,c){var s=function(e,t){var n=!1,r=e.slice(),a=t.slice();if(r.length!==a.length)return console.error("Cannot handleNullValues between two arrays because they have unequal length"),{xValues:r,yValues:a};for(var o=0;o<r.length;o++)null===r[o]?a[o]=null:null===a[o]?r[o]=null:n=!0;return n||(r=[],a=[]),{xValues:r,yValues:a}}(e,t);return(0,he.includes)(c,o)?{color:o===l?void 0:a,dataType:kl.GROUPED,groupSettings:i,groups:a,ids:n,x:s.xValues,y:s.yValues,customdata:r}:{color:o===l?void 0:a,dataType:kl.CONTINUOUS,ids:n,x:s.xValues,y:s.yValues,customdata:r}}),Vl=(0,Dn.Mz)([Br,nr,$n,er,pr],function(e,t,n,r,a){return(0,he.isEmpty)(e.values)||(0,he.isEmpty)(e.labels)?[]:t.reduce(function(t,o){var l=o[x],i=o[_]||"",c=o[F]||"",s=e.labels[D],u=void 0!==o.index?o.index:(0,he.findIndex)(s,function(e){return e===l}),d=e.values[n][u],f=e.values[r][u];return u>=0&&null!==d&&null!==f&&t.push({cellID:l,fovID:i,hovered:l===a,pointIndex:u,x:d,y:f,thumbnailPath:c}),t},[])}),zl=(0,Dn.Mz)([Ul,sr,qr],function(e,t,n){var r=Ml(Ml({},e),{},{plotName:k});return e.dataType===kl.GROUPED&&r.dataType===kl.GROUPED&&(r.groupSettings=Ml({},e.groupSettings)),{mainPlotData:r,selectedGroupPlotData:t?Ml(Ml({},n),{},{dataType:"continuous",plotName:"selections-scatter-plot"}):null}});function Gl(e){return function(e,t){return t.dataType===kl.GROUPED?Ml(Ml({},e),{},{transforms:[{groups:t.groups,nameformat:"%{group}",styles:(0,he.map)(t.groupSettings,function(e){return{target:e.name,value:{marker:{color:e.color,opacity:U.unselectedCircleOpacity}}}}),type:"groupby"}]}):Ml(Ml({},e),{},{marker:Ml(Ml({},e.marker),{},{color:t.color,opacity:t.opacity||U.unselectedCircleOpacity})})}({hoverinfo:"none",ids:e.ids,customdata:e.customdata,marker:{size:U.circleRadius,symbol:"circle"},mode:"markers",name:e.plotName,showlegend:!1,type:"scattergl",x:e.x,y:e.y,z:[]},e)}function Ll(e){return{marker:{color:U.histogramColor,line:{color:U.textColor,width:1}},name:"x histogram",nbinsx:60,showlegend:!1,type:"histogram",x:e,yaxis:"y2"}}function Hl(e){return{marker:{color:U.histogramColor,line:{color:U.textColor,width:1}},name:"y histogram",nbinsy:60,showlegend:!1,type:"histogram",xaxis:"x2",y:e}}var Kl=(0,Dn.Mz)([zl],function(e){var t=e.mainPlotData,n=e.selectedGroupPlotData,r=[Ll(t.x),Hl(t.y),Gl(t)];return n&&r.push(Gl(n)),r}),Wl=(0,Dn.Mz)([Tn],function(e){return e}),ql=(0,Dn.Mz)([Tn],function(e){return e}),Xl=(0,Dn.Mz)([Tn,Ol],function(e){return e}),Yl=(0,Dn.Mz)([Tn,Ol],function(e){return e.filter(function(e){return e.discrete})}),Zl=function(e){return{tickText:(0,he.map)(e,"name"),tickValues:(0,he.map)(e,function(e,t){return Number(t)})}},Ql=(0,Dn.Mz)([$n,Tn],function(e,t){var n=De(t,e);return n&&n.discrete?Zl(n.options):{tickText:[""],tickValues:[0]}}),Jl=(0,Dn.Mz)([er,Tn],function(e,t){var n=(0,he.find)(t,{key:e});return n&&n.discrete?Zl(n.options):{tickText:[""],tickValues:[0]}}),$l=(0,Dn.Mz)([fr,_r],function(e,t){return e&&t.length&&void 0!==e.index?Ml(Ml({},e),{},(0,f.A)({},O,t[e.index])):e}),ei=function(e){var t,n,r,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Bl(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bl(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;null!=o&&((void 0===t||o<t)&&(t=o),(void 0===n||o>n)&&(n=o))}}catch(e){a.e(e)}finally{a.f()}if(void 0!==t&&void 0!==n)return[t,n]},ti=(0,Dn.Mz)([Tr],function(e){return ei(e)}),ni=(0,Dn.Mz)([Fr],function(e){return ei(e)});const ri={"feature-select-row":"style__feature-select-row--eh5Bh",featureSelectRow:"style__feature-select-row--eh5Bh",collapse:"style__collapse--wx7CK","interactive-legend-container":"style__interactive-legend-container--gmX26",interactiveLegendContainer:"style__interactive-legend-container--gmX26","interactive-legend-header":"style__interactive-legend-header--pn9jS",interactiveLegendHeader:"style__interactive-legend-header--pn9jS"};function ai(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ai=function(){return!!e})()}var oi=rl.A.Panel,li=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,ai()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).onBarClicked=n.onBarClicked.bind(n),n.onActivePanelChange=n.onActivePanelChange.bind(n),n.renderTaggedStructuresPanel=n.renderTaggedStructuresPanel.bind(n),n.renderSelectionPanel=n.renderSelectionPanel.bind(n),n.allOnOff=n.allOnOff.bind(n),n.onCategorySetDownloadButtonClicked=n.onCategorySetDownloadButtonClicked.bind(n),n.onSelectionSetDownloadButtonClicked=n.onSelectionSetDownloadButtonClicked.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onBarClicked",value:function(e){var t=e.target,n=this.props,r=n.handleFilterByCategoryName,a=n.filtersToExclude;r((0,he.includes)(a,t.value)?(0,he.filter)(a,function(e){return e!==t.value}):[].concat((0,xt.A)(a),[t.value]))}},{key:"onCategorySetDownloadButtonClicked",value:function(e){(0,this.props.handleChangeDownloadSettings)({key:e,type:B})}},{key:"onSelectionSetDownloadButtonClicked",value:function(e){(0,this.props.handleChangeDownloadSettings)({key:e,type:j})}},{key:"allOnOff",value:function(e){var t=e.target,n=this.props,r=n.handleFilterByCategoryName,a=n.interactivePanelData;if(t.checked)return r([]);r(a.map(function(e){return e.id}))}},{key:"onActivePanelChange",value:function(e){(0,this.props.onPanelClicked)(e)}},{key:"renderSelectionPanel",value:function(){var e=this.props,t=e.downloadUrls,n=e.downloadConfig,r=e.downloadRoot,a=e.handleApplyColorSwitchChange,o=e.selectionSetsPanelData,l=e.handleCloseSelectionSet;return 0===o.length?g.createElement("span",null,"No selected sets yet. Make a selection on the plot using the",g.createElement("strong",null," Lasso Select")," or",g.createElement("strong",null," Box Select")," tools on the plot, and it will get saved here."):g.createElement(g.Fragment,null,g.createElement(Cl,{defaultChecked:!0,handleChange:a,label:"Show selections: "}),g.createElement("div",null,g.createElement(gl,{closeable:!0,hideable:!1,showTooltips:!1,handleCloseSelectionSet:l,panelData:o,downloadUrls:t,downloadConfig:n,downloadRoot:r,handleDownload:this.onSelectionSetDownloadButtonClicked})))}},{key:"renderTaggedStructuresPanel",value:function(){var e=this.props,t=e.filtersToExclude,n=e.isInIndeterminateState,r=e.interactivePanelData,a=e.downloadUrls,o=e.downloadConfig,l=e.downloadRoot,i=e.colorBy,c=e.groupBy,s=e.colorByMenuOptions,u=e.groupByDisplayOptions,d=e.handleChangeAxis,f=e.handleChangeGroupByCategory,p=e.colorForPlot,m=e.categoryCounts,h=e.categoricalFeatures,y=(0,he.includes)(h,i)&&i!==c;return g.createElement(g.Fragment,null,g.createElement(Q.A,{className:ri.featureSelectRow},g.createElement($a.A,{span:4},"Color by:"),g.createElement($a.A,{span:20},g.createElement(il,{value:i.toString(),options:s,onChange:function(e){d(P,e)},tooltip:xr(i.toString(),s)}))),g.createElement(Q.A,{className:ri.featureSelectRow},g.createElement($a.A,{span:4},"Group by:"),g.createElement($a.A,{span:20},g.createElement(il,{value:c.toString(),options:u,onChange:function(e){f(e)},tooltip:xr(c.toString(),u)}))),g.createElement("div",{className:ri.interactiveLegendContainer},g.createElement("div",null,g.createElement("div",{className:ri.interactiveLegendHeader},g.createElement(Co.A,{indeterminate:n,checked:0===t.length,onChange:this.allOnOff},"Show/Hide all"),g.createElement("span",{className:ri.label},"# of cells")),g.createElement(gl,{closeable:!1,showTooltips:!0,panelData:r,downloadUrls:a,downloadConfig:o,downloadRoot:l,hideable:!0,onBarClicked:this.onBarClicked,handleDownload:this.onCategorySetDownloadButtonClicked})),y&&g.createElement(Q.A,{className:ri.featureSelectRow},g.createElement("div",{className:ri.interactiveLegendHeader},g.createElement("div",null," Color legend "),g.createElement("span",{className:ri.label},"# of cells")),p.map(function(e,t){return g.createElement(Dl,{color:e.color,name:e.label,key:e.name,total:m[t]})}))))}},{key:"render",value:function(){var e=this.props,t=e.defaultActiveKey,n=e.openKeys,r=e.panelKeys;return g.createElement(rl.A,{className:ri.collapse,defaultActiveKey:t,activeKey:n,onChange:this.onActivePanelChange},g.createElement(oi,{key:r[0],header:"Plot configuration"},this.renderTaggedStructuresPanel()),g.createElement(oi,{key:r[1],header:"Selected sets"},this.renderSelectionPanel()))}}])}(g.Component),ii={handleApplyColorSwitchChange:Zr.actions.toggleApplySelectionSetColors,handleChangeAxis:Zr.actions.changeAxis,handleChangeGroupByCategory:Zr.actions.changeGroupByCategory,handleChangeDownloadSettings:Zr.actions.changeDownloadSettings,handleCloseSelectionSet:Zr.actions.deselectGroupOfPoints,handleFilterByCategoryName:Zr.actions.toggleFilterByCategoryName};const ci=(0,b.Ng)(function(e){return{categoryCounts:Zr.selectors.getColorByCategoryCounts(e),colorBy:Zr.selectors.getColorBySelection(e),groupBy:Zr.selectors.getGroupByCategory(e),colorByMenuOptions:Xl(e),groupByDisplayOptions:Yl(e),colorForPlot:_l(e),categoricalFeatures:Ja.selectors.getCategoricalFeatureKeys(e),downloadConfig:Zr.selectors.getDownloadConfig(e),downloadUrls:Nl(e),downloadRoot:Ar(e),filtersToExclude:Zr.selectors.getFiltersToExclude(e),groupByTitle:Ol(e),interactivePanelData:Il(e),selectionSetsPanelData:Tl(e),isInIndeterminateState:xl(e)}},ii)(li);var si=n(28073),ui=n(29248),di=n(91236);function fi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fi(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fi(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function mi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(mi=function(){return!!e})()}var hi={color:U.textColor,domain:[.86,1],hoverformat:"f",linecolor:U.textColor,showgrid:!1,tickcolor:U.textColor,zeroline:!0},yi=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,mi()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).makeAnnotations=n.makeAnnotations.bind(n),n.clickedAnnotation=n.clickedAnnotation.bind(n),n.resize=n.resize.bind(n),n.state={layout:{annotations:n.makeAnnotations(),autosize:!0,height:window.innerHeight-U.heightMargin,hovermode:"closest",legend:U.legend,margin:U.margin,paper_bgcolor:U.backgroundColor,plot_bgcolor:U.backgroundColor,xaxis:n.makeAxis([0,.85],".1f",!1,e.xAxisType,e.xTickConversion,e.xAxisRange),xaxis2:hi,yaxis:n.makeAxis([0,.85],".1f",!1,e.yAxisType,e.yTickConversion,e.yAxisRange),yaxis2:hi},height:window.innerHeight,showFullAnnotation:!0},n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"componentDidUpdate",value:function(e,t){var n=this.props,r=n.xAxisType,a=n.yAxisType,o=n.xTickConversion,l=n.yTickConversion,i=n.xAxisRange,c=n.yAxisRange;o===e.xTickConversion&&l===e.yTickConversion&&i===e.xAxisRange&&c===e.yAxisRange||this.setState({layout:pi(pi({},this.state.layout),{},{annotations:this.makeAnnotations(),xaxis:this.makeAxis([0,.85],".1f",!1,r,o,i),yaxis:this.makeAxis([0,.85],".1f",!1,a,l,c)})}),this.state.height!==t.height&&this.setState({layout:pi(pi({},this.state.layout),{},{height:this.state.height-U.heightMargin})})}},{key:"resize",value:function(){this.setState(function(){return{height:window.innerHeight}})}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"clickedAnnotation",value:function(){this.setState({showFullAnnotation:!1})}},{key:"makeAxis",value:function(e,t,n,r,a,o){return{color:U.textColor,domain:e,hoverformat:t,linecolor:U.textColor,showgrid:!1,tickcolor:U.textColor,tickmode:r,ticktext:a.tickText,tickvals:a.tickValues,zeroline:n,range:o}}},{key:"makeAnnotations",value:function(){var e=this,t=this.props.annotations,n=function(e,t){return t?"Cell ".concat(e.cellID,"<br><i>click thumbnail in gallery<br>on the right to load in 3D</i>"):e.hovered?"Cell ".concat(e.cellID):""};return t.map(function(r,a){var o=a+1===t.length&&e.state.showFullAnnotation,l=!!o||!!r.hovered;return{align:"left",arrowcolor:r.hovered?"#7440f1":"#ffffffab",arrowhead:6,ax:0,ay:o?-60:r.hovered?-20:0,bgcolor:"#00000094",bordercolor:r.hovered?"#7440f1":"#ffffffab",borderpad:l?4:0,borderwidth:1,captureevents:!0,cellID:r.cellID,font:{color:"#ffffff",family:"tahoma, arial, verdana, sans-serif",size:11},fovID:r.fovID,pointIndex:r.pointIndex,text:n(r,o),x:r.x,y:r.y}})}},{key:"render",value:function(){var e=this.props,t=e.onPointClicked,n=e.onPointHovered,r=e.onPointUnhovered,a=e.onGroupSelected,o=e.plotDataArray;return g.createElement(di.A,{data:o,useResizeHandler:!0,layout:this.state.layout,config:{responsive:!0,displayModeBar:!0,displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud","toImage","resetScale2d","hoverClosestCartesian","hoverCompareCartesian","toggleSpikelines"]},onClick:t,onClickAnnotation:this.clickedAnnotation,onHover:n,onUnhover:r,onSelected:a})}}])}(g.Component),gi=g.forwardRef(function(e,t){return g.createElement("div",{ref:t,style:{left:"".concat(e.pageX+10,"px"),top:"".concat(e.pageY,"px"),position:"absolute"}},e.children)});gi.displayName="MouseFollower";const vi=gi;var bi=no.A.Meta;const Ai=function(e){var t=e.src?g.createElement("img",{alt:"thumbnail of microscopy image",src:e.src}):g.createElement("div",{className:"style__placeholder-container--ofudX"},g.createElement(xo.A,null));return g.createElement(no.A,{className:"style__container--GYGx9",cover:t},g.createElement(bi,{description:e.description,title:e.title}))};function wi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(wi=function(){return!!e})()}var Ci=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,wi()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"popoverContainer",void 0),(0,f.A)(n,"thumbnailTimeout",0),n.popoverContainer=g.createRef(),n.state={cellIdToZarrThumbnailUrl:new Map},n.onPointClicked=n.onPointClicked.bind(n),n.onPointHovered=n.onPointHovered.bind(n),n.onPointUnhovered=n.onPointUnhovered.bind(n),n.onGroupSelected=n.onGroupSelected.bind(n),n.onPlotUnhovered=n.onPlotUnhovered.bind(n),n.renderPopover=n.renderPopover.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onPointClicked",value:function(e){var t=e.points,n=this.props,r=n.clickedPoints,a=n.handleSelectPoint,o=n.handleDeselectPoint;t.forEach(function(e){e.data.name===k&&((0,he.includes)(r,e.id)?o(e.id):e.fullData.marker.opacity&&a({id:e.id,index:e.customdata.index}))})}},{key:"updateThumbnails",value:function(e,t){this.setState(function(n){var r=n.cellIdToZarrThumbnailUrl;r.delete(e);var a=[[e,t]].concat((0,xt.A)(Array.from(r.entries()))).slice(0,250);return{cellIdToZarrThumbnailUrl:new Map(a)}})}},{key:"loadThumbnailForZarr",value:(n=(0,ne.A)(oe().mark(function e(t,n){var r,a;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.cellIdToZarrThumbnailUrl.has(t)){e.next=1;break}return e.abrupt("return");case 1:if(null!==this.state.cellIdToZarrThumbnailUrl.get(t)){e.next=2;break}return e.abrupt("return");case 2:if(this.updateThumbnails(t,null),!n||!n.endsWith(".zarr")){e.next=6;break}return e.prev=3,e.next=4,No(n);case 4:r=e.sent,this.updateThumbnails(t,r),e.next=6;break;case 5:e.prev=5,a=e.catch(3),console.error("Error generating thumbnail for Zarr:",a);case 6:case"end":return e.stop()}},e,this,[[3,5]])})),function(e,t){return n.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.state.cellIdToZarrThumbnailUrl.clear()}},{key:"onPointHovered",value:function(e){var t=this,n=e.points,r=e.event,a=this.props,o=a.filtersToExclude,l=a.updateMousePosition,i=a.changeHoveredPoint;l({pageX:r.pageX,pageY:r.pageY}),n.forEach(function(e){e.data.name!==k||(0,he.includes)(o,e.fullData.name)?i(null):(window.clearTimeout(t.thumbnailTimeout),i((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},x,e.id),"index",e.customdata.index),"thumbnailPath",e.customdata.thumbnailPath),"srcPath",e.customdata.srcPath)),t.loadThumbnailForZarr(e.id,e.customdata.srcPath))})}},{key:"onPointUnhovered",value:function(){var e=this;this.thumbnailTimeout=window.setTimeout(function(){return e.props.changeHoveredPoint(null)},500)}},{key:"onPlotUnhovered",value:function(e){var t=e.relatedTarget,n=this.props.changeHoveredPoint;t.className&&n(null)}},{key:"onGroupSelected",value:function(e){if(e){var t=e.points,n=this.props,r=n.handleLassoOrBoxSelect,a=n.handleSelectionToolUsed;r(Date.now().valueOf().toString(),(0,he.map)((0,he.filter)(t,function(e){return e.data.name===k}),function(e){return{pointIndex:e.customdata.index,cellId:e.id}})),a()}}},{key:"renderPopover",value:function(){var e,t=this.props,n=t.hoveredPointData,r=t.galleryCollapsed,a=Se(t.thumbnailRoot,(null==n?void 0:n.thumbnailPath)||"");return!a&&null!=n&&n.CellId&&(a=null!==(e=this.state.cellIdToZarrThumbnailUrl.get(n.CellId))&&void 0!==e?e:void 0),n&&r&&g.createElement(Ai,{title:n[O]||"",description:n[x].toString(),src:a})}},{key:"render",value:function(){var e=this,t=this.props,n=t.annotations,r=t.plotDataArray,a=t.mousePosition,o=t.xDropDownValue,l=t.yDropDownValue,i=t.yDropDownOptions,c=t.xDropDownOptions,s=t.handleChangeAxis,u=t.yTickConversion,d=t.xTickConversion,f=t.categoricalFeatures,p=t.xAxisRange,m=t.yAxisRange;if(0===r.length)return null;var h=this.renderPopover();return g.createElement(g.Fragment,null,g.createElement(vi,{ref:this.popoverContainer,pageX:a.pageX,pageY:a.pageY},g.createElement(si.A,{placement:"right",content:h,open:!!h,getPopupContainer:function(){return e.popoverContainer.current||document.body},id:"thumbnail-popover"})),g.createElement("div",{id:"main-plot",className:"style__container--UHk47",onMouseLeave:this.onPlotUnhovered},g.createElement(il,{classKey:E,value:o,options:c,onChange:function(e){s(E,e)},tooltip:xr(o,c)}),g.createElement("div",{className:"style__glossary-link--A_hFy"},g.createElement("a",{href:"https://www.allencell.org/glossary-of-cell-features-v2.html",target:"_blank",rel:"noreferrer"},g.createElement(ui.A,null)," Open axis glossary")),g.createElement(il,{classKey:S,value:l,options:i,onChange:function(e){s(S,e)},tooltip:xr(l,i)}),g.createElement(yi,{plotDataArray:r,onPointClicked:this.onPointClicked,annotations:n,onGroupSelected:this.onGroupSelected,onPointHovered:this.onPointHovered,onPointUnhovered:this.onPointUnhovered,xAxisType:(0,he.includes)(f,o)?"array":"auto",yAxisType:(0,he.includes)(f,l)?"array":"auto",yTickConversion:u,xTickConversion:d,xAxisRange:p,yAxisRange:m})))}}]);var n}(g.Component),Ei={changeHoveredPoint:Zr.actions.changeHoveredPoint,handleChangeAxis:Zr.actions.changeAxis,handleDeselectPoint:Zr.actions.deselectPoint,handleLassoOrBoxSelect:Zr.actions.lassoOrBoxSelectGroup,handleSelectPoint:Zr.actions.selectPoint,requestCellFileInfoData:Ja.actions.requestCellFileInfoData,requestFeatureData:Ja.actions.requestFeatureData,updateMousePosition:Zr.actions.changeMousePosition};const Si=(0,b.Ng)(function(e){return{annotations:Vl(e),clickedPoints:Zr.selectors.getClickedScatterPoints(e),categoricalFeatures:Ja.selectors.getCategoricalFeatureKeys(e),filtersToExclude:Zr.selectors.getFiltersToExclude(e),galleryCollapsed:Zr.selectors.getGalleryCollapsed(e),hoveredPointData:$l(e),mousePosition:Zr.selectors.getMousePosition(e),plotDataArray:Kl(e),thumbnailRoot:Zr.selectors.getThumbnailRoot(e),xDropDownOptions:Wl(e),xDropDownValue:Zr.selectors.getPlotByOnX(e),xTickConversion:Ql(e),yDropDownOptions:ql(e),yDropDownValue:Zr.selectors.getPlotByOnY(e),yTickConversion:Jl(e),xAxisRange:ti(e),yAxisRange:ni(e)}},Ei)(Ci);function Di(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Di=function(){return!!e})()}var ki=W.A.Content,Pi=W.A.Sider,Oi=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,Di()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"state",{defaultActiveKey:[t.panelKeys[0]],openKeys:[t.panelKeys[0]],width:window.innerWidth}),(0,f.A)(e,"onSelectionToolUsed",function(){e.setState({openKeys:(0,he.uniq)([].concat((0,xt.A)(e.state.openKeys),[t.panelKeys[1]]))})}),(0,f.A)(e,"onPanelClicked",function(t){e.setState({openKeys:t})}),e}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.state,n=e.openKeys,r=e.defaultActiveKey;return g.createElement(W.A,null,g.createElement(Pi,{className:"style__color-menu--BxPlR",width:500,collapsible:!1,collapsedWidth:250},g.createElement(ci,{panelKeys:t.panelKeys,openKeys:n,defaultActiveKey:r,onPanelClicked:this.onPanelClicked})),g.createElement(ki,{className:"style__content--Akt8J"},g.createElement("div",null,g.createElement(Si,{handleSelectionToolUsed:this.onSelectionToolUsed}))))}}])}(g.Component);(0,f.A)(Oi,"panelKeys",["groupings","selections"]);const xi=Oi;var _i=n(40961);const Ii=function(e){var t=e.aligned,n=e.setAligned,r=e.parent;return(0,_i.createPortal)(g.createElement(g.Fragment,null,g.createElement("span",{className:"viewer-toolbar-group"},g.createElement("span",null,"Alignment"),g.createElement(Io.A,{title:"For the associated publication, single cell images were aligned before feature extraction. The apical basal axis of the cell (which is the z-axis in the lab frame of reference) was preserved and we aligned the cells by rotation in the xy-plane. Cells and nuclei are rotated such that the longest cell axis falls along the x-axis.",placement:"bottom"},g.createElement(ui.A,null))),g.createElement("span",{className:"viewer-toolbar-group"},g.createElement(ue.Ay.Group,{value:t,onChange:function(e){var t=e.target;return n(t.value)}},g.createElement(Io.A,{title:"Turn off alignment",placement:"bottom"},g.createElement(ue.Ay.Button,{key:0,value:!1},"Off")),g.createElement(Io.A,{title:"Turn on alignment",placement:"bottom"},g.createElement(ue.Ay.Button,{key:1,value:!0},"On"))))),r)};function Ti(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Fi(e,t){var n,r=t.unit,a=t.discrete;return null==e?"".concat(e):a?t.options?"".concat(null===(n=t.options[e.toString()])||void 0===n?void 0:n.name):e.toString():r&&!["unitless","stage"].includes(r)?"".concat(e," ").concat({degrees:"deg"}[r]||r):"".concat(e)}var Ni=(0,Dn.Mz)([Wr,Tn],function(e,t){var n,r={},a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ti(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ti(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,l=e[o.key];r[o.displayName]=Fi(l,o)}}catch(e){a.e(e)}finally{a.f()}return{metadata:r}}),Bi=(0,Dn.Mz)([Lr,wr,Ar,Nn,Cr,Ni],function(e,t,n,r,a,o){var l,i;if((0,he.isEmpty)(e))return{};var c=e.CellId,s="",u="",d="",f="";return e.volumeviewerPath?(s=e.volumeviewerPath,d=Ee(n,Ce(e?e.CellId:"")),e.fovVolumeviewerPath&&(u=e.fovVolumeviewerPath,f=Ee(n,we(e?e.FOVId:"")))):(s=e.fovVolumeviewerPath,c=e.FOVId,d=Ee(n,we(e?e.FOVId:""))),""===t||t.endsWith("/")||(t+="/"),{cellId:c,baseUrl:t,cellPath:s,fovPath:u,cellDownloadHref:d,fovDownloadHref:f,transform:a?e.transform:void 0,metadata:o.metadata,viewerChannelSettings:r,appProps:null===(l=e.voleUrlParams)||void 0===l?void 0:l.args,viewerSettings:null===(i=e.voleUrlParams)||void 0===i?void 0:i.viewerSettings}}),ji=(0,Dn.Mz)([Lr,Dr],function(e,t){var n="",r="";return(0,he.isEmpty)(e)?{cellId:"",label:n,value:r}:{cellId:e.volumeviewerPath?e.CellId:e.FOVId,label:n=t.displayName,value:r=e[O]||""}});const Mi={hidden:"style__hidden--Yt5Mb",content:"style__content--Qbl_8",blur:"style__blur--hXBmU",header:"style__header--sNdkU",alert:"style__alert--etQWL","header-main":"style__header-main--QL9nX",headerMain:"style__header-main--QL9nX","viewer-menu-bar":"style__viewer-menu-bar--kpkWV",viewerMenuBar:"style__viewer-menu-bar--kpkWV","viewer-title-container":"style__viewer-title-container--j1Clp",viewerTitleContainer:"style__viewer-title-container--j1Clp","viewer-title":"style__viewer-title--eb2aw",viewerTitle:"style__viewer-title--eb2aw",label:"style__label--LPNpV",sider:"style__sider--ECAaP","tabbed-menu":"style__tabbed-menu--j4E0E",tabbedMenu:"style__tabbed-menu--j4E0E","plot-icon":"style__plot-icon--D0Ck4",plotIcon:"style__plot-icon--D0Ck4","cube-icon":"style__cube-icon--twFXq",cubeIcon:"style__cube-icon--twFXq"};function Ri(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ri=function(){return!!e})()}var Ui=W.A.Content,Vi=W.A.Sider,zi="plot",Gi="3d-viewer",Li=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,Ri()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"alignContainer",document.createElement("span")),(0,f.A)(e,"state",{defaultActiveKey:[t.panelKeys[0]],dontShowSmallScreenWarningAgain:!1,openKeys:[t.panelKeys[0]],width:window.innerWidth,currentTab:zi,controlPanelCollapsed:!1}),(0,f.A)(e,"componentDidMount",function(){e.props.setShowSmallScreenWarning(window.innerWidth<=768),window.addEventListener("resize",e.updateDimensions)}),(0,f.A)(e,"componentDidUpdate",function(t,n){var r,a=e.state.currentTab;e.props.showAlignControl&&(e.alignContainer.style.setProperty("display","flex"),e.alignContainer.style.setProperty("text-wrap","nowrap"),e.alignContainer.style.setProperty("margin-right","6px"),null===(r=document.querySelector(".viewer-toolbar-left"))||void 0===r||r.prepend(e.alignContainer)),n.currentTab!==a&&a===Gi&&window.dispatchEvent(new Event("resize"))}),(0,f.A)(e,"updateDimensions",function(){if(window.innerWidth!==e.state.width){var t=window.innerWidth<=768&&!e.state.dontShowSmallScreenWarningAgain;e.setState({width:window.innerWidth}),e.props.setShowSmallScreenWarning(t)}}),(0,f.A)(e,"onSelectionToolUsed",function(){e.setState({openKeys:(0,he.uniq)([].concat((0,xt.A)(e.state.openKeys),[t.panelKeys[1]]))})}),(0,f.A)(e,"onPanelClicked",function(t){e.setState({openKeys:t})}),(0,f.A)(e,"onControlPanelToggle",function(t){e.setState({controlPanelCollapsed:t})}),(0,f.A)(e,"handleClose",function(){e.props.setShowSmallScreenWarning(!1),e.props.requestFeatureData()}),(0,f.A)(e,"onDismissCheckboxChecked",function(t){e.setState({dontShowSmallScreenWarningAgain:t})}),(0,f.A)(e,"handleTabClick",function(t){e.setState({currentTab:t.key})}),e}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.galleryCollapsed,r=t.toggleGallery,a=t.showSmallScreenWarning,o=t.viewerHeader,l=this.state,i=l.currentTab,c=l.controlPanelCollapsed,s=Z()([Mi.content,(0,f.A)({},Mi.hidden,i!==Gi)]),u=Z()([Mi.content,(0,f.A)({},Mi.hidden,i===Gi)]),d=[{label:g.createElement(g.Fragment,null,g.createElement("span",{className:Z()(["icon-moon","anticon",Mi.plotIcon])}),"Plot"),key:zi},{label:g.createElement(g.Fragment,null,g.createElement("span",{className:Z()(["icon-moon","anticon",Mi.cubeIcon])}),"3D Viewer"),key:Gi}],p=g.createElement(W.A,null,g.createElement(W.A,{className:n?Mi.noBlur:Mi.blur},g.createElement(bo.Y9,{style:{margin:"0",padding:"0",width:"100%"}},g.createElement("div",{className:c?Z()([Mi.viewerMenuBar,Mi.viewerMenuBarCollapsed]):Mi.viewerMenuBar},g.createElement(X.Ay,{theme:{token:{colorPrimary:"#fff",colorSplit:"transparent"}}},g.createElement(vo.A,{className:Mi.tabbedMenu,onClick:this.handleTabClick,selectedKeys:[this.state.currentTab],mode:"horizontal",items:d})),g.createElement("div",{className:Mi.viewerTitleContainer},g.createElement("p",{className:Mi.viewerTitle,style:this.state.currentTab!==Gi?{display:"none"}:{}},g.createElement("span",{className:Mi.label},"Viewing cell: "),this.props.viewerHeader.cellId,g.createElement("span",{className:Mi.label},", ",o.label,": "),this.props.viewerHeader.value)))),g.createElement(W.A,null,g.createElement(Eo,{handleClose:this.handleClose,onDismissCheckboxChecked:this.onDismissCheckboxChecked,visible:a}),g.createElement(Ui,{className:u},g.createElement(xi,null)),g.createElement(Ui,{className:s},g.createElement(wo,(0,to.A)({onControlPanelToggle:this.onControlPanelToggle},this.props.volumeViewerProps)),this.props.showAlignControl&&g.createElement(Ii,{parent:this.alignContainer,aligned:this.props.alignActive,setAligned:this.props.setAlignActive})))),g.createElement(Vi,{style:{right:"0",width:"100px",position:"absolute",backgroundColor:G.galleryBackground},width:"100%",collapsible:!0,collapsed:n,onCollapse:r,defaultCollapsed:!0,collapsedWidth:100,className:Mi.sider,reverseArrow:!0},g.createElement(nl,{collapsed:n,toggleGallery:r,openViewerTab:function(){return e.setState({currentTab:Gi})}})));return g.createElement(X.Ay,{theme:{components:{Layout:{headerHeight:56},Checkbox:{colorPrimary:G.mediumDarkGray,colorPrimaryHover:G.mediumGray}}}},p)}}])}(g.Component);(0,f.A)(Li,"panelKeys",["groupings","selections"]);var Hi={toggleGallery:Zr.actions.toggleGallery,setShowSmallScreenWarning:Ja.actions.setShowSmallScreenWarning,requestFeatureData:Ja.actions.requestFeatureData,setAlignActive:Zr.actions.setAlignActive};const Ki=(0,b.Ng)(function(e){return{galleryCollapsed:Zr.selectors.getGalleryCollapsed(e),volumeViewerProps:Bi(e),thumbnailRoot:Zr.selectors.getThumbnailRoot(e),showSmallScreenWarning:Ja.selectors.getShowSmallScreenWarning(e),viewerHeader:ji(e),showAlignControl:Zr.selectors.getSelected3DCellHasTransform(e),alignActive:Zr.selectors.getAlignActive(e)}},Hi)(Li),Wi=function(e){var t=e.isLoading,n=e.loadingText;return t?g.createElement("div",{className:"style__container--JMiFX"},g.createElement("p",{className:"loading-icon"},ee),g.createElement("p",{className:"loading-text"},n||"Loading data...")):null},qi="style__is-loading--LzhrV";function Xi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Xi=function(){return!!e})()}var Yi=W.A.Header,Zi={algorithm:q.A.darkAlgorithm,token:{colorPrimary:G.purple,colorBgBase:G.darkGray,colorTextHeading:G.white,fontWeightStrong:600,borderRadius:4,borderRadiusSM:4,borderRadiusLG:4,colorLink:G.brightBlue,colorLinkHover:G.linkHover,colorIcon:G.white,colorBgElevated:G.darkGray},components:{Button:{colorPrimary:G.purple,primaryShadow:"0 0px 0 transparent",defaultShadow:"0 0px 0 transparent"},Checkbox:{borderRadiusSM:2},Collapse:{contentBg:G.collapseContentGray,headerBg:G.collapseHeaderGray},Layout:{headerBg:G.headerGray,headerColor:G.white,siderBg:G.collapseContentGray},Modal:{contentBg:G.extraLightGray,headerBg:G.extraLightGray,colorIcon:G.mediumGray},Menu:{colorBgElevated:G.darkGray},Select:{colorTextQuaternary:G.white},Slider:{trackBg:G.lightGray,trackHoverBg:G.extraLightGray,handleColor:G.white,dotActiveBorderColor:G.white,handleActiveColor:G.white,colorPrimaryBorderHover:G.white},Tooltip:{colorBgSpotlight:"rgba(0, 0, 0, 0.85)"}}},Qi=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,Xi()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"componentDidMount",function(){if("csv"===e.props.selectedDataset)if(e.props.csvUrl)try{Wt(e.props.csvUrl).then(function(t){var n=t.text;return e.props.loadCsvDataset(n)})}catch(t){console.error("Error loading CSV dataset from URL:",t),e.props.changeDataset("")}else e.props.changeDataset("");e.props.requestAvailableDatasets()}),(0,f.A)(e,"handleSelectDataset",function(t){e.props.changeDataset(t)}),e}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.props,t=e.isLoading,n=e.loadingText,r=e.selectedDataset,a=e.megasets,o=t&&!!r,l=Z()(["style__container--_3WDP",(0,f.A)({},qi,o)]);return g.createElement(X.Ay,{theme:Zi},g.createElement("div",{className:Z()(["style__wrapper--wsMnE",(0,f.A)({},qi,o)])},g.createElement(W.A,{className:l},g.createElement(Wi,{isLoading:o,loadingText:n}),g.createElement(Yi,{className:"style__nav-bar--q7jPo"},g.createElement(za,{selectedDataset:r})),g.createElement(W.A,null,r?g.createElement(Ki,null):g.createElement(go,{megasets:a,handleSelectDataset:this.handleSelectDataset})))))}}])}(g.Component),Ji={changeDataset:Zr.actions.changeDataset,requestAvailableDatasets:Ja.actions.requestAvailableDatasets,loadCsvDataset:Ba.actions.loadCsvDataset};const $i=(0,b.Ng)(function(e){return{isLoading:Ja.selectors.getIsLoading(e),loadingText:Ja.selectors.getLoadingText(e),selectedDataset:Zr.selectors.getSelectedDataset(e),megasets:Ja.selectors.getMegasetsByNewest(e),csvUrl:Zr.selectors.getCsvUrl(e)}},Ji)(Qi);var ec=n(14644),tc=n(21852);function nc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ac=function(e){var t=e.slice(0,5);return e.length>5&&t.push("...and ".concat(e.length-5," more")),t},oc=function(e){return{indices:ac(e.indices),values:(0,he.mapValues)(e.values,ac),labels:(0,he.mapValues)(e.labels,ac)}},lc=function(e){return e.type===Xt?rc(rc({},e),{},{payload:oc(e.payload)}):e.type===be?rc(rc({},e),{},{payload:e.payload.map(lc)}):e},ic=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;ic?ic({actionSanitizer:lc,stateSanitizer:function(e){return rc(rc({},e),{},{metadata:rc(rc({},e.metadata),{},{featureData:oc(e.metadata.featureData)})})}}):ec.Zz;var cc={metadata:Ja.reducer,selection:Zr.reducer,imageDataset:Ba.reducer},sc=[].concat((0,xt.A)(Ja.logics),(0,xt.A)(Zr.logics),(0,xt.A)(Ba.logics)),uc={httpClient:Pa.A},dc=Object.freeze({metadata:Qa,selection:Tt,imageDataset:Na});function fc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fc(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var mc=function(){return(0,m.A)(function e(t){(0,p.A)(this,e),this.history=t},[{key:"getParams",value:function(){return function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],o=e[a];("string"==typeof o||Array.isArray(o)&&"string"==typeof o[0])&&(t[a]=o)}return t}((0,y.parse)(this.history.location.search,{ignoreQueryPrefix:!0}))}},{key:"pushParams",value:function(e){this.history.push(pc(pc({},this.history.location),{},{search:(0,y.stringify)(e)}))}},{key:"pushParam",value:function(e,t){this.pushParams(pc(pc({},this.getParams()),{},(0,f.A)({},e,t)))}},{key:"replaceParams",value:function(e){this.history.replace(pc(pc({},this.history.location),{},{search:(0,y.stringify)(e)}))}},{key:"onParamRemoved",value:function(e,t){var n=!1;this.history.listen(function(r){(0,y.parse)(r.search,{ignoreQueryPrefix:!0})[e]?n=!0:n&&(t(),n=!1)})}}])}(),hc=new mc((0,h.zR)()),yc=function(e){var t=(0,tc.A)(sc);t.addDeps(uc);var n=(0,ec.Tw)(t),r=function(e,t){return function n(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=arguments.length>1?arguments[1]:void 0;return function(e){return e&&e.batch&&Array.isArray(e.payload)}(a)?a.payload.reduce(n,r):e(r,a)}}((0,ec.HY)(cc),dc);if(e){var a=(0,he.merge)({},dc,e);return(0,ec.y$)(r,a,n)}return(0,ec.y$)(r,n)}({selection:pc(pc({},Tt),Mt.toAppState(hc.getParams()))});yc.dispatch(Zr.actions.syncStateWithURL(hc.getParams())),hc.onParamRemoved("dataset",function(){yc.dispatch(Zr.actions.clearDataset()),yc.dispatch(Ja.actions.clearDatasetValues())}),yc.subscribe(function(){var e=yc.getState(),t=Mt.toUrlSearchParameterMap(e.selection),n=hc.getParams();Mt.paramChanged(jt.dataset,t,n)&&hc.pushParam(jt.dataset,t.dataset),Mt.paramsChanged(t,n)&&hc.replaceParams(t)});var gc=document.getElementById(C);null===gc?console.error("App container (#".concat(C,") missing!")):(0,v.H)(gc).render(g.createElement(b.Kq,{store:yc},g.createElement($i,null)))},42634:()=>{},56266:()=>{},56504:()=>{}},e=>{e.O(0,[962,617,681],()=>e(e.s=30626)),e.O()}]);