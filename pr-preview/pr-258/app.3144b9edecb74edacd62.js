(self.webpackChunkcell_feature_explorer=self.webpackChunkcell_feature_explorer||[]).push([[283,524],{6580:()=>{},28625:()=>{},30626:(e,t,n)=>{"use strict";var r={};n.r(r),n.d(r,{changeAxis:()=>ot,changeDataset:()=>Ct,changeDownloadSettings:()=>yt,changeGroupByCategory:()=>lt,changeHoveredPoint:()=>vt,changeMousePosition:()=>gt,clearAllSelectedPoints:()=>dt,clearDataset:()=>Et,deselectGroupOfPoints:()=>ct,deselectPoint:()=>st,lassoOrBoxSelectGroup:()=>it,receiveFileInfoDataForCell:()=>Dt,requestCellFileInfoByArrayOfCellIds:()=>Pt,requestCellFileInfoByCellId:()=>kt,selectAlbum:()=>At,selectCellFor3DViewer:()=>pt,selectPoint:()=>ut,setAlignActive:()=>Ot,setCsvUrl:()=>St,setHoveredGalleryCard:()=>bt,syncStateWithURL:()=>mt,toggleApplySelectionSetColors:()=>ht,toggleFilterByCategoryName:()=>ft,toggleGallery:()=>wt});var a={};n.r(a),n.d(a,{clearDatasetValues:()=>mn,receiveAlbumData:()=>wn,receiveAvailableDatasets:()=>pn,receiveDataForPlot:()=>yn,receiveFileInfoData:()=>hn,receiveMeasuredFeatureDefs:()=>gn,receiveViewerChannelSettings:()=>En,requestAlbumData:()=>An,requestAvailableDatasets:()=>fn,requestCellFileInfoData:()=>vn,requestFeatureData:()=>bn,requestViewerChannelSettings:()=>Cn,setLoadingText:()=>Dn,setShowSmallScreenWarning:()=>kn,stopLoading:()=>Sn});var o={};n.r(o),n.d(o,{getAllAlbumData:()=>xn,getCategoricalFeatureKeys:()=>Gn,getDatasets:()=>Mn,getFileInfo:()=>Bn,getIsLoading:()=>_n,getLabelsPerCell:()=>Vn,getLoadingText:()=>In,getMeasuredFeatureArrays:()=>Un,getMeasuredFeaturesDefs:()=>Nn,getMeasuredFeaturesKeys:()=>zn,getMegasets:()=>Fn,getMegasetsByNewest:()=>Rn,getMitoticKeyPerCell:()=>Hn,getMitoticStageNames:()=>Ln,getPerCellDataForPlot:()=>On,getShowSmallScreenWarning:()=>Tn,getViewerChannelSettings:()=>jn});var l={};n.r(l),n.d(l,{getImageDataset:()=>Kn});var i={};n.r(i),n.d(i,{getAlignActive:()=>Sr,getApplyColorToSelections:()=>dr,getCategoryGroupColorsAndNames:()=>_r,getClickedCellsFileInfo:()=>ar,getClickedScatterPoints:()=>Hr,getColorByCategoryCounts:()=>jr,getColorBySelection:()=>lr,getCsvUrl:()=>kr,getDefaultColors:()=>ir,getDownloadConfig:()=>fr,getDownloadRoot:()=>Cr,getFeatureDefTooltip:()=>Ir,getFilteredCellData:()=>Mr,getFilteredColorByValues:()=>Lr,getFilteredIds:()=>Gr,getFilteredMeasuredValues:()=>Rr,getFilteredPerCellLabels:()=>Ur,getFilteredXValues:()=>Vr,getFilteredYValues:()=>zr,getFiltersToExclude:()=>sr,getGalleryCollapsed:()=>gr,getGroupByCategory:()=>rr,getGroupByFeatureDef:()=>Pr,getGroupByFeatureOptionsAsList:()=>Or,getGroupingCategoryNames:()=>xr,getGroupingCategoryNamesAsArray:()=>Tr,getHoveredCardId:()=>hr,getHoveredPointData:()=>mr,getMeasuredValues:()=>Fr,getMousePosition:()=>pr,getPlotByOnX:()=>tr,getPlotByOnY:()=>nr,getSelected3DCell:()=>ur,getSelected3DCellFOV:()=>Wr,getSelected3DCellFeatureData:()=>Xr,getSelected3DCellFileInfo:()=>Kr,getSelected3DCellHasTransform:()=>qr,getSelectedAlbum:()=>yr,getSelectedAlbumFileInfo:()=>wr,getSelectedDataset:()=>vr,getSelectedDatasetName:()=>Dr,getSelectedGroupKeys:()=>Zr,getSelectedGroups:()=>or,getSelectedGroupsData:()=>Yr,getSelectedIdsFromUrl:()=>Ar,getSelectedSetTotals:()=>Qr,getSelectionSetColors:()=>cr,getThumbnailRoot:()=>br,getVolumeViewerDataRoot:()=>Er,getXValues:()=>Nr,getYValues:()=>Br});var c={};n.r(c);var s={};n.r(s),n.d(s,{changeImageDatasetType:()=>na,loadCsvDataset:()=>ra});var u={};n.r(u);var d={};n.r(d);var f=n(64467),p=n(23029),m=n(92901),h=(n(22913),n(51298),n(10743),n(30502)),y=n(55373),g=n(96540),v=n(5338),b=n(71468);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var C="cell-feature-explorer",E="plotByOnX",S="plotByOnY",D="cellIds",k="features-scatter-plot",P="colorBy",O="groupBy",x="CellId",_="FOVId",I="fovThumbnailPath",T="fovVolumeviewerPath",F="thumbnailPath",N="volumeviewerPath",B=(Object.freeze([x,_,O,F,N,I,T]),"protein"),j="selectionSet",M="interphase-and-mitotic-stages",R="#6e6e6e",U={backgroundColor:"rgba(0,0,0,0)",cellName:x,chartParent:"ace-scatter-chart",circleRadius:4,histogramColor:"rgb(164,162,164)",legend:{font:{color:"rgb(255,255,255)"},orientation:"h",y:60},margin:{b:50,l:60,r:40,t:10},moveDropdownCutoffWidth:370,heightMargin:270,showLegendCutoffHeight:635,showLegendCutoffWidth:692,textColor:"rgb(255,255,255)",unselectedCircleOpacity:.5},V="Direct download is not available for this dataset.",z={purple:"#8950d9",darkGray:"#313131",mediumDarkGray:"#4b4b4b",mediumGray:"#6e6e6e",lightGray:"#a0a0a0",extraLightGray:"#d8d8d8",brightGreen:"#b2d030",brightBlue:"#00a0ff",white:"#ffffff"},G=w(w({},z),{},{headerGray:z.mediumDarkGray,collapseHeaderGray:"#464646",collapseContentGray:z.darkGray,galleryBackground:z.mediumDarkGray+"d1",linkHover:z.brightBlue}),L=n(56822),H=n(53954),K=n(85501),W=n(6406),q=n(5131),X=n(20867),Y=n(46942),Z=n.n(Y),Q=n(47152),J=n(93567);const $=n.p+"5ddc2961aa2dc5a828bc.png";var ee=g.createElement(J.A,{style:{fontSize:40},spin:!0}),te=g.createElement("img",{src:$,style:{width:"140px"},alt:"Allen Institute for Cell Science"});var ne=n(10467),re=n(5544),ae=n(54756),oe=n.n(ae),le=n(77028),ie=n(92941),ce=n(704),se=n(86336),ue=n(50770),de=n(34716),fe=n(28392),pe=n(17286),me=n(67956),he=n(2543),ye=/^https?:\/\//;function ge(e,t){return"".concat(C,"/").concat(e.toUpperCase(),"/").concat(t.toUpperCase())}function ve(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=arguments.length>1?arguments[1]:void 0,a=e[r.type];return a&&a.accepts(r)?a.perform(n,r):n}}var be=ge("batch","batch-actions");function Ae(e){return{type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:be,batch:!0,payload:e}}function we(e){return isNaN(Number(e))?e:"F".concat(e)}function Ce(e){return isNaN(Number(e))?e:"C".concat(e)}function Ee(e,t){return""===e?"":"".concat(e,"&id=").concat(t)}function Se(e,t){return ye.test(t)?t:e&&t?"".concat(e,"/").concat(t):""}function De(e,t){return(0,he.find)(e,{key:t})}function ke(e,t){if(!t)return"";if(!e.options)return""+t;var n=e.options[t];return n.key||n.name}var Pe=function(e){return ge("selection",e)},Oe=Pe("deselect-file"),xe=Pe("change-group-by-category"),_e=Pe("select_group"),Ie=Pe("deselect-point"),Te=Pe("select-point"),Fe=Pe("deselect-all-points"),Ne=Pe("toggle-filter-by-category-name"),Be=Pe("open-cell-in-3d"),je=Pe("apply-selection-set-color"),Me=Pe("deselect-group"),Re=Pe("set-download-config"),Ue=Pe("set-mouse-position"),Ve=Pe("sync-with-url"),ze=Pe("change-hovered-point"),Ge=Pe("change-hovered-gallery-card"),Le=Pe("change-selected-album"),He=Pe("toggle-gallery"),Ke=Pe("set-align-active"),We=Pe("REQUEST_CELL_FILE_INFO_BY_CELL_ID"),qe=Pe("RECEIVE_CELL_FILE_INFO"),Xe=Pe("RECEIVE_SELECTED_FILE_INFO"),Ye=Pe("RECEIVE_FILE_INFO_FOR_ALBUM_CELLS"),Ze=Pe("SELECT_ARRAY_OF_POINTS"),Qe=Pe("RECEIVE_FILE_INFO_FOR_SELECTED_ARRAY_OF_CELLS"),Je=Pe("set-dataset"),$e=Pe("change-dataset"),et=Pe("clear-dataset"),tt=Pe("set-csv-url"),nt="#d3d3d3",rt="(N/A)",at=["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"];function ot(e,t){return{axisId:e,payload:t,type:Oe}}function lt(e){return{payload:e,type:xe}}function it(e,t){return{key:e,payload:t,type:_e}}function ct(e){return{payload:e,type:Me}}function st(e){return{payload:e,type:Ie}}function ut(e){return{payload:e,type:Te}}function dt(){return{type:Fe}}function ft(e){return{payload:e,type:Ne}}function pt(e){return{payload:e,type:Be}}function mt(e){return{payload:e,type:Ve}}function ht(e){return{payload:e,type:je}}function yt(e){return{payload:e,type:Re}}function gt(e){return{payload:e,type:Ue}}function vt(e){return{payload:e,type:ze}}function bt(e){return{payload:e,type:Ge}}function At(e){return{payload:e,type:Le}}function wt(e){return{payload:e,type:He}}function Ct(e){return{payload:e,type:$e}}function Et(){return{type:et}}function St(e){return{payload:e,type:tt}}function Dt(e){return{payload:e,type:qe}}function kt(e){return{payload:e,type:We}}function Pt(e){return{payload:e,type:Ze}}function Ot(e){return{payload:e,type:Ke}}var xt,_t=n(14534),It=n(60436);function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Nt={applySelectionSetColoring:!0,cellSelectedFor3D:"",colorBy:"",dataset:"",csvUrl:"",downloadConfig:{key:"",type:""},filterExclude:[],galleryCollapsed:!0,hoveredCardId:"",hoveredPointData:null,mousePosition:{pageX:0,pageY:0},plotByOnX:"",plotByOnY:"",groupBy:"",defaultColors:["#bbcd22","#ff9900","#FFEE1E","#FD92B6","#33a02c","#F07C4C","#c26cff","#f0486e","#0099ff","#ffc35c","#33ffff","#ff6633","#a6cee3","#cab2d6","#b15928","#e8af39","#537eff","#61d900","#ff8ae8","#FF4d4d","#c26cff","#aeaeae","#ff44ff","#6a3d9a","#ffff99","#ff00de","#24bcfa","#84df11","#ecc560","#ff72ff","#f58117","#f8311b","#5791db","#11a89a","#a70009","#ff6200","#fddb02","#f7db78","#f9a558"],selectedAlbum:0,selectedAlbumFileInfo:[],selectedGroupColors:{},selectedGroups:{},selectedPoints:[],initSelectedPoints:[],thumbnailRoot:"",downloadRoot:"",volumeViewerDataRoot:"",alignActive:!1};const Bt=ve((xt={},(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)(xt,Je,{accepts:function(e){return e.type===Je},perform:function(e,t){return Ft(Ft({},e),{},{dataset:t.payload.dataset,thumbnailRoot:t.payload.thumbnailRoot,downloadRoot:t.payload.downloadRoot,volumeViewerDataRoot:t.payload.volumeViewerDataRoot})}}),et,{accepts:function(e){return e.type===et},perform:function(){return Ft({},Nt)}}),tt,{accepts:function(e){return e.type===tt},perform:function(e,t){return Ft(Ft({},e),{},{csvUrl:t.payload})}}),Oe,{accepts:function(e){return e.type===Oe},perform:function(e,t){return Ft(Ft({},e),{},(0,f.A)({},t.axisId,t.payload))}}),xe,{accepts:function(e){return e.type===xe},perform:function(e,t){return Ft(Ft({},e),{},{groupBy:t.payload})}}),Be,{accepts:function(e){return e.type===Be},perform:function(e,t){return Ft(Ft({},e),{},{cellSelectedFor3D:t.payload.id})}}),_e,{accepts:function(e){return e.type===_e},perform:function(e,t){return Ft(Ft({},e),{},{selectedGroupColors:Ft(Ft({},e.selectedGroupColors),{},(0,f.A)({},t.key,at.splice(0,1)[0])),selectedGroups:Ft(Ft({},e.selectedGroups),{},(0,f.A)({},t.key,t.payload))})}}),Me,{accepts:function(e){return e.type===Me},perform:function(e,t){return Ft(Ft({},e),{},{selectedGroupColors:(0,he.pickBy)(e.selectedGroupColors,function(e,n){return n.toString()!==t.payload.toString()}),selectedGroups:(0,he.pickBy)(e.selectedGroups,function(e,n){return n.toString()!==t.payload.toString()})})}}),Ie,{accepts:function(e){return e.type===Ie},perform:function(e,t){return Ft(Ft({},e),{},{selectedPoints:(0,he.filter)(e.selectedPoints,function(e){return e.CellId!==t.payload})})}}),Fe,{accepts:function(e){return e.type===Fe},perform:function(e){return Ft(Ft({},e),{},{selectedPoints:(0,It.A)(Nt.selectedPoints)})}}),(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)(xt,Ne,{accepts:function(e){return e.type===Ne},perform:function(e,t){return Ft(Ft({},e),{},{filterExclude:t.payload})}}),je,{accepts:function(e){return e.type===je},perform:function(e,t){return Ft(Ft({},e),{},{applySelectionSetColoring:t.payload})}}),Re,{accepts:function(e){return e.type===Re},perform:function(e,t){return Ft(Ft({},e),{},{downloadConfig:t.payload})}}),Ue,{accepts:function(e){return e.type===Ue},perform:function(e,t){return Ft(Ft({},e),{},{mousePosition:t.payload})}}),ze,{accepts:function(e){return e.type===ze},perform:function(e,t){return Ft(Ft({},e),{},{hoveredPointData:t.payload})}}),Ge,{accepts:function(e){return e.type===Ge},perform:function(e,t){return Ft(Ft({},e),{},{hoveredCardId:t.payload})}}),Le,{accepts:function(e){return e.type===Le},perform:function(e,t){return Ft(Ft({},e),{},{selectedAlbum:t.payload})}}),He,{accepts:function(e){return e.type===He},perform:function(e,t){return Ft(Ft({},e),{},{galleryCollapsed:t.payload})}}),Xe,{accepts:function(e){return e.type===Xe},perform:function(e,t){return Ft(Ft({},e),{},{selectedPoints:(0,he.uniqBy)([].concat((0,It.A)(e.selectedPoints),[t.payload]),x)})}}),Qe,{accepts:function(e){return e.type===Qe},perform:function(e,t){return Ft(Ft({},e),{},{selectedPoints:(0,he.uniqBy)([].concat((0,It.A)(e.selectedPoints),(0,It.A)(t.payload)),x)})}}),(0,f.A)((0,f.A)(xt,Ye,{accepts:function(e){return e.type===Ye},perform:function(e,t){return Ft(Ft({},e),{},{selectedAlbumFileInfo:t.payload})}}),Ke,{accepts:function(e){return e.type===Ke},perform:function(e,t){return Ft(Ft({},e),{},{alignActive:t.payload})}})),Nt);function jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Rt=function(e){return e.cellSelectedFor3D="cellSelectedFor3D",e.colorBy="colorBy",e.dataset="dataset",e.plotByOnX="plotByOnX",e.plotByOnY="plotByOnY",e.selectedPoint="selectedPoint",e.selectedAlbum="selectedAlbum",e.galleryCollapsed="galleryCollapsed",e.csvUrl="csvUrl",e}({}),Ut=function(){function e(){(0,p.A)(this,e)}return(0,m.A)(e,null,[{key:"toAppState",value:function(t){return(0,he.reduce)(t,function(n,r,a){if(e.urlParamToStateMap.hasOwnProperty(a)){var o=e.urlParamToStateMap[a](r,t);return(0,he.mergeWith)({},n,o,function(e,t){if(Array.isArray(e))return e.concat(t)})}return n},{})}},{key:"paramChanged",value:function(e,t,n){return!(0,he.isEqual)(n[e],t[e])}},{key:"paramsChanged",value:function(e,t){return!(0,he.isEqual)(t,e)}},{key:"toReduxActions",value:function(t){return(0,he.reduce)(t,function(n,r,a){if(e.urlParamToActionCreatorMap.hasOwnProperty(a)){var o=e.urlParamToActionCreatorMap[a](r,t);if(o)return[].concat((0,It.A)(n),(0,It.A)((0,he.castArray)(o)))}return n},[])}},{key:"toUrlSearchParameterMap",value:function(t){var n=this;return(0,he.reduce)(t,function(t,r,a){return e.stateToUrlParamMap.hasOwnProperty(a)&&e.valueIsMeaningfulToSerialize(r)&&e.valueIsNotDefault(r,a)?Mt(Mt({},t),n.stateToUrlParamMap[a](r)):t},{})}},{key:"valueIsMeaningfulToSerialize",value:function(e){return!(!(0,he.isBoolean)(e)&&(Array.isArray(e)||(0,he.isString)(e)?(0,he.isEmpty)(e):(0,he.isNaN)(e)||(0,he.isNil)(e)))}},{key:"valueIsNotDefault",value:function(e,t){return Nt[t]!==e}}])}();(0,f.A)(Ut,"urlParamToActionCreatorMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},Rt.cellSelectedFor3D,function(e,t){var n=pt({id:String(e)});return(0,he.includes)((0,he.castArray)(t[Rt.selectedPoint]),e)?n:[ut({id:String(e)}),n]}),Rt.colorBy,function(e){return ot(P,String(e))}),Rt.dataset,function(e){return Ct(String(e))}),Rt.csvUrl,function(e){return St(decodeURIComponent(String(e)))}),Rt.galleryCollapsed,function(e){return wt("true"===e)}),Rt.plotByOnX,function(e){return ot(E,String(e))}),Rt.plotByOnY,function(e){return ot(S,String(e))}),Rt.selectedAlbum,function(e){return At(Number(e))}),Rt.selectedPoint,function(e){return Array.isArray(e)?(0,he.map)(e,function(e){return ut({id:String(e)})}):ut({id:String(e)})})),(0,f.A)(Ut,"urlParamToStateMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},Rt.cellSelectedFor3D,function(e,t){var n={cellSelectedFor3D:String(e)};return(0,he.includes)((0,he.castArray)(t[Rt.selectedPoint]),e)||Object.assign(n,{initSelectedPoints:[String(e)]}),n}),Rt.colorBy,function(e){return(0,f.A)({},P,String(e))}),Rt.dataset,function(e){return{dataset:String(e)}}),Rt.galleryCollapsed,function(e){return{galleryCollapsed:"true"===e}}),Rt.plotByOnX,function(e){return(0,f.A)({},E,String(e))}),Rt.plotByOnY,function(e){return(0,f.A)({},S,String(e))}),Rt.selectedAlbum,function(e){return{selectedAlbum:Number(e)}}),Rt.selectedPoint,function(e){return{initSelectedPoints:(0,he.map)((0,he.castArray)(e),String)}})),(0,f.A)(Ut,"stateToUrlParamMap",(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({cellSelectedFor3D:function(e){return(0,f.A)({},Rt.cellSelectedFor3D,String(e))}},P,function(e){return(0,f.A)({},Rt.colorBy,String(e))}),"dataset",function(e){return(0,f.A)({},Rt.dataset,String(e))}),"csvUrl",function(e){return(0,f.A)({},Rt.csvUrl,String(encodeURIComponent(e)))}),"galleryCollapsed",function(e){return(0,f.A)({},Rt.galleryCollapsed,String(e))}),"selectedAlbum",function(e){return(0,f.A)({},Rt.selectedAlbum,String(e))}),"selectedPoints",function(e){var t=(0,he.map)(e,function(e){return String(e[x])});return(0,f.A)({},Rt.selectedPoint,t)}),E,function(e){return(0,f.A)({},Rt.plotByOnX,String(e))}),S,function(e){return(0,f.A)({},Rt.plotByOnY,String(e))}));var Vt={"/allen/aics/":"https://dev-aics-dtp-001.int.allencell.org/"},zt=/^(https?:\/\/)/;function Gt(e){return!e||e.includes("localhost")||e.includes("staging")||e.includes("stg")}function Lt(e,t,n){return e.split(t).join(n)}function Ht(e){return e=Lt(e,"\\","/"),(e=Lt(e,"//","/")).startsWith("//")&&(e=e.slice(1)),e}function Kt(e){return Ht(e).startsWith("/allen/")}function Wt(e){return zt.test(e)}function qt(e){e=Ht(e);for(var t=0,n=Object.keys(Vt);t<n.length;t++){var r=n[t];if(e.startsWith(r))return e.replace(r,Vt[r])}return null}function Xt(e){return Yt.apply(this,arguments)}function Yt(){return(Yt=(0,ne.A)(oe().mark(function e(t){var n,r,a;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}throw new Error("No URL provided.");case 1:if(!Kt(t)){e.next=3;break}if(!(n=qt(t))){e.next=2;break}t=n,e.next=3;break;case 2:throw new Error("'".concat(t,"' is an Allen path, but could not be converted to an HTTPS URL. ")+"The provided path may not be servable over HTTPS. Please submit an issue ticket if you believe this is incorrect.");case 3:return console.log("Fetching CSV dataset from url: ".concat(t)),e.next=4,fetch(t);case 4:if((r=e.sent).ok){e.next=5;break}throw new Error("Failed to fetch CSV dataset from url '".concat(t,"': ").concat(r.status," ").concat(r.statusText));case 5:return e.next=6,r.text();case 6:return a=e.sent,e.abrupt("return",{url:t,text:a});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Zt=ge("metadata","receive"),Qt=ge("metadata","request"),Jt=ge("metadata","request-album-data"),$t=ge("metadata","receive-album-data"),en=ge("metadata","set-is-loading"),tn=ge("metadata","set-loading-text"),nn=ge("metadata","set-show-small-screen-warning"),rn=ge("metadata","RECEIVE_AVAILABLE_DATASETS"),an=ge("metadata","REQUEST_AVAILABLE_DATASETS"),on=ge("metadata","receive-measured-feature-names"),ln=ge("metadata","request-cell-file-info"),cn=ge("metadata","receive-cell-file-info"),sn=ge("metadata","CLEAR_DATASET_VALUES"),un=ge("metadata","request-viewer-channel-settings"),dn=ge("metadata","receive-viewer-channel-settings");function fn(){return{type:an}}function pn(e){return{payload:e,type:rn}}function mn(){return{type:sn}}function hn(e){return{payload:e,type:cn}}function yn(e){return{payload:e,type:Zt}}function gn(e){return{payload:e,type:on}}function vn(){return{type:ln}}function bn(){return{type:Qt}}function An(){return{type:Jt}}function wn(e){return{payload:e,type:$t}}function Cn(){return{type:un}}function En(e){return{payload:e,type:dn}}function Sn(){return{payload:!1,type:en}}function Dn(e){return{payload:e,type:tn}}function kn(e){return{payload:e,type:nn}}var Pn=n(97132),On=function(e){return e.metadata.featureData},xn=function(e){return e.metadata.albums},_n=function(e){return e.metadata.isLoading},In=function(e){return e.metadata.loadingText},Tn=function(e){return e.metadata.showSmallScreenWarning},Fn=function(e){return e.metadata.megasets},Nn=function(e){return e.metadata.measuredFeaturesDefs},Bn=function(e){return e.metadata.cellFileInfo},jn=function(e){return e.metadata.viewerChannelSettings},Mn=(0,Pn.Mz)([Fn],function(e){var t=[];return e.forEach(function(e){(0,he.forEach)(e.datasets,function(e){t.push(e)})}),t}),Rn=(0,Pn.Mz)([Fn],function(e){return e.sort(function(e,t){return t.dateCreated.seconds-e.dateCreated.seconds})}),Un=(0,Pn.Mz)([On],function(e){return e.values}),Vn=(0,Pn.Mz)([On],function(e){return e.labels}),zn=(0,Pn.Mz)([Nn],function(e){return(0,he.map)(e,"key")}),Gn=(0,Pn.Mz)([Nn],function(e){return(0,he.map)((0,he.filter)(e,"discrete"),"key")}),Ln=(0,Pn.Mz)([Nn],function(e){var t=De(e,M);return t&&t.discrete?t.options:{}}),Hn=(0,Pn.Mz)([Un],function(e){return e[M]||[]}),Kn=function(e){return e.imageDataset.imageDataset};function Wn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wn(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Xn=(0,_t.A)({type:Ve,process:function(e,t,n){var r=e.action.payload,a=Ut.toReduxActions(r),o=(0,he.remove)(a,{type:$e});o&&o.forEach(function(e){return t(e)}),t(Ae(Ut.toReduxActions(r))),n()}}),Yn=(0,_t.A)({type:$e,process:function(e,t,n){return(0,ne.A)(oe().mark(function r(){var a,o,l,i,c,s,u,d,f;return oe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.action,o=e.getState,l=o(),i=Kn(l),a.payload){r.next=1;break}return r.abrupt("return",t({type:Je,payload:a.payload}));case 1:if((s=Mn(o())).length){r.next=6;break}return r.next=2,i.getAvailableDatasets();case 2:u=r.sent,d=0;case 3:if(!(d<u.length)){r.next=5;break}if(!(f=(0,he.find)(u[d].datasets,{id:a.payload}))){r.next=4;break}return c=f,r.abrupt("continue",5);case 4:d++,r.next=3;break;case 5:r.next=7;break;case 6:c=(0,he.find)(s,{id:a.payload});case 7:if(void 0!==c){r.next=8;break}return"csv"!==a.payload&&console.error("A dataset matching ".concat(a.payload," is not available.")),r.abrupt("return",n());case 8:i.selectDataset(c.manifest).then(function(e){var r=[ot(E,e.defaultXAxis),ot(S,e.defaultYAxis),lt(e.defaultGroupBy)];e.defaultColorBy&&r.push(ot(P,e.defaultColorBy)),t(Ae(r)),t({type:Je,payload:{dataset:a.payload,thumbnailRoot:e.thumbnailRoot,downloadRoot:e.downloadRoot,volumeViewerDataRoot:e.volumeViewerDataRoot}}),t(bn()),t(Cn()),n()});case 9:case"end":return r.stop()}},r)}))()}}),Zn=(0,_t.A)({process:function(e){var t=e.action,n=(0,e.getState)();return Kn(n).getFileInfoByCellId(t.payload.id.toString()).then(function(e){return e?qn(qn({},e),{},{index:t.payload.index}):{}}).catch(function(e){console.log(e)})},processOptions:{successType:Xe},type:Te}),Qn=(0,_t.A)({process:function(e){var t=e.action,n=(0,e.getState)(),r=Kn(n),a=On(n),o=function(e,t){var n={};return e.sort(function(e,t){return Number(e)-Number(t)}).forEach(function(e){var r=(0,he.indexOf)(t,e);n[e]=r}),n}(t.payload,a.labels.cellIds);return r.getFileInfoByArrayOfCellIds(t.payload).then(function(e){return(0,he.filter)((0,he.map)(e,function(e){return qn(qn({},e),{},{index:e?o[e.CellId]:-1})}))}).catch(function(e){console.log(e)})},processOptions:{successType:Qe},type:Ze});const Jn=[Xn,Yn,Zn,(0,_t.A)({process:function(e){var t=e.action,n=(0,e.getState)(),r=Kn(n);return r.getFileInfoByArrayOfCellIds?r.getFileInfoByArrayOfCellIds([t.payload.toString()]).then(function(e){return(0,he.filter)(e)}).catch(function(e){console.log(e)}):Promise.resolve({})},processOptions:{successType:Ye},type:Le}),Qn];function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tr=function(e){return e.selection.plotByOnX},nr=function(e){return e.selection.plotByOnY},rr=function(e){return e.selection.groupBy},ar=function(e){return e.selection.selectedPoints},or=function(e){return e.selection.selectedGroups},lr=function(e){return e.selection.colorBy},ir=function(e){return e.selection.defaultColors},cr=function(e){return e.selection.selectedGroupColors},sr=function(e){return e.selection.filterExclude},ur=function(e){return e.selection.cellSelectedFor3D},dr=function(e){return e.selection.applySelectionSetColoring},fr=function(e){return e.selection.downloadConfig},pr=function(e){return e.selection.mousePosition},mr=function(e){return e.selection.hoveredPointData},hr=function(e){return e.selection.hoveredCardId},yr=function(e){return e.selection.selectedAlbum},gr=function(e){return e.selection.galleryCollapsed},vr=function(e){return e.selection.dataset},br=function(e){return e.selection.thumbnailRoot},Ar=function(e){return e.selection.initSelectedPoints},wr=function(e){return e.selection.selectedAlbumFileInfo},Cr=function(e){return e.selection.downloadRoot},Er=function(e){return e.selection.volumeViewerDataRoot},Sr=function(e){return e.selection.alignActive},Dr=(0,Pn.Mz)([vr],function(e){return e.split("_v")[0]}),kr=function(e){return e.selection.csvUrl},Pr=(0,Pn.Mz)([Nn,rr],function(e,t){var n=De((0,he.map)(e),t);return n&&n.discrete?n:{}}),Or=(0,Pn.Mz)([Pr],function(e){return(0,he.isEmpty)(e)?[]:(0,he.sortBy)(e.options,"name")}),xr=(0,Pn.Mz)([Or],function(e){return(0,he.map)(e,"name")}),_r=(0,Pn.Mz)([lr,rr,Nn,Gn],function(e,t,n,r){if((0,he.includes)(r,e)){var a=De(n,e);if(a&&a.discrete){var o=a.options,l=(0,he.map)(o,function(n,r){var a;return a=t===e?n.key||n.name:r,{color:n.color,name:a,label:n.name}}),i={color:nt,label:rt,name:t===e?"":"null"};return[].concat((0,It.A)(l),[i])}}return[]});function Ir(e,t){var n=(0,he.find)(t,{key:e});return n&&n.tooltip?n.tooltip:""}var Tr=(0,Pn.Mz)([On,Pr],function(e,t){var n=t.key;return n?(0,he.map)(e.values[n],function(e){var n=null!==e?e.toString():"";return ke(t,n)}):(console.log("Missing groupBy category key"),[])}),Fr=(0,Pn.Mz)([On],function(e){return e.values||{}}),Nr=(0,Pn.Mz)([Fr,tr],function(e,t){return e[t]?e[t]:[]}),Br=(0,Pn.Mz)([Fr,nr],function(e,t){return e[t]?e[t]:[]}),jr=(0,Pn.Mz)([On,lr,Nn],function(e,t,n){var r=De(n,t);if(r&&r.discrete){var a=r.options,o=(0,he.map)(a,"count");if(0===(0,he.filter)(o,function(e){return void 0!==e}).length){var l=(0,he.reduce)(e.values[t],function(e,t){var n=null!==t?t.toString():"";return e[n]?e[n]++:e[n]=1,e},{});o=(0,he.values)(l)}var i=(0,he.reduce)(o,function(e,t){return e+(null!=t?t:0)},0),c=e.indices.length-i;return[].concat((0,It.A)(o),[c])}return[]}),Mr=(0,Pn.Mz)([zn,sr,On,rr,Tr],function(e,t,n,r,a){if(!t.length)return er(er({},n),{},{labels:er(er({},n.labels),{},(0,f.A)({},r,a))});for(var o=[],l={},i=[],c=[],s=[],u=[],d=function(r){var d=a[r];if(!(0,he.includes)(t,d)){var f,p,m=n.labels.cellIds[r];i.push(m),o.push(d),c.push(n.labels.thumbnailPaths[r]),s.push(null!==(f=null===(p=n.labels.sourcePaths)||void 0===p?void 0:p[r])&&void 0!==f?f:""),u.push(n.indices[r]),e.forEach(function(e){l[e]||(l[e]=[]),l[e].push(n.values[e][r])})}},p=0;p<n.labels.cellIds.length;p++)d(p);return{indices:u,values:l,labels:(0,f.A)((0,f.A)((0,f.A)((0,f.A)({},r,o),D,i),"thumbnailPaths",c),"sourcePaths",s)}}),Rr=(0,Pn.Mz)([Mr],function(e){return e.values||{}}),Ur=(0,Pn.Mz)([Mr],function(e){return e.labels||{}}),Vr=(0,Pn.Mz)([Rr,tr],function(e,t){return e[t]?e[t]:[]}),zr=(0,Pn.Mz)([Rr,nr],function(e,t){return e[t]||[]}),Gr=(0,Pn.Mz)([Ur],function(e){return e[D]||[]}),Lr=(0,Pn.Mz)([Mr,lr,rr],function(e,t,n){return e.labels&&er(er({},e.values),{},(0,f.A)({},n,e.labels[n]))[t]||[]}),Hr=(0,Pn.Mz)([ar],function(e){return(0,he.map)(e,x)}),Kr=(0,Pn.Mz)([ur,ar,Tr,On],function(e,t,n,r){var a=function(e,t){return(0,he.find)(e,function(e){return e[x].toString()===t})}(t,e)||{},o=-1;return(0,he.isEmpty)(a)?a:er(er({index:o=void 0!==a.index?a.index:r.labels.cellIds.indexOf(e)},a),{},(0,f.A)({},O,n[o]))}),Wr=(0,Pn.Mz)([Kr],function(e){return(0,he.isEmpty)(e)?"":e[_].toString()}),qr=(0,Pn.Mz)([Kr],function(e){return!!e.transform}),Xr=(0,Pn.Mz)([Kr,Fr],function(e,t){var n=e.index;return void 0===n?{}:(0,he.mapValues)(t,function(e){return e[n]})}),Yr=(0,Pn.Mz)([On,or,tr,nr,cr],function(e,t,n,r,a){var o=[],l=[],i=[];return(0,he.mapValues)(t,function(t,c){t.forEach(function(t){o.push(a[c]),l.push(e.values[n][t.pointIndex]),i.push(e.values[r][t.pointIndex])})}),{color:o,x:l,y:i}}),Zr=(0,Pn.Mz)([or],function(e){return(0,he.keys)(e)}),Qr=(0,Pn.Mz)([or],function(e){return(0,he.map)(e,function(e){return e.length})});const Jr={actions:r,logics:Jn,reducer:Bt,selectors:i,types:c};var $r=function(e){return ge("image-dataset",e)},ea=$r("load-csv-dataset"),ta=$r("change-image-dataset-type");function na(e){return{payload:e,type:ta}}function ra(e){return{payload:e,type:ea}}var aa=n(6653),oa=n(84199),la=n(79988);function ia(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ca(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ca(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}function ca(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var sa="_defaultGroupByNone",ua="File ID",da="Thumbnail",fa="File Path",pa="Cell Line",ma="File Name",ha="file_id",ya="thumbnail",ga="file_path",va="file_name",ba="Link Path",Aa=new Set([x,_,I,T,F,N,"transform",ua,da,fa,ma,"File Size","Uploaded",ga,va,ha,ya,"file_size","uploaded",ba]),wa=["#27B4AE","#4047C4","#F48730","#DB4281","#7E84F4","#78DF76","#1C7AED","#7129CD","#E7C73B","#C95F1E","#188E61","#BEE952"],Ca=function(e){return e[e.CONTINUOUS=0]="CONTINUOUS",e[e.DISCRETE=1]="DISCRETE",e}(Ca||{});function Ea(e){return null===e||"string"==typeof e&&("nan"===e.trim().toLowerCase()||!isNaN(Number(e))&&!isNaN(parseFloat(e)))}function Sa(e){for(var t=0;t<e.length;t++)if(null!==e[t])return"string"==typeof e[t];return!1}function Da(e){if(0===e.length)return!1;for(var t=0;t<e.length;t++)if(null!==e[t])return!0;return!1}var ka=function(){return(0,m.A)(function e(t){var n=this;(0,p.A)(this,e),(0,f.A)(this,"csvData",void 0),(0,f.A)(this,"idToIndex",void 0),(0,f.A)(this,"featureInfo",void 0),(0,f.A)(this,"defaultGroupByFeatureKey",void 0),(0,f.A)(this,"remapBffOrFmsKeys",function(e){var t=n.copyColumnIfEmpty(e,ua,x),r=n.copyColumnIfEmpty(e,ha,x);t||r||(n.copyColumnIfEmpty(e,ma,x),n.copyColumnIfEmpty(e,va,x)),n.copyColumnIfEmpty(e,da,F),n.copyColumnIfEmpty(e,ya,F),n.copyColumnIfEmpty(e,fa,N),n.copyColumnIfEmpty(e,ga,N)}),this.csvData=[],this.idToIndex={},this.featureInfo=new Map,this.defaultGroupByFeatureKey="",this.parseCsvData(t)},[{key:"getFeatureKeysFromColumnNames",value:function(e){return Object.keys(e[0]).filter(function(e){return!Aa.has(e)&&""!==e})}},{key:"getFeatureKeyClamped",value:function(e,t){var n=e.length-1;return e[Math.min(Math.max(t,0),n)]}},{key:"getFeatureDataAsColumns",value:function(e,t){var n,r=new Map,a=ia(t);try{for(a.s();!(n=a.n()).done;){var o,l=n.value,i=[],c=!0,s=ia(e);try{for(s.s();!(o=s.n()).done;){var u,d=null!==(u=o.value[l])&&void 0!==u?u:null;null===d||"string"==typeof d&&""===d.trim()?i.push(null):(i.push(d),Ea(d)||(c=!1))}}catch(e){s.e(e)}finally{s.f()}if(c){var f=i.map(function(e){return e?Number.parseFloat(e):null});r.set(l,f)}else r.set(l,i)}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"parseDiscreteFeature",value:function(e,t){for(var n=new Map,r=[],a=0;a<t.length;a++){var o=t[a];if(null!==o){var l=o.trim(),i=n.get(l);i||(i={index:n.size,count:0},n.set(l,i)),i.count++,r.push(i.index)}else r.push(null)}var c,s={},u=ia(n.entries());try{for(u.s();!(c=u.n()).done;){var d=(0,re.A)(c.value,2),f=d[0],p=d[1],m=p.index,h=p.count;s[m.toString()]={color:wa[m%wa.length],name:f,key:f,count:h}}}catch(e){u.e(e)}finally{u.f()}return{def:{discrete:!0,displayName:e,description:e,key:e,options:s,tooltip:e},data:r}}},{key:"parseFeatures",value:function(e){this.featureInfo.clear();var t,n=this.getFeatureKeysFromColumnNames(e),r=this.getFeatureDataAsColumns(e,n),a=ia(n);try{for(a.s();!(t=a.n()).done;){var o=t.value,l=r.get(o);if(l&&Da(l))if(Sa(l)){var i=this.parseDiscreteFeature(o,l),c=i.def,s=i.data;this.featureInfo.set(o,{type:Ca.DISCRETE,def:c,data:s})}else{var u={discrete:!1,displayName:o,description:o,key:o,tooltip:o};this.featureInfo.set(o,{type:Ca.CONTINUOUS,def:u,data:l})}}}catch(e){a.e(e)}finally{a.f()}}},{key:"assignDefaultGroupByFeatureKey",value:function(e){var t=e[0];if(t&&void 0!==t[pa])this.defaultGroupByFeatureKey=pa;else{var n=Array.from(this.featureInfo.values()).find(function(e){return e.type===Ca.DISCRETE});if(n)this.defaultGroupByFeatureKey=n.def.key;else{var r={0:{color:wa[0],name:"Default",key:"0",count:e.length}};this.featureInfo.set(sa,{type:Ca.DISCRETE,def:{discrete:!0,displayName:"(None)",description:"(None)",key:sa,tooltip:"(None)",options:r},data:new Array(e.length).fill(0)}),this.defaultGroupByFeatureKey=sa}}}},{key:"copyColumnIfEmpty",value:function(e,t,n){return void 0!==e[t]&&(void 0===e[n]||""===e[n])&&(e[n]=e[t],!0)}},{key:"parseCsvData",value:function(e){var t=oa.parse(e,{header:!0,transformHeader:function(e){return e.trim()},skipEmptyLines:"greedy"}).data;if(this.csvData=t,0===this.csvData.length)throw new Error("No data found in CSV");for(var n=0;n<this.csvData.length;n++)this.remapBffOrFmsKeys(this.csvData[n]);for(var r=!0,a=0;a<this.csvData.length;a++){var o=this.csvData[a];if(void 0===o[x]||""===o[x].trim()){r=!1;break}}for(var l=0;l<this.csvData.length;l++){var i=this.csvData[l];r||(i[x]=l.toString()),this.idToIndex[i[x].trim()]=l}this.parseFeatures(this.csvData),this.assignDefaultGroupByFeatureKey(this.csvData)}},{key:"selectDataset",value:function(){var e=Array.from(this.featureInfo.keys());return Promise.resolve({defaultXAxis:this.getFeatureKeyClamped(e,0),defaultYAxis:this.getFeatureKeyClamped(e,1),defaultColorBy:this.defaultGroupByFeatureKey,defaultGroupBy:this.defaultGroupByFeatureKey,thumbnailRoot:"",downloadRoot:"",volumeViewerDataRoot:""})}},{key:"getAvailableDatasets",value:function(){var e={name:"csv",title:"CSV Dataset",production:!1,dateCreated:la.A.firestore.Timestamp.now(),datasets:{csv:{name:"csv",title:"CSV Dataset",version:"1",id:"csv",description:"A dataset imported from a CSV file",index:0,userData:{}}}};return Promise.resolve([e])}},{key:"getViewerChannelSettings",value:function(){return Promise.resolve({groups:[{name:"Channels",channels:[{match:[0,1,2],enabled:!0},{match:"(.+)",enabled:!1}]}]})}},{key:"getFeatureKeyToData",value:function(){var e,t={},n=ia(this.featureInfo.entries());try{for(n.s();!(e=n.n()).done;){var r=(0,re.A)(e.value,2),a=r[0],o=r[1];t[a]=o.data}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getFeatureData",value:function(){for(var e=this.csvData.map(function(e,t){return t}),t=this.getFeatureKeyToData(),n=[],r=[],a=[],o=0;o<e.length;o++){var l=this.csvData[o];r.push(l[x]),n.push(l[F]||""),a.push(l[N]||l[T]||"")}return Promise.resolve({indices:e,values:t,labels:{thumbnailPaths:n,cellIds:r,sourcePaths:a}})}},{key:"getAlbumData",value:function(){return Promise.resolve([])}},{key:"getMeasuredFeatureDefs",value:function(){var e=Array.from(this.featureInfo.values()).map(function(e){return e.def});return Promise.resolve(e)}},{key:"getFileInfoByCellId",value:(t=(0,ne.A)(oe().mark(function e(t){var n,r,a,o,l,i;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.idToIndex[t])){e.next=1;break}return e.abrupt("return",Promise.resolve(void 0));case 1:if(r=this.csvData[n]){e.next=2;break}return e.abrupt("return",Promise.resolve(void 0));case 2:if(!r[ba]){e.next=4;break}return o=r[ba].split("?"),l=o[o.length-1]||"",e.next=3,(0,aa.bT)(new URLSearchParams(l));case 3:a=e.sent;case 4:return i=(0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},x,r[x]),_,r[_]),I,r[I]),T,r[T]),F,r[F]),N,r[N]),O,r[O]||this.defaultGroupByFeatureKey),"voleUrlParams",a),e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getFileInfoByArrayOfCellIds",value:(e=(0,ne.A)(oe().mark(function e(t){var n,r=this;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return r.getFileInfoByCellId(e)}),e.abrupt("return",Promise.all(n));case 1:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})}]);var e,t}();const Pa=ka,Oa=[(0,_t.A)({type:ea,process:function(e,t,n){return(0,ne.A)(oe().mark(function r(){var a,o,l,i,c;return oe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.action,o=a.payload,r.prev=1,l=new Pa(o),r.next=2,l.getAvailableDatasets();case 2:i=r.sent,t(pn(i)),t(Ct("csv")),t(na(l)),r.next=4;break;case 3:r.prev=3,c=r.catch(1),console.error("Error loading CSV dataset:",c);case 4:return r.prev=4,n(),r.finish(4);case 5:case"end":return r.stop()}},r,null,[[1,3,4,5]])}))()}})];var xa=n(71083);n(58707),la.A.initializeApp({apiKey:"AIzaSyD691xhXsWl-8QU_9htjZnMUd7siWVCTAE",appId:"1:40711248674:web:511cb4cede47191274237b",authDomain:"allen-cell-resource.firebaseapp.com",databaseURL:"https://allen-cell-resource.firebaseio.com",measurementId:"G-8553S8ESS7",messagingSenderId:"40711248674",projectId:"allen-cell-resource",storageBucket:"allen-cell-resource.appspot.com"});var _a=la.A.firestore();function Ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ta(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ia(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ia(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Fa=(0,m.A)(function e(){var t=this;(0,p.A)(this,e),(0,f.A)(this,"collectionRef",void 0),(0,f.A)(this,"featuresDataPath",void 0),(0,f.A)(this,"cellLineDataPath",void 0),(0,f.A)(this,"viewerSettingsPath",void 0),(0,f.A)(this,"thumbnailRoot",void 0),(0,f.A)(this,"downloadRoot",void 0),(0,f.A)(this,"volumeViewerDataRoot",void 0),(0,f.A)(this,"featuresDisplayOrder",void 0),(0,f.A)(this,"datasetId",void 0),(0,f.A)(this,"fileInfoPath",void 0),(0,f.A)(this,"featuresDataOrder",void 0),(0,f.A)(this,"albumPath",void 0),(0,f.A)(this,"featureDefsPath",void 0),(0,f.A)(this,"viewerChannelSettings",void 0),(0,f.A)(this,"getDoc",function(e){return _a.doc(e).get()}),(0,f.A)(this,"getCollection",function(e){return _a.collection(e).get()}),(0,f.A)(this,"getAvailableDatasets",function(){return _a.collection("dataset-descriptions").get().then(function(e){var t=[];return e.forEach(function(e){var n=e.data();n.datasets=(0,he.reduce)(n.datasets,function(e,t,n){return t.id=n,(Gt(location.hostname)||t.production)&&(e[n]=t),e},{}),(Gt(location.hostname)||n.production)&&t.push(n)}),t})}),(0,f.A)(this,"setCollectionRef",function(e){t.collectionRef=_a.collection("cfe-datasets").doc(e)}),(0,f.A)(this,"getManifest",function(e){return _a.doc(e).get().then(function(e){return e.data()})}),(0,f.A)(this,"selectDataset",function(e){return t.viewerChannelSettings=void 0,t.getManifest(e).then(function(e){return t.featuresDataPath=e.featuresDataPath,t.viewerSettingsPath=e.viewerSettingsPath,t.thumbnailRoot=e.thumbnailRoot,t.downloadRoot=e.downloadRoot,t.volumeViewerDataRoot=e.volumeViewerDataRoot,t.featuresDisplayOrder=e.featuresDisplayOrder,t.fileInfoPath=e.fileInfoPath,t.featuresDataOrder=e.featuresDataOrder,t.featureDefsPath=e.featureDefsPath,t.albumPath=e.albumPath,{defaultXAxis:e.xAxis.default,defaultYAxis:e.yAxis.default,defaultColorBy:e.colorBy.default,defaultGroupBy:e.groupBy.default,thumbnailRoot:e.thumbnailRoot,downloadRoot:e.downloadRoot,volumeViewerDataRoot:e.volumeViewerDataRoot}})}),(0,f.A)(this,"getViewerChannelSettings",function(){return t.viewerChannelSettings?Promise.resolve(t.viewerChannelSettings):t.viewerSettingsPath?xa.A.get(t.viewerSettingsPath).then(function(e){return e.data}).then(function(e){return t.viewerChannelSettings=e,t.viewerChannelSettings}):Promise.resolve({})}),(0,f.A)(this,"requestSetOfFeatureDefs",function(){var e=(0,ne.A)(oe().mark(function e(n,r){var a;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.splice(0,10),e.next=1,_a.collection(t.featureDefsPath).where("key","in",a).get();case 1:if(e.sent.forEach(function(e){var n=e.data(),a=n.key,o=t.featuresDisplayOrder.indexOf(a);r[o]=n}),!n.length){e.next=2;break}return e.abrupt("return",t.requestSetOfFeatureDefs(n,r));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),(0,f.A)(this,"getMeasuredFeatureDefs",(0,ne.A)(oe().mark(function e(){var n,r;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,It.A)(t.featuresDisplayOrder),r=[],e.next=1,t.requestSetOfFeatureDefs(n,r);case 1:return e.abrupt("return",r);case 2:case"end":return e.stop()}},e)}))),(0,f.A)(this,"getFeatureData",function(){return xa.A.get(t.featuresDataPath).then(function(e){return e.data}).then(function(e){for(var n=t.featuresDisplayOrder.reduce(function(e,t){return e[t]=[],e},{}),r=[],a=[],o=[],l=[],i=0;i<e.length;i++){o.push(i);var c=e[i];c.f.forEach(function(e,r){var a=n[t.featuresDataOrder[r]];isNaN(e)?a.push(null):a.push(Number(e))},{}),r.push(c.p),a.push(c.t),l.push(c.i.toString())}return{indices:o,values:n,labels:{thumbnailPaths:a,cellIds:l}}}).catch(function(e){console.log("ERROR FETCHING FEATURE DATA:",e)})}),(0,f.A)(this,"getFileInfoByCellId",function(e){return t.getDoc("".concat(t.fileInfoPath,"/").concat(e)).then(function(e){var t=e.data();if(t)return Ta(Ta({},t),{},{CellId:t.CellId.toString(),FOVId:t.FOVId.toString()})})}),(0,f.A)(this,"getFileInfoByArrayOfCellIds",function(e){return Promise.all(e.map(function(e){return t.getDoc("".concat(t.fileInfoPath,"/").concat(e)).then(function(e){var t=e.data();if(t)return Ta(Ta({},t),{},{CellId:t.CellId.toString(),FOVId:t.FOVId.toString()})})}))}),(0,f.A)(this,"getAlbumData",function(){return t.albumPath?t.getCollection(t.albumPath).then(function(e){var t=[];return e.forEach(function(e){t.push(e.data())}),t}):Promise.resolve([])}),this.featuresDataPath="",this.viewerSettingsPath="",this.cellLineDataPath="",this.thumbnailRoot="",this.downloadRoot="",this.volumeViewerDataRoot="",this.featuresDisplayOrder=[],this.fileInfoPath="",this.datasetId="",this.featuresDataOrder=[],this.albumPath="",this.featureDefsPath="",this.collectionRef=_a.collection("cfe-datasets").doc("v1")});function Na(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ba(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Na(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Na(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ja={imageDataset:new Fa};const Ma={actions:s,logics:Oa,reducer:ve((0,f.A)({},ta,{accepts:function(e){return e.type===ta},perform:function(e,t){return Ba(Ba({},e),{},{imageDataset:t.payload})}}),ja),selectors:l,types:u},Ra={"csv-upload":"styles__csv-upload--rx16G",csvUpload:"styles__csv-upload--rx16G"};var Ua=function(e){return e.Device="device",e.Web="web",e}(Ua||{}),Va={loadCsvDataset:Ma.actions.loadCsvDataset,setCsvUrl:Jr.actions.setCsvUrl};const za=(0,b.Ng)(function(e){return{dataset:Ma.selectors.getImageDataset(e)}},Va)(function(e){var t=(0,g.useState)(!1),n=(0,re.A)(t,2),r=n[0],a=n[1],o=(0,g.useState)(Ua.Device),l=(0,re.A)(o,2),i=l[0],c=l[1],s=(0,g.useState)(""),u=(0,re.A)(s,2),d=u[0],f=u[1],p=(0,g.useState)(""),m=(0,re.A)(p,2),h=m[0],y=m[1],v=(0,g.useState)(!1),b=(0,re.A)(v,2),A=b[0],w=b[1];(0,g.useEffect)(function(){a(!1)},[e.dataset]);var C=function(){var t=(0,ne.A)(oe().mark(function t(n){var r;return oe().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w(!0),t.next=1,n.text();case 1:if(0!==(r=t.sent).trim().length){t.next=2;break}return y("The provided file is empty."),w(!1),t.abrupt("return","");case 2:try{e.loadCsvDataset(r),e.setCsvUrl("")}catch(e){y(e.message)}return w(!1),t.abrupt("return","");case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),E=function(){var t=(0,ne.A)(oe().mark(function t(){var n,r,a,o,l;return oe().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(w(!0),t.prev=1,Wt(n=d.trim())||Kt(n)){t.next=2;break}throw new Error("Please enter a valid HTTP(S) URL.");case 2:return t.next=3,Xt(n);case 3:r=t.sent,a=r.url,o=r.text,e.loadCsvDataset(o),e.setCsvUrl(a),t.next=5;break;case 4:t.prev=4,l=t.catch(1),y(l.message);case 5:w(!1);case 6:case"end":return t.stop()}},t,null,[[1,4]])}));return function(){return t.apply(this,arguments)}}(),S=g.createElement(ie.Ay,{onClick:function(){return a(!1)}},"Cancel");return g.createElement(g.Fragment,null,g.createElement(ie.Ay,{onClick:function(){a(!0),w(!1),y("")}},g.createElement(le.A,null),"Load"),g.createElement(ce.A,{title:"Load a .csv dataset",open:r,onCancel:function(){return a(!1)},footer:S},g.createElement(se.A,{vertical:!0,align:"center",gap:16,style:{margin:"16px 0"}},g.createElement(ue.Ay.Group,{buttonStyle:"solid",optionType:"button",style:{display:"flex",flexDirection:"row",justifyContent:"center",width:"100%"},value:i,onChange:function(e){return c(e.target.value)},disabled:A},g.createElement(ue.Ay,{style:{minWidth:"40%",display:"flex",justifyContent:"center"},value:Ua.Device},"From your device"),g.createElement(ue.Ay,{style:{minWidth:"40%",display:"flex",justifyContent:"center"},value:Ua.Web},"From the web")),i===Ua.Device&&g.createElement("div",{style:{width:"100%"}},g.createElement(me.A,{className:Ra.csvUpload,action:C,accept:".csv",multiple:!1,showUploadList:!1,disabled:A},g.createElement(se.A,{vertical:!0,align:"center"},g.createElement("p",{style:{fontSize:"30px"}},A?g.createElement(de.A,{className:Ra.uploadSpinner,indicator:g.createElement(J.A,{spin:!0}),size:"large"}):g.createElement(le.A,null)),g.createElement("p",null,"Click or drag a .csv file here to load.")))),i===Ua.Web&&g.createElement(se.A,{vertical:!0,style:{width:"100%"},gap:6},g.createElement("p",{style:{margin:0}},"Provide the URL of a .csv file"),g.createElement(fe.A.Compact,{style:{width:"100%"}},g.createElement(pe.A,{placeholder:"https://example.com/dataset.csv",value:d,onChange:function(e){return f(e.target.value)},onPressEnter:E}),g.createElement(ie.Ay,{type:"primary",onClick:E,loading:A},"Load")))),h&&g.createElement("span",{style:{color:"var(--text-red)"}},h)))});function Ga(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ga=function(){return!!e})()}const La=function(e){function t(){return(0,p.A)(this,t),e=this,n=t,r=arguments,n=(0,H.A)(n),(0,L.A)(e,Ga()?Reflect.construct(n,r||[],(0,H.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.props.selectedDataset;return g.createElement("div",{className:"style__page-header--b9ZaQ"},g.createElement(Q.A,{align:"middle"},g.createElement("a",{href:"https://allencell.org",title:"Allen Institute for Cell Science",style:{height:"41px"}},te),g.createElement("span",{className:"style__vertical-bar--gcXcn"},"|"),g.createElement("a",{href:"/",className:"style__cfe-home--DZcrh"},"Cell Feature Explorer")),g.createElement("div",{className:"style__viewer-title--j_YyS"},e),g.createElement("div",{className:"style__buttons--Ow6C4"},g.createElement(za,null)))}}])}(g.Component);var Ha=(0,_t.A)({process:function(e,t,n){var r=(0,e.getState)();return Kn(r).getAvailableDatasets().then(function(e){return t(pn(e))}).catch(function(e){console.log(e)}).then(function(){return n()})},type:an}),Ka=function(e){return Math.floor(Math.random()*e)},Wa=function(e,t,n){return null!==e[n]&&null!==t[n]},qa=function(e,t,n){for(var r=e,a=0;a<r;){var o=Ka(e);if(Wa(t,n,o))return o;a++}return 0},Xa=(0,_t.A)({process:function(e,t,n){return(0,ne.A)(oe().mark(function r(){var a,o,l,i,c;return oe().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.getState,o=a(),l=Kn(o),!Tn(a())){r.next=1;break}return r.abrupt("return");case 1:return t(Dn("Loading plot data, may take several seconds to a minute...")),i=[],r.next=2,l.getMeasuredFeatureDefs();case 2:return c=r.sent,i.push(gn(c)),r.abrupt("return",l.getFeatureData().then(function(e){return e?(i.push(yn(e)),t(Ae(i)),e):n()}).then(function(e){if(!e)return n();var r=Ar(o),a=0;if(r.length)t(Pt(r));else{var l=e.labels[D],i=tr(o),c=nr(o),s=e.values[i],u=e.values[c];i&&c&&(a=qa(l.length,s,u)),t(ut({id:e.labels[D][a],index:a}))}ur(o)||t(pt({id:e.labels[D][a]})),t(Sn())}).catch(function(e){console.log(e)}).then(function(){return n()}));case 3:case"end":return r.stop()}},r)}))()},type:Qt}),Ya=(0,_t.A)({process:function(e,t,n){var r=(0,e.getState)(),a=Kn(r);return t(Dn("Loading album data...")),a.getAlbumData().then(n).catch(function(e){console.log(e)}).then(function(){return n()})},processOptions:{successType:$t},type:Jt}),Za=(0,_t.A)({process:function(e,t,n){var r=(0,e.getState)();return Kn(r).getViewerChannelSettings().then(function(e){return t(En(e)),e}).then(n).catch(function(e){console.log(e)}).then(function(){return n()})},type:un});function Qa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ja(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qa(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qa(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $a={albums:[],cellFileInfo:[],isLoading:!0,loadingText:"",showSmallScreenWarning:!1,megasets:[],featureData:{indices:[],values:{},labels:{}},measuredFeaturesDefs:[],viewerChannelSettings:{}};const eo={actions:a,logics:[Ya,Xa,Ha,Za],reducer:ve((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},Zt,{accepts:function(e){return e.type===Zt},perform:function(e,t){return Ja(Ja({},e),{},{featureData:t.payload})}}),sn,{accepts:function(e){return e.type===sn},perform:function(e){return Ja(Ja({},e),{},{cellFileInfo:$a.cellFileInfo,isLoading:$a.isLoading,featureData:$a.featureData,measuredFeaturesDefs:$a.measuredFeaturesDefs,viewerChannelSettings:$a.viewerChannelSettings})}}),rn,{accepts:function(e){return e.type===rn},perform:function(e,t){return Ja(Ja({},e),{},{megasets:t.payload})}}),cn,{accepts:function(e){return e.type===cn},perform:function(e,t){return Ja(Ja({},e),{},{cellFileInfo:t.payload})}}),$t,{accepts:function(e){return e.type===$t},perform:function(e,t){return Ja(Ja({},e),{},{albums:t.payload})}}),dn,{accepts:function(e){return e.type===dn},perform:function(e,t){return Ja(Ja({},e),{},{viewerChannelSettings:t.payload})}}),en,{accepts:function(e){return e.type===en},perform:function(e,t){return Ja(Ja({},e),{},{isLoading:t.payload,loadingText:t.payload?e.loadingText:$a.loadingText})}}),tn,{accepts:function(e){return e.type===tn},perform:function(e,t){return Ja(Ja({},e),{},{loadingText:t.payload})}}),nn,{accepts:function(e){return e.type===nn},perform:function(e,t){return Ja(Ja({},e),{},{showSmallScreenWarning:t.payload})}}),on,{accepts:function(e){return e.type===on},perform:function(e,t){return Ja(Ja({},e),{},{measuredFeaturesDefs:t.payload})}}),$a),selectors:o,types:d};var to=n(16370),no=n(55957),ro=n(58168),ao=n(11575),oo=n(56914),lo=n(36552);const io={card:"style__card--NiCPa",spacer:"style__spacer--HWBx1",loadButton:"style__loadButton--N_lqo"};var co=ao.A.Meta;const so=function(e){var t=e.title,n=e.name,r=e.version,a=e.description,o=e.handleSelectDataset,l=e.link,i=e.id,c=e.userData,s=e.image,u=r.startsWith("v")?r:"v".concat(r),d=g.createElement(g.Fragment,null,g.createElement("div",null,c.isNew&&g.createElement(oo.A,{color:"#8950d9"},"new"),t||n),g.createElement("span",{className:io.version},u),c.inReview&&g.createElement(g.Fragment,null,g.createElement(lo.A,{type:"vertical"})," (in review)")),f=g.createElement(ao.A,{className:io.card,hoverable:!0,bordered:!1,cover:""!=s?g.createElement("img",{className:io.staticThumbnail,alt:"Snapshot of simulation for ".concat(t),src:s}):null,onClick:function(){return o(i)}},g.createElement(co,{title:d,description:g.createElement("div",{className:"content",dangerouslySetInnerHTML:{__html:a}})}),g.createElement("div",{className:io.spacer}),g.createElement(no.A,{column:1,size:"small",colon:!1},c.totalCells&&g.createElement(no.A.Item,{label:"Number of Cells:"},c.totalCells.toLocaleString("en")),c.totalFOVs&&g.createElement(no.A.Item,{label:"Number of FOVs:"},c.totalFOVs.toLocaleString("en")),c.totalTaggedStructures&&g.createElement(no.A.Item,{label:"Number of tagged structures:"},c.totalTaggedStructures)),g.createElement(ie.Ay,{type:"primary",className:io.loadButton},"Load"));return l?g.createElement("a",{href:l},f):f},uo=function(e){var t=e.megaset,n=e.handleSelectDataset,r=getComputedStyle(document.body).getPropertyValue("--dataset-card-width"),a=Object.keys(t.datasets).length,o=a>1?"100%":r,l=(0,he.map)(t.datasets).sort(function(e,t){return e.index-t.index});return g.createElement("div",{key:t.name,className:"style__container--wG8VX",style:{maxWidth:o}},a>1&&g.createElement("div",{className:"style__megasetTitle--JTBkg"},t.title),g.createElement("div",{className:"style__datasetCards--UfwX8"},(0,he.map)(l,function(e){return g.createElement(so,(0,ro.A)({key:e.id},e,{handleSelectDataset:n}))})),t.extra&&g.createElement("div",{className:"style__extra--ltgun"},t.extra),t.publications&&t.publications.length>0&&g.createElement("div",{className:"style__publications--Ut6Bo"},"Publications",t.publications.map(function(e){return g.createElement("div",{key:"".concat(t.name,"-").concat(e.title),className:"style__publication--WYEYy"},g.createElement("div",{className:"style__publicationTitle--Q4rKq"},g.createElement("a",{href:e.url,target:"blank"},e.title)),g.createElement("div",{className:"style__journalDate--Ie_nT"},e.citation,"."))})))},fo=[{date:"May/26/2021",title:"The hiPSC single-cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/21/2022",title:"The hiPSC single i1 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_i1_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/20/2022",title:"The hiPSC single M1 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_m1_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/21/2022",title:"The hiPSC single i2 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_i2_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/20/2022",title:"The hiPSC single M2 cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_m2_cell_image_dataset/tree/latest/metadata.csv"},{date:"Jul/19/2022",title:"The hiPSC single edge cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_edge_cell_image_dataset/tree/latest/metadata.csv"},{date:"Sep/28/2022",title:"The hiPSC single non-edge cell image dataset",link:"https://open.quiltdata.com/b/allencell/packages/aics/hipsc_single_nonedge_cell_image_dataset/tree/latest/metadata.csv"}],po="style__subtitle--XvF02 style__title--NfBvu",mo="style__section--rIc_K",ho="style__section-content--RbA_O",yo="style__light-section--tJbzl style__section--rIc_K",go="style__paragraph--IZ0BZ";var vo=W.A.Content;const bo=function(e){var t=e.handleSelectDataset,n=e.megasets;return g.createElement(W.A,null,g.createElement(Q.A,{className:yo},g.createElement("h1",{className:po},"Welcome to Cell Feature Explorer"),g.createElement(to.A,{className:ho},g.createElement("div",{className:go},"The Cell Feature Explorer (CFE) is an online tool to access segmented and processed images of over 200,000 cells as curated datasets. Each dataset has specific measured features, such as cellular volume and mitosis stage that are described in the user interface and detailed in publications associated with each dataset. The CFE is composed of a plot, where each cell is graphed by these measured features, and a 3D viewer for in-depth visual analysis."))),g.createElement(W.A,null,g.createElement(vo,{className:"style__content--tOv3o"},g.createElement(Q.A,{className:mo},g.createElement("div",{className:ho},g.createElement("h2",{className:po},"Load a dataset to get started"),g.createElement(Q.A,{className:"style__card-container--xhYX0"},n.map(function(e){return g.createElement(uo,{key:e.name,megaset:e,handleSelectDataset:t})})))),g.createElement(Q.A,{className:yo},g.createElement(to.A,{className:ho},g.createElement("h2",{className:po},"Cell features in our data "),g.createElement("div",{className:go},"hiPS cells from the"," ",g.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://www.allencell.org/cell-catalog.html"},"Allen Cell Collection")," ","grow in epithelial-like monolayer colonies when cultured on glass using our methods. We image rectangular fields of view (FOV) from these colonies in 3D, using spinning disk confocal microscopy. We collect four channels of data for each FOV, including one brightfield channel and three fluorescent channels:",g.createElement("ul",null,g.createElement("li",null,"dyed DNA "),g.createElement("li",null,"dyed cell membrane "),g.createElement("li",null,"one fluorescently labeled protein designed to visualize a particular organelle or cellular structure via endogenous tagging"))),g.createElement("div",{className:go},"The fluorescent channels are segmented to demarcate structures and to define the boundaries of individual cells. The segmented structures are then measured, and the data for these measurements, as well as cell and nuclear shape modes (derived from a principal component analysis; please see our recent article in"," ",g.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://www.biorxiv.org/content/10.1101/2020.12.08.415562v1"},"bioRxiv"),") are made available for plotting at the top of the CFE tool page. The beautiful cells and the FOVs from which they were segmented can be explored in a 3D viewer at the bottom of the CFE tool page."))),g.createElement(Q.A,{className:mo},g.createElement(to.A,{className:ho},g.createElement("h2",{className:po},"Download cell feature data (via Quilt)"),g.createElement(Q.A,{className:mo},g.createElement(no.A,{layout:"horizontal",colon:!1,column:1,style:{margin:"10px 0"}},g.createElement(no.A.Item,{label:"RELEASE DATE"},"DATASET"),fo.map(function(e,t){return g.createElement(g.Fragment,null,g.createElement(no.A.Item,{label:e.date,key:t}," ",g.createElement("a",{target:"_blank",href:e.link,rel:"noreferrer"},e.title)))}))),g.createElement("div",{className:go},"Once you navigate to Quilt, you can follow the instructions provided to access the cell feature data. If you need assistance, please visit the"," ",g.createElement("a",{href:"https://forum.allencell.org/tags/c/software-code/11/cell-feature-explorer"},"Allen Cell Discussion Forum"),"."))))))};var Ao=n(87206),wo=n(4118);var Co={flex:1,width:"100%",height:"100%",backgroundColor:"red"};const Eo=function(e){return e.cellId?g.createElement("div",{className:"style__cell-viewer-container--Uybfp",style:Co},g.createElement(aa.TV,{viewerSettings:e.viewerSettings},g.createElement(aa.N$,(0,ro.A)({cellId:e.cellId,imageUrl:e.baseUrl+e.cellPath,imageDownloadHref:e.cellDownloadHref,parentImageUrl:e.fovPath?e.baseUrl+e.fovPath:"",parentImageDownloadHref:e.fovDownloadHref,viewerChannelSettings:e.viewerChannelSettings,transform:e.transform,onControlPanelToggle:e.onControlPanelToggle,metadata:e.metadata,appHeight:"100%",canvasMargin:"0 0 0 0"},e.appProps)))):null};var So=n(40920);const Do=function(e){var t=e.visible,n=e.handleClose,r=e.onDismissCheckboxChecked;return g.createElement(ce.A,{centered:!0,title:"Small Screen Warning",open:t,onOk:n,onCancel:n,footer:null},g.createElement("p",null,"Many features of this web tool are hidden while using it on a small screen."),g.createElement("p",null,"To access all features, including a tool to plot measurements for over 30,000 cells, please visit this web page on a larger screen."),g.createElement("div",{className:"style__checkbox-container--Oh8_b"},g.createElement(So.A,{onChange:function(e){var t=e.target;return r(t.checked)}},"Don't show this message again.")),g.createElement("div",{className:"style__button-container--uU5cj"},g.createElement(ie.Ay,{className:"style__ok-button--dUxzH",onClick:n,type:"primary"},"OK")))};var ko=n(47852),Po=n(53691),Oo=n(16044),xo=n(59676),_o=n(40756),Io=n(45824),To=n(30761),Fo=n(37977),No=n(73586),Bo=n(73938);function jo(e){return Mo.apply(this,arguments)}function Mo(){return Mo=(0,ne.A)(oe().mark(function e(t){var n,r;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new No.A(t),e.next=1,(0,Bo.rk)(n);case 1:return r=e.sent,e.abrupt("return",r);case 2:case"end":return e.stop()}},e)})),Mo.apply(this,arguments)}function Ro(e,t){var n=(0,g.useState)(e),r=(0,re.A)(n,2),a=r[0],o=r[1];return(0,g.useEffect)(function(){var n=function(){var n=(0,ne.A)(oe().mark(function n(){var r,a,l,i,c;return oe().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a=void 0,l=null!==(r=null==t?void 0:t.volumeviewerPath)&&void 0!==r?r:null==t?void 0:t.fovVolumeviewerPath,e&&e.endsWith(".zarr")?a=e:l&&l.endsWith(".zarr")&&(a=l),!a){n.next=4;break}return n.prev=1,n.next=2,jo(a);case 2:return i=n.sent,o(i),n.abrupt("return");case 3:n.prev=3,c=n.catch(1),console.error("Error generating thumbnail for file ".concat(a," :"),c);case 4:case"end":return n.stop()}},n,null,[[1,3]])}));return function(){return n.apply(this,arguments)}}();n()},[e]),a}const Uo={container:"style__container--hMtze",small:"style__small--NUf0x","action-list":"style__action-list--k3zlB",actionList:"style__action-list--k3zlB",disabled:"style__disabled--loRMz",selected:"style__selected--BN2Ob",stage:"style__stage--cgwYC",placeholderAvatar:"style__placeholderAvatar--Swup9"},Vo=function(e){var t=Ro(e.src,e.fileInfo),n=function(){e.handleOpenIn3D({id:e.cellID})},r=[];e.downloadHref&&r.push({key:"1",label:g.createElement("a",{href:e.downloadHref},g.createElement(_o.A,null)," Segmented cell")}),e.downloadFullField&&r.push({key:"2",label:g.createElement("a",{href:e.downloadFullField},g.createElement(_o.A,null)," Full field image")});var a=""!==e.downloadHref||""!==e.downloadFullField,o=[g.createElement(ie.Ay,{key:"".concat(e.cellID,"-load"),onClick:n},"3D"),g.createElement(lo.A,{key:"".concat(e.cellID,"-0"),type:"vertical"}),g.createElement(To.A,{key:"".concat(e.cellID,"-download"),menu:{items:r},trigger:["click"],disabled:!a},g.createElement(Fo.A,{key:"".concat(e.cellID,"-download"),title:a?null:V,trigger:["hover","focus"]},g.createElement(ie.Ay,{disabled:!a},g.createElement(_o.A,null)))),g.createElement(lo.A,{key:"".concat(e.cellID,"-1"),type:"vertical"}),g.createElement(ie.Ay,{key:"".concat(e.cellID,"-close"),onClick:function(){e.handleDeselectPoint(e.cellID)}},g.createElement(ko.A,null))];return g.createElement(xo.A.Item,{key:e.cellID,className:Uo.container,style:{width:e.widthPx},id:e.cellID?e.cellID.toString():"",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},g.createElement(ao.A,{className:e.selected?Uo.selected:Uo.unselected,loading:e.empty,cover:t?g.createElement("img",{alt:"thumbnail of microscopy image",src:t,onClick:n}):g.createElement(Io.A,{onClick:n,style:{padding:"12px 0",fontSize:"".concat(e.widthPx/3,"px")}})},g.createElement(ao.A.Meta,{className:Z()((0,f.A)({},Uo.small,e.widthPx<170)),title:e.category,description:g.createElement(se.A,{vertical:!0,justify:"space-between"},g.createElement(se.A,{vertical:!0},g.createElement("span",null,e.cellID),g.createElement("span",{style:{minHeight:"1.5em"}},e.mitoticStage&&g.createElement("span",{className:Uo.stage},e.mitoticStage))),!e.empty&&g.createElement("div",{className:Uo.actionList},o))})))};var zo=n(81427);const Go=function(e){var t=Ro(e.src,e.fileInfo);return g.createElement(xo.A.Item,{key:e.cellID,className:"style__container--O2RRk",id:e.cellID?e.cellID.toString():"",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},g.createElement(xo.A.Item.Meta,{avatar:g.createElement("div",{onClick:function(){e.handleOpenIn3D({id:e.cellID})}},g.createElement(zo.A,{className:Z()((0,f.A)({},"style__selected--H5lki",e.selected),"style__avatar--ymR_r"),alt:"thumbnail of microscopy image",src:t,icon:g.createElement(Io.A,{className:"style__placeholder-avatar--VUJ4u"})}))}))};var Lo=n(1575);const Ho=function(e){var t=e.setWidth,n=e.currentWidth;return g.createElement("div",{className:"gallery-card-slider"},g.createElement(se.A,{justify:"space-between",align:"center"},g.createElement("label",{style:{color:"#BFBFBF"}},"Size:"),g.createElement(Lo.A,{style:{width:100},min:106,max:256,value:n,onChange:t,tooltip:{open:!1}})))};var Ko=(0,Pn.Mz)([xn,yr],function(e,t){return(0,he.find)(e,{album_id:t})}),Wo=(0,Pn.Mz)([Ko],function(e){return e?e.title:"My Selections"}),qo=(0,Pn.Mz)([Ko,ar,wr],function(e,t,n){return e?n:t}),Xo=(0,Pn.Mz)([Pr,On,Hn,qo,Cr,br,Ln],function(e,t,n,r,a,o,l){if((0,he.isEmpty)(t.labels)||!r.length)return[];var i=t.values[e.key];return(0,he.map)(r,function(r){var c,s=r[x];if((c=void 0!==r.index&&r.index>0?r.index:t.labels[D].indexOf(s))<0)return{};var u="";if(!(0,he.isEmpty)(l)&&n.length){var d=n[c]||-1;u=l[d]?l[d].name:""}var f="";r[N]&&(f=Ee(a,Ce(s)));var p=r[_],m="";r[T]&&(m=Ee(a,we(p)));var h=Se(o,r.thumbnailPath),y=i[c];return{cellID:s,downloadHref:f,fullFieldDownloadHref:m,category:ke(e,y?y.toString():""),mitoticStage:u,src:h,fileInfo:r}})});const Yo="style__container--wvA9t",Zo="style__gallery-header--gOeo8";function Qo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Jo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Jo=function(){return!!e})()}var $o=pe.A.Search,el={inputStatus:void 0,message:"",thumbnailSize:128},tl={error:"That id is not in our dataset.",success:el.message,warning:"That cell is already in the gallery."},nl=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,Jo()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"endOfAlbum",void 0),n.renderGalleryCard=n.renderGalleryCard.bind(n),n.renderMinGalleryCard=n.renderMinGalleryCard.bind(n),n.searchValidate=n.searchValidate.bind(n),n.resetSearch=n.resetSearch.bind(n),n.hoverCard=n.hoverCard.bind(n),n.unHover=n.unHover.bind(n),n.renderCollapsedView=n.renderCollapsedView.bind(n),n.renderFullView=n.renderFullView.bind(n),n.selectAlbum=n.selectAlbum.bind(n),n.closeGallery=n.closeGallery.bind(n),n.selectCell=n.selectCell.bind(n),n.endOfAlbum=g.createRef(),n.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qo(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},el),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"componentDidMount",value:function(){(0,this.props.getAlbumData)()}},{key:"componentDidUpdate",value:function(e){var t=this.endOfAlbum,n=this.props.clickedPoints;t.current&&e.clickedPoints.length!==n.length&&t.current.scrollIntoView({behavior:"smooth"})}},{key:"searchValidate",value:function(e){var t=this.props,n=t.clickedPoints,r=t.ids,a=t.addSearchedCell;return(0,he.includes)((0,he.map)(n,function(e){return e.toString()}),e)?this.setState({inputStatus:"warning",message:tl.warning}):(0,he.includes)(r,e)?(a({id:e}),this.setState({inputStatus:"success",message:tl.success})):void this.setState({inputStatus:"error",message:tl.error})}},{key:"resetSearch",value:function(){this.setState({inputStatus:el.inputStatus,message:el.message})}},{key:"selectAlbum",value:function(e){var t=e.target,n=this.props.handleSelectAlbum;t&&n(t.value)}},{key:"renderAlbumButtons",value:function(){var e=this.props,t=e.albumData,n=e.selectedAlbum,r=e.clickedPoints;return g.createElement(Po.A,{layout:"vertical",colon:!0},g.createElement(Po.A.Item,{label:"ALBUMS"},g.createElement(ue.Ay.Group,{defaultValue:n,onChange:this.selectAlbum,size:"large"},g.createElement(ue.Ay.Button,{key:"my-selections",value:0},"My Selections (".concat(r.length,")")),(0,he.map)(t,function(e){if(e.cell_ids)return e.cell_ids.length>0&&g.createElement(ue.Ay.Button,{key:e.album_id,value:e.album_id},e.title," (",e.cell_ids.length,")")}))))}},{key:"closeGallery",value:function(){(0,this.props.toggleGallery)(!0)}},{key:"selectCell",value:function(e){var t=this.props.handleOpenIn3D;return this.closeGallery(),this.props.openViewerTab(),t(e)}},{key:"renderFullView",value:function(){var e=this,t=this.props,n=t.data,r=t.handleClearAllSelectedPoints,a=t.selectedAlbum,o=t.selectedAlbumName,l=n.length>0?n:[{empty:!0}];return g.createElement(Q.A,{id:"gallery",className:Yo,gutter:32,justify:"space-between"},g.createElement("div",{className:"style__gallery-grid--gvldu"},g.createElement("div",{className:Zo},g.createElement("h2",null,o),g.createElement(Ho,{setWidth:function(t){return e.setState({thumbnailSize:t})},currentWidth:this.state.thumbnailSize}),n.length>0&&!a&&g.createElement(Oo.A,{title:"Are you sure you want to unselect all?",onConfirm:r,okText:"Yes",cancelText:"No"},g.createElement(ie.Ay,null,g.createElement(ko.A,null)," Clear All"))),g.createElement(xo.A,{itemLayout:"horizontal",grid:{gutter:16},className:"style__list--T_xfO",dataSource:l,renderItem:this.renderGalleryCard,footer:g.createElement("div",{ref:this.endOfAlbum})})),g.createElement("div",{className:"style__album-side-bar--kzFBa"},g.createElement("div",{className:"style__side-bar-header--LJXyh"},g.createElement("h2",null,"Thumbnail Gallery"),g.createElement(ie.Ay,{type:"text",onClick:this.closeGallery,style:{padding:0}},g.createElement(ko.A,{style:{fontSize:"2em"}}))),g.createElement(Po.A.Item,{hasFeedback:!0,className:"style__search-for-cell--IdZGM",validateStatus:this.state.inputStatus,help:this.state.message},g.createElement($o,{placeholder:"add image by cell id",onSearch:this.searchValidate,onChange:this.resetSearch})),this.renderAlbumButtons()))}},{key:"renderCollapsedView",value:function(){var e=this.props.data,t=e.length>0?e:[{empty:!0}];return g.createElement("div",{id:"gallery",className:Yo},g.createElement("div",{className:Zo},g.createElement("h2",null,"Gallery")),g.createElement(xo.A,{itemLayout:"horizontal",dataSource:t,renderItem:this.renderMinGalleryCard,footer:g.createElement("div",{ref:this.endOfAlbum})}))}},{key:"render",value:function(){var e=this.props.collapsed;return g.createElement(X.Ay,{theme:{components:{Radio:{colorPrimary:"#fffffa",colorPrimaryActive:"#fffc",colorPrimaryHover:"#fff"}}}},e?this.renderCollapsedView():this.renderFullView())}},{key:"hoverCard",value:function(e){var t=e.currentTarget,n=this.props.setHovered;if(t.id)return n(t.id);n(null)}},{key:"unHover",value:function(){(0,this.props.setHovered)(null)}},{key:"renderMinGalleryCard",value:function(e){var t=this.props,n=t.handleDeselectPoint,r=t.selectedCell,a=r?r.toString():"";return g.createElement(Go,{onMouseEnter:this.hoverCard,onMouseLeave:this.unHover,category:e.category,src:e.src,selected:a===e.cellID,downloadHref:e.downloadHref,cellID:e.cellID,fileInfo:e.fileInfo,handleDeselectPoint:n,handleOpenIn3D:this.selectCell,empty:e.empty})}},{key:"renderGalleryCard",value:function(e){var t=this.props,n=t.handleDeselectPoint,r=t.selectedCell||"";return g.createElement(Vo,{onMouseEnter:this.hoverCard,onMouseLeave:this.unHover,category:e.category,mitoticStage:e.mitoticStage,src:e.src,selected:r===e.cellID,downloadHref:e.downloadHref,downloadFullField:e.fullFieldDownloadHref,cellID:e.cellID,fileInfo:e.fileInfo,handleDeselectPoint:n,handleOpenIn3D:this.selectCell,empty:e.empty,widthPx:this.state.thumbnailSize})}}])}(g.Component),rl={addSearchedCell:ut,getAlbumData:An,handleClearAllSelectedPoints:dt,handleDeselectPoint:st,handleOpenIn3D:pt,handleSelectAlbum:At,setHovered:bt};const al=(0,b.Ng)(function(e){return{albumData:xn(e),clickedPoints:Hr(e),data:Xo(e),ids:Gr(e),selectedAlbum:yr(e),selectedAlbumName:Wo(e),selectedCell:ur(e)}},rl)(nl);var ol=n(30696),ll=n(90116);const il={"plot-by-on-x":"style__plot-by-on-x--hPBYK",plotByOnX:"style__plot-by-on-x--hPBYK","plot-by-on-y":"style__plot-by-on-y--AZkRk",plotByOnY:"style__plot-by-on-y--AZkRk"};function cl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(cl=function(){return!!e})()}var sl=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,cl()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).handleChange=n.handleChange.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"handleChange",value:function(e){var t=e;this.props.onChange(t)}},{key:"render",value:function(){var e,t=this.props,n=t.classKey,r=void 0===n?"":n,a=t.value,o=t.options,l=t.tooltip,i=o.map(function(e){return{label:"".concat(e.displayName," ").concat(e.unit?"(".concat(e.unit,")"):""),key:e.key,value:e.key,tooltip:e.tooltip}}),c=null===(e=i.find(function(e){return e&&e.key===a}))||void 0===e||null===(e=e.label)||void 0===e?void 0:e.toString();return g.createElement("div",{className:il[r]},g.createElement(Fo.A,{title:l},g.createElement(ll.A,{onChange:this.handleChange,value:c||a,options:i})))}}])}(g.Component),ul=n(52120),dl=n(26067);function fl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fl(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fl(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ml(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ml=function(){return!!e})()}var hl="alreadyDownloaded",yl=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,ml()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"popupContainerRef",void 0),n.onClose=n.onClose.bind(n),n.onDownload=n.onDownload.bind(n),n.saveDownloadUrl=n.saveDownloadUrl.bind(n),n.handleMenuClick=n.handleMenuClick.bind(n),n.handleDownloadMenuVisibleChange=n.handleDownloadMenuVisibleChange.bind(n),n.state={alreadyDownloaded:localStorage.getItem(hl)?JSON.parse(localStorage.getItem(hl)):{},downloadMenuVisible:!1},n.popupContainerRef=g.createRef(),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onClose",value:function(e){var t=e.currentTarget,n=this.props.handleClose;t&&t.id&&n&&n(t.id)}},{key:"onDownload",value:function(e){var t=e.currentTarget,n=this.props.handleDownload;t&&t.id&&n&&n(t.id)}},{key:"saveDownloadUrl",value:function(e){var t=this.props.downloadConfig,n=this.state.alreadyDownloaded,r=n[t.key];r?this.setState({alreadyDownloaded:pl(pl({},n),{},(0,f.A)({},t.key,(0,he.uniq)([].concat((0,It.A)(r),[e.key]))))}):this.setState({alreadyDownloaded:pl(pl({},n),{},(0,f.A)({},t.key,[e.key]))})}},{key:"handleDownloadMenuVisibleChange",value:function(e){localStorage.setItem(hl,JSON.stringify(this.state.alreadyDownloaded)),this.setState({downloadMenuVisible:!!e})}},{key:"handleMenuClick",value:function(){var e=this.props,t=e.downloadUrls,n=e.downloadConfig,r=this.state.alreadyDownloaded[n.key];r&&r.length===t.length&&this.setState({downloadMenuVisible:!1})}},{key:"render",value:function(){var e=this,t=this.props,n=t.id,r=t.downloadUrls,a=t.downloadConfig,o=t.downloadRoot,l=this.state.alreadyDownloaded[a.key],i={items:r.map(function(t,n){return{key:n,onClick:e.saveDownloadUrl,label:g.createElement(g.Fragment,null,(0,he.includes)(l,n.toString())?g.createElement(dl.A,null):g.createElement(_o.A,null),g.createElement("a",{href:t}," data chunk ",n+1," "))}}),onClick:this.handleMenuClick},c=""===o;return g.createElement("div",{className:"style__container--AElaZ",ref:this.popupContainerRef},g.createElement(Fo.A,{title:c?V:null},g.createElement(To.A,{menu:i,trigger:["click"],onOpenChange:this.handleDownloadMenuVisibleChange,open:this.state.downloadMenuVisible,placement:"bottomRight",autoAdjustOverflow:!1,getPopupContainer:function(){return e.popupContainerRef.current||document.body}},g.createElement(ie.Ay,{size:"small",className:c?"style__disabled-download--WYcUx":"ant-dropdown-link",id:n,onClick:c?void 0:this.onDownload,disabled:c},g.createElement(_o.A,null)))))}}])}(g.Component);(0,f.A)(yl,"defaultProps",{closeable:!1,downloadUrls:[],hideable:!0});function gl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(gl=function(){return!!e})()}var vl=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,gl()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).onClose=n.onClose.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onClose",value:function(e){var t=e.currentTarget,n=this.props.handleClose;t&&t.id&&n&&n(t.id)}},{key:"render",value:function(){var e=this.props,t=e.closeable,n=e.hideable,r=e.showTooltips,a=e.disabled,o=e.id,l=e.color,i=e.name,c=e.total,s=e.onBarClicked,u=e.checked,d=e.downloadUrls,f=e.downloadConfig,p=e.downloadRoot,m=e.handleDownload,h=g.createElement("div",null,o||"(missing data for this feature)"),y=a?"style__label-disabled--_3phL":"style__label--HnODt";return g.createElement("div",{className:"style__container--r1icz"},g.createElement("div",{className:"style__first-column--qxIuw"},n&&g.createElement(So.A,{onChange:s,value:o,defaultChecked:!0,checked:u,disabled:a}),g.createElement(ul.A,{style:{backgroundColor:l,padding:4},dot:!0}),r?g.createElement(Fo.A,{placement:"right",title:h},g.createElement("span",{className:y},i)):g.createElement("span",{className:y},i)),g.createElement("div",null,g.createElement("span",{className:y},c),g.createElement(yl,{color:l,id:o,name:i,total:c,downloadConfig:f,downloadUrls:d,downloadRoot:p,handleDownload:m}),t&&g.createElement(ie.Ay,{size:"small",id:o,onClick:this.onClose},g.createElement(ko.A,null))))}}])}(g.Component);(0,f.A)(vl,"defaultProps",{closeable:!1,downloadUrls:[],hideable:!0});const bl=function(e){var t=e.showTooltips,n=e.closeable,r=e.downloadUrls,a=e.handleCloseSelectionSet,o=e.handleDownload,l=e.downloadConfig,i=e.downloadRoot,c=e.hideable,s=e.onBarClicked,u=e.panelData;return g.createElement(g.Fragment,null,(0,he.map)(u,function(e){return g.createElement(vl,{key:e.id,showTooltips:t,closeable:n,checked:e.checked,hideable:c,disabled:e.disabled||!1,color:e.color,name:e.name,total:e.total,id:e.id,onBarClicked:s,handleClose:a,handleDownload:o,downloadUrls:r,downloadConfig:l,downloadRoot:i})}))};var Al=n(12609);const wl="style__color-by-switch--f9FIL",Cl="style__color-by-row--YXw6H",El="style__label--UPyKE",Sl=function(e){return e.includeCol?g.createElement(Q.A,{className:Cl,align:"middle"},g.createElement(to.A,{span:e.includeCol},g.createElement("label",{className:El},"Color by:"),g.createElement(Al.A,{className:wl,defaultChecked:e.defaultChecked,checkedChildren:e.checkedChildren,unCheckedChildren:e.unCheckedChildren,onChange:e.handleChange})),e.children):g.createElement(Q.A,{className:Cl,align:"middle"},g.createElement("label",{className:El},e.label),g.createElement(Al.A,{className:wl,defaultChecked:e.defaultChecked,onChange:e.handleChange}))},Dl="style__label--TpoXl";function kl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(kl=function(){return!!e})()}var Pl=function(e){function t(e){return(0,p.A)(this,t),n=this,r=t,a=[e],r=(0,H.A)(r),(0,L.A)(n,kl()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a));var n,r,a}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=e.name,r=e.total;return g.createElement("div",{className:"style__container--f9hih"},g.createElement("div",{className:"style__first-column--PD1I1"},g.createElement(ul.A,{style:{backgroundColor:t,padding:4},dot:!0}),g.createElement("span",{className:Dl},n)),g.createElement("div",null,g.createElement("span",{className:Dl},r)))}}])}(g.Component),Ol=function(e){return e.CONTINUOUS="continuous",e.GROUPED="grouped",e}({}),xl=(0,Pn.Mz)([Nr,Br,Tr],function(e,t,n){for(var r=new Set,a=0;a<e.length;a++)null!==e[a]&&null!==t[a]&&r.add(n[a]);return(0,It.A)(r)}),_l=(0,Pn.Mz)([Pr],function(e){return e.displayName}),Il=(0,Pn.Mz)([sr,xr],function(e,t){return e.length>0&&e.length!==t.length}),Tl=(0,Pn.Mz)([_r,rr,lr],function(e,t,n){return n===t?[]:e}),Fl=(0,Pn.Mz)([rr,lr,Or,sr,xl,Tr],function(e,t,n,r,a,o){var l=(0,he.reduce)(o,function(e,t){return e[t]=(e[t]||0)+1,e},{});l[""]>0&&n.push({color:nt,name:rt,key:""});var i,c,s,u,d=(i=n,c=(0,he.map)(i,function(e){return e.name}),s=(0,he.map)(i,function(e){return e.key||""}),u=c.filter(function(e,t){return c.indexOf(e)!==t}),c.map(function(e,t){return u.includes(e)?"".concat(e," (").concat(s[t],")"):e}));return(0,he.map)(n,function(n,o){var i,c,s,u,f,p=null!==(i=n.key)&&void 0!==i?i:n.name,m=l[p]||n.count||0,h=!a.includes(p),y=(c=t===e,s=(0,he.includes)(r,p),u=h,f=n.color,u?R:s?"#000":c?f:R);return{checked:!(0,he.includes)(r,p),color:y,id:p,name:d[o],disabled:h,total:m}})}),Nl=(0,Pn.Mz)([dr,cr,Zr,Qr],function(e,t,n,r){return(0,he.map)(n,function(n,a){var o=e?(0,he.values)(t)[a]:R,l=Number(n)?a:n;return{color:o,id:n.toString(),name:l.toString(),total:r[a]}})}),Bl=(0,Pn.Mz)([Vn,Tr,fr,or],function(e,t,n,r){var a=[];return n.type===B?(0,he.reduce)(t,function(t,r,a){return r===n.key&&t.push(Ce(e.cellIds[a])),t},a):n.type===j?r[n.key].map(function(e){return Ce(e.cellId)}):a}),jl=(0,Pn.Mz)([Cr,Bl],function(e,t){if(""===e)return[];var n=(0,he.chunk)(t,300);return(0,he.map)(n,function(t){return"".concat(e).concat((0,he.map)(t,function(e){return"&id=".concat(e)}).join(""))})});function Ml(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Rl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ul(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rl(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rl(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Vl=(0,Pn.Mz)([Mr],function(e){var t=e.labels.thumbnailPaths,n=e.labels.sourcePaths,r=e.indices;return(0,he.map)(r,function(e,r){return{index:e,thumbnailPath:t[r],srcPath:null==n?void 0:n[r]}})}),zl=(0,Pn.Mz)([Vr,zr,Gr,Vl,Lr,lr,rr,_r,Gn],function(e,t,n,r,a,o,l,i,c){var s=function(e,t){var n=!1,r=e.slice(),a=t.slice();if(r.length!==a.length)return console.error("Cannot handleNullValues between two arrays because they have unequal length"),{xValues:r,yValues:a};for(var o=0;o<r.length;o++)null===r[o]?a[o]=null:null===a[o]?r[o]=null:n=!0;return n||(r=[],a=[]),{xValues:r,yValues:a}}(e,t);return(0,he.includes)(c,o)?{color:o===l?void 0:a,dataType:Ol.GROUPED,groupSettings:i,groups:a,ids:n,x:s.xValues,y:s.yValues,customdata:r}:{color:o===l?void 0:a,dataType:Ol.CONTINUOUS,ids:n,x:s.xValues,y:s.yValues,customdata:r}}),Gl=(0,Pn.Mz)([Mr,ar,tr,nr,hr],function(e,t,n,r,a){return(0,he.isEmpty)(e.values)||(0,he.isEmpty)(e.labels)?[]:t.reduce(function(t,o){var l=o[x],i=o[_]||"",c=o[F]||"",s=e.labels[D],u=void 0!==o.index?o.index:(0,he.findIndex)(s,function(e){return e===l}),d=e.values[n][u],f=e.values[r][u];return u>=0&&null!==d&&null!==f&&t.push({cellID:l,fovID:i,hovered:l===a,pointIndex:u,x:d,y:f,thumbnailPath:c}),t},[])}),Ll=(0,Pn.Mz)([zl,dr,Yr],function(e,t,n){var r=Ul(Ul({},e),{},{plotName:k});return e.dataType===Ol.GROUPED&&r.dataType===Ol.GROUPED&&(r.groupSettings=Ul({},e.groupSettings)),{mainPlotData:r,selectedGroupPlotData:t?Ul(Ul({},n),{},{dataType:"continuous",plotName:"selections-scatter-plot"}):null}});function Hl(e){return function(e,t){return t.dataType===Ol.GROUPED?Ul(Ul({},e),{},{transforms:[{groups:t.groups,nameformat:"%{group}",styles:(0,he.map)(t.groupSettings,function(e){return{target:e.name,value:{marker:{color:e.color,opacity:U.unselectedCircleOpacity}}}}),type:"groupby"}]}):Ul(Ul({},e),{},{marker:Ul(Ul({},e.marker),{},{color:t.color,opacity:t.opacity||U.unselectedCircleOpacity})})}({hoverinfo:"none",ids:e.ids,customdata:e.customdata,marker:{size:U.circleRadius,symbol:"circle"},mode:"markers",name:e.plotName,showlegend:!1,type:"scattergl",x:e.x,y:e.y,z:[]},e)}function Kl(e){return{marker:{color:U.histogramColor,line:{color:U.textColor,width:1}},name:"x histogram",nbinsx:60,showlegend:!1,type:"histogram",x:e,yaxis:"y2"}}function Wl(e){return{marker:{color:U.histogramColor,line:{color:U.textColor,width:1}},name:"y histogram",nbinsy:60,showlegend:!1,type:"histogram",xaxis:"x2",y:e}}var ql=(0,Pn.Mz)([Ll],function(e){var t=e.mainPlotData,n=e.selectedGroupPlotData,r=[Kl(t.x),Wl(t.y),Hl(t)];return n&&r.push(Hl(n)),r}),Xl=(0,Pn.Mz)([Nn],function(e){return e}),Yl=(0,Pn.Mz)([Nn],function(e){return e}),Zl=(0,Pn.Mz)([Nn,_l],function(e){return e}),Ql=(0,Pn.Mz)([Nn,_l],function(e){return e.filter(function(e){return e.discrete})}),Jl=function(e){return{tickText:(0,he.map)(e,"name"),tickValues:(0,he.map)(e,function(e,t){return Number(t)})}},$l=(0,Pn.Mz)([tr,Nn],function(e,t){var n=De(t,e);return n&&n.discrete?Jl(n.options):{tickText:[""],tickValues:[0]}}),ei=(0,Pn.Mz)([nr,Nn],function(e,t){var n=(0,he.find)(t,{key:e});return n&&n.discrete?Jl(n.options):{tickText:[""],tickValues:[0]}}),ti=(0,Pn.Mz)([mr,Tr],function(e,t){return e&&t.length&&void 0!==e.index?Ul(Ul({},e),{},(0,f.A)({},O,t[e.index])):e}),ni=function(e){var t,n,r,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ml(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ml(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;null!=o&&((void 0===t||o<t)&&(t=o),(void 0===n||o>n)&&(n=o))}}catch(e){a.e(e)}finally{a.f()}if(void 0!==t&&void 0!==n)return[t,n]},ri=(0,Pn.Mz)([Nr],function(e){return ni(e)}),ai=(0,Pn.Mz)([Br],function(e){return ni(e)});const oi={"feature-select-row":"style__feature-select-row--eh5Bh",featureSelectRow:"style__feature-select-row--eh5Bh",collapse:"style__collapse--wx7CK","interactive-legend-container":"style__interactive-legend-container--gmX26",interactiveLegendContainer:"style__interactive-legend-container--gmX26","interactive-legend-header":"style__interactive-legend-header--pn9jS",interactiveLegendHeader:"style__interactive-legend-header--pn9jS"};function li(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(li=function(){return!!e})()}var ii=ol.A.Panel,ci=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,li()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).onBarClicked=n.onBarClicked.bind(n),n.onActivePanelChange=n.onActivePanelChange.bind(n),n.renderTaggedStructuresPanel=n.renderTaggedStructuresPanel.bind(n),n.renderSelectionPanel=n.renderSelectionPanel.bind(n),n.allOnOff=n.allOnOff.bind(n),n.onCategorySetDownloadButtonClicked=n.onCategorySetDownloadButtonClicked.bind(n),n.onSelectionSetDownloadButtonClicked=n.onSelectionSetDownloadButtonClicked.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onBarClicked",value:function(e){var t=e.target,n=this.props,r=n.handleFilterByCategoryName,a=n.filtersToExclude;r((0,he.includes)(a,t.value)?(0,he.filter)(a,function(e){return e!==t.value}):[].concat((0,It.A)(a),[t.value]))}},{key:"onCategorySetDownloadButtonClicked",value:function(e){(0,this.props.handleChangeDownloadSettings)({key:e,type:B})}},{key:"onSelectionSetDownloadButtonClicked",value:function(e){(0,this.props.handleChangeDownloadSettings)({key:e,type:j})}},{key:"allOnOff",value:function(e){var t=e.target,n=this.props,r=n.handleFilterByCategoryName,a=n.interactivePanelData;if(t.checked)return r([]);r(a.map(function(e){return e.id}))}},{key:"onActivePanelChange",value:function(e){(0,this.props.onPanelClicked)(e)}},{key:"renderSelectionPanel",value:function(){var e=this.props,t=e.downloadUrls,n=e.downloadConfig,r=e.downloadRoot,a=e.handleApplyColorSwitchChange,o=e.selectionSetsPanelData,l=e.handleCloseSelectionSet;return 0===o.length?g.createElement("span",null,"No selected sets yet. Make a selection on the plot using the",g.createElement("strong",null," Lasso Select")," or",g.createElement("strong",null," Box Select")," tools on the plot, and it will get saved here."):g.createElement(g.Fragment,null,g.createElement(Sl,{defaultChecked:!0,handleChange:a,label:"Show selections: "}),g.createElement("div",null,g.createElement(bl,{closeable:!0,hideable:!1,showTooltips:!1,handleCloseSelectionSet:l,panelData:o,downloadUrls:t,downloadConfig:n,downloadRoot:r,handleDownload:this.onSelectionSetDownloadButtonClicked})))}},{key:"renderTaggedStructuresPanel",value:function(){var e=this.props,t=e.filtersToExclude,n=e.isInIndeterminateState,r=e.interactivePanelData,a=e.downloadUrls,o=e.downloadConfig,l=e.downloadRoot,i=e.colorBy,c=e.groupBy,s=e.colorByMenuOptions,u=e.groupByDisplayOptions,d=e.handleChangeAxis,f=e.handleChangeGroupByCategory,p=e.colorForPlot,m=e.categoryCounts,h=e.categoricalFeatures,y=(0,he.includes)(h,i)&&i!==c;return g.createElement(g.Fragment,null,g.createElement(Q.A,{className:oi.featureSelectRow},g.createElement(to.A,{span:4},"Color by:"),g.createElement(to.A,{span:20},g.createElement(sl,{value:i.toString(),options:s,onChange:function(e){d(P,e)},tooltip:Ir(i.toString(),s)}))),g.createElement(Q.A,{className:oi.featureSelectRow},g.createElement(to.A,{span:4},"Group by:"),g.createElement(to.A,{span:20},g.createElement(sl,{value:c.toString(),options:u,onChange:function(e){f(e)},tooltip:Ir(c.toString(),u)}))),g.createElement("div",{className:oi.interactiveLegendContainer},g.createElement("div",null,g.createElement("div",{className:oi.interactiveLegendHeader},g.createElement(So.A,{indeterminate:n,checked:0===t.length,onChange:this.allOnOff},"Show/Hide all"),g.createElement("span",{className:oi.label},"# of cells")),g.createElement(bl,{closeable:!1,showTooltips:!0,panelData:r,downloadUrls:a,downloadConfig:o,downloadRoot:l,hideable:!0,onBarClicked:this.onBarClicked,handleDownload:this.onCategorySetDownloadButtonClicked})),y&&g.createElement(Q.A,{className:oi.featureSelectRow},g.createElement("div",{className:oi.interactiveLegendHeader},g.createElement("div",null," Color legend "),g.createElement("span",{className:oi.label},"# of cells")),p.map(function(e,t){return g.createElement(Pl,{color:e.color,name:e.label,key:e.name,total:m[t]})}))))}},{key:"render",value:function(){var e=this.props,t=e.defaultActiveKey,n=e.openKeys,r=e.panelKeys;return g.createElement(ol.A,{className:oi.collapse,defaultActiveKey:t,activeKey:n,onChange:this.onActivePanelChange},g.createElement(ii,{key:r[0],header:"Plot configuration"},this.renderTaggedStructuresPanel()),g.createElement(ii,{key:r[1],header:"Selected sets"},this.renderSelectionPanel()))}}])}(g.Component),si={handleApplyColorSwitchChange:Jr.actions.toggleApplySelectionSetColors,handleChangeAxis:Jr.actions.changeAxis,handleChangeGroupByCategory:Jr.actions.changeGroupByCategory,handleChangeDownloadSettings:Jr.actions.changeDownloadSettings,handleCloseSelectionSet:Jr.actions.deselectGroupOfPoints,handleFilterByCategoryName:Jr.actions.toggleFilterByCategoryName};const ui=(0,b.Ng)(function(e){return{categoryCounts:Jr.selectors.getColorByCategoryCounts(e),colorBy:Jr.selectors.getColorBySelection(e),groupBy:Jr.selectors.getGroupByCategory(e),colorByMenuOptions:Zl(e),groupByDisplayOptions:Ql(e),colorForPlot:Tl(e),categoricalFeatures:eo.selectors.getCategoricalFeatureKeys(e),downloadConfig:Jr.selectors.getDownloadConfig(e),downloadUrls:jl(e),downloadRoot:Cr(e),filtersToExclude:Jr.selectors.getFiltersToExclude(e),groupByTitle:_l(e),interactivePanelData:Fl(e),selectionSetsPanelData:Nl(e),isInIndeterminateState:Il(e)}},si)(ci);var di=n(28073),fi=n(29248),pi=n(91236);function mi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function hi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mi(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function yi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(yi=function(){return!!e})()}var gi={color:U.textColor,domain:[.86,1],hoverformat:"f",linecolor:U.textColor,showgrid:!1,tickcolor:U.textColor,zeroline:!0};function vi(e){var t=.05*(e[1]-e[0]);return[e[0]-t,e[1]+t]}var bi=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),(n=(0,L.A)(r,yi()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o))).makeAnnotations=n.makeAnnotations.bind(n),n.clickedAnnotation=n.clickedAnnotation.bind(n),n.resize=n.resize.bind(n),n.state={layout:{annotations:n.makeAnnotations(),autosize:!0,height:window.innerHeight-U.heightMargin,hovermode:"closest",legend:U.legend,margin:U.margin,paper_bgcolor:U.backgroundColor,plot_bgcolor:U.backgroundColor,xaxis:n.makeAxis([0,.85],".1f",!1,e.xAxisType,e.xTickConversion,e.xAxisRange),xaxis2:gi,yaxis:n.makeAxis([0,.85],".1f",!1,e.yAxisType,e.yTickConversion,e.yAxisRange),yaxis2:gi},height:window.innerHeight,showFullAnnotation:!0},n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"componentDidUpdate",value:function(e,t){var n=this.props,r=n.xAxisType,a=n.yAxisType,o=n.xTickConversion,l=n.yTickConversion,i=n.xAxisRange,c=n.yAxisRange;o===e.xTickConversion&&l===e.yTickConversion&&i===e.xAxisRange&&c===e.yAxisRange||this.setState({layout:hi(hi({},this.state.layout),{},{annotations:this.makeAnnotations(),xaxis:this.makeAxis([0,.85],".1f",!1,r,o,i?vi(i):void 0),yaxis:this.makeAxis([0,.85],".1f",!1,a,l,c?vi(c):void 0)})}),this.state.height!==t.height&&this.setState({layout:hi(hi({},this.state.layout),{},{height:this.state.height-U.heightMargin})})}},{key:"resize",value:function(){this.setState(function(){return{height:window.innerHeight}})}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"clickedAnnotation",value:function(){this.setState({showFullAnnotation:!1})}},{key:"makeAxis",value:function(e,t,n,r,a,o){return{color:U.textColor,domain:e,hoverformat:t,linecolor:U.textColor,showgrid:!1,tickcolor:U.textColor,tickmode:r,ticktext:a.tickText,tickvals:a.tickValues,zeroline:n,range:o}}},{key:"makeAnnotations",value:function(){var e=this,t=this.props.annotations,n=function(e,t){return t?"Cell ".concat(e.cellID,"<br><i>click thumbnail in gallery<br>on the right to load in 3D</i>"):e.hovered?"Cell ".concat(e.cellID):""};return t.map(function(r,a){var o=a+1===t.length&&e.state.showFullAnnotation,l=!!o||!!r.hovered;return{align:"left",arrowcolor:r.hovered?"#7440f1":"#ffffffab",arrowhead:6,ax:0,ay:o?-60:r.hovered?-20:0,bgcolor:"#00000094",bordercolor:r.hovered?"#7440f1":"#ffffffab",borderpad:l?4:0,borderwidth:1,captureevents:!0,cellID:r.cellID,font:{color:"#ffffff",family:"tahoma, arial, verdana, sans-serif",size:11},fovID:r.fovID,pointIndex:r.pointIndex,text:n(r,o),x:r.x,y:r.y}})}},{key:"render",value:function(){var e=this.props,t=e.onPointClicked,n=e.onPointHovered,r=e.onPointUnhovered,a=e.onGroupSelected,o=e.plotDataArray;return g.createElement(pi.A,{data:o,useResizeHandler:!0,layout:this.state.layout,config:{responsive:!0,displayModeBar:!0,displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud","toImage","resetScale2d","hoverClosestCartesian","hoverCompareCartesian","toggleSpikelines"]},onClick:t,onClickAnnotation:this.clickedAnnotation,onHover:n,onUnhover:r,onSelected:a})}}])}(g.Component),Ai=g.forwardRef(function(e,t){return g.createElement("div",{ref:t,style:{left:"".concat(e.pageX+10,"px"),top:"".concat(e.pageY,"px"),position:"absolute"}},e.children)});Ai.displayName="MouseFollower";const wi=Ai;var Ci=ao.A.Meta;const Ei=function(e){var t=e.src?g.createElement("img",{alt:"thumbnail of microscopy image",src:e.src}):g.createElement("div",{className:"style__placeholder-container--ofudX"},g.createElement(Io.A,null));return g.createElement(ao.A,{className:"style__container--GYGx9",cover:t},g.createElement(Ci,{description:e.description,title:e.title}))};function Si(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Si=function(){return!!e})()}var Di=function(e){function t(e){var n,r,a,o;return(0,p.A)(this,t),r=this,a=t,o=[e],a=(0,H.A)(a),n=(0,L.A)(r,Si()?Reflect.construct(a,o||[],(0,H.A)(r).constructor):a.apply(r,o)),(0,f.A)(n,"popoverContainer",void 0),(0,f.A)(n,"thumbnailTimeout",0),n.popoverContainer=g.createRef(),n.state={cellIdToZarrThumbnailUrl:new Map},n.onPointClicked=n.onPointClicked.bind(n),n.onPointHovered=n.onPointHovered.bind(n),n.onPointUnhovered=n.onPointUnhovered.bind(n),n.onGroupSelected=n.onGroupSelected.bind(n),n.onPlotUnhovered=n.onPlotUnhovered.bind(n),n.renderPopover=n.renderPopover.bind(n),n}return(0,K.A)(t,e),(0,m.A)(t,[{key:"onPointClicked",value:function(e){var t=e.points,n=this.props,r=n.clickedPoints,a=n.handleSelectPoint,o=n.handleDeselectPoint;t.forEach(function(e){e.data.name===k&&((0,he.includes)(r,e.id)?o(e.id):e.fullData.marker.opacity&&a({id:e.id,index:e.customdata.index}))})}},{key:"updateThumbnails",value:function(e,t){this.setState(function(n){var r=n.cellIdToZarrThumbnailUrl;r.delete(e);var a=[[e,t]].concat((0,It.A)(Array.from(r.entries()))).slice(0,250);return{cellIdToZarrThumbnailUrl:new Map(a)}})}},{key:"loadThumbnailForZarr",value:(n=(0,ne.A)(oe().mark(function e(t,n){var r,a;return oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.cellIdToZarrThumbnailUrl.has(t)){e.next=1;break}return e.abrupt("return");case 1:if(null!==this.state.cellIdToZarrThumbnailUrl.get(t)){e.next=2;break}return e.abrupt("return");case 2:if(this.updateThumbnails(t,null),!n||!n.endsWith(".zarr")){e.next=6;break}return e.prev=3,e.next=4,jo(n);case 4:r=e.sent,this.updateThumbnails(t,r),e.next=6;break;case 5:e.prev=5,a=e.catch(3),console.error("Error generating thumbnail for Zarr:",a);case 6:case"end":return e.stop()}},e,this,[[3,5]])})),function(e,t){return n.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.state.cellIdToZarrThumbnailUrl.clear()}},{key:"onPointHovered",value:function(e){var t=this,n=e.points,r=e.event,a=this.props,o=a.filtersToExclude,l=a.updateMousePosition,i=a.changeHoveredPoint;l({pageX:r.pageX,pageY:r.pageY}),n.forEach(function(e){e.data.name!==k||(0,he.includes)(o,e.fullData.name)?i(null):(window.clearTimeout(t.thumbnailTimeout),i((0,f.A)((0,f.A)((0,f.A)((0,f.A)({},x,e.id),"index",e.customdata.index),"thumbnailPath",e.customdata.thumbnailPath),"srcPath",e.customdata.srcPath)),t.loadThumbnailForZarr(e.id,e.customdata.srcPath))})}},{key:"onPointUnhovered",value:function(){var e=this;this.thumbnailTimeout=window.setTimeout(function(){return e.props.changeHoveredPoint(null)},500)}},{key:"onPlotUnhovered",value:function(e){var t=e.relatedTarget,n=this.props.changeHoveredPoint;t.className&&n(null)}},{key:"onGroupSelected",value:function(e){if(e){var t=e.points,n=this.props,r=n.handleLassoOrBoxSelect,a=n.handleSelectionToolUsed;r(Date.now().valueOf().toString(),(0,he.map)((0,he.filter)(t,function(e){return e.data.name===k}),function(e){return{pointIndex:e.customdata.index,cellId:e.id}})),a()}}},{key:"renderPopover",value:function(){var e,t=this.props,n=t.hoveredPointData,r=t.galleryCollapsed,a=Se(t.thumbnailRoot,(null==n?void 0:n.thumbnailPath)||"");return!a&&null!=n&&n.CellId&&(a=null!==(e=this.state.cellIdToZarrThumbnailUrl.get(n.CellId))&&void 0!==e?e:void 0),n&&r&&g.createElement(Ei,{title:n[O]||"",description:n[x].toString(),src:a})}},{key:"render",value:function(){var e=this,t=this.props,n=t.annotations,r=t.plotDataArray,a=t.mousePosition,o=t.xDropDownValue,l=t.yDropDownValue,i=t.yDropDownOptions,c=t.xDropDownOptions,s=t.handleChangeAxis,u=t.yTickConversion,d=t.xTickConversion,f=t.categoricalFeatures,p=t.xAxisRange,m=t.yAxisRange;if(0===r.length)return null;var h=this.renderPopover();return g.createElement(g.Fragment,null,g.createElement(wi,{ref:this.popoverContainer,pageX:a.pageX,pageY:a.pageY},g.createElement(di.A,{placement:"right",content:h,open:!!h,getPopupContainer:function(){return e.popoverContainer.current||document.body},id:"thumbnail-popover"})),g.createElement("div",{id:"main-plot",className:"style__container--UHk47",onMouseLeave:this.onPlotUnhovered},g.createElement(sl,{classKey:E,value:o,options:c,onChange:function(e){s(E,e)},tooltip:Ir(o,c)}),g.createElement("div",{className:"style__glossary-link--A_hFy"},g.createElement("a",{href:"https://www.allencell.org/glossary-of-cell-features-v2.html",target:"_blank",rel:"noreferrer"},g.createElement(fi.A,null)," Open axis glossary")),g.createElement(sl,{classKey:S,value:l,options:i,onChange:function(e){s(S,e)},tooltip:Ir(l,i)}),g.createElement(bi,{plotDataArray:r,onPointClicked:this.onPointClicked,annotations:n,onGroupSelected:this.onGroupSelected,onPointHovered:this.onPointHovered,onPointUnhovered:this.onPointUnhovered,xAxisType:(0,he.includes)(f,o)?"array":"auto",yAxisType:(0,he.includes)(f,l)?"array":"auto",yTickConversion:u,xTickConversion:d,xAxisRange:p,yAxisRange:m})))}}]);var n}(g.Component),ki={changeHoveredPoint:Jr.actions.changeHoveredPoint,handleChangeAxis:Jr.actions.changeAxis,handleDeselectPoint:Jr.actions.deselectPoint,handleLassoOrBoxSelect:Jr.actions.lassoOrBoxSelectGroup,handleSelectPoint:Jr.actions.selectPoint,requestCellFileInfoData:eo.actions.requestCellFileInfoData,requestFeatureData:eo.actions.requestFeatureData,updateMousePosition:Jr.actions.changeMousePosition};const Pi=(0,b.Ng)(function(e){return{annotations:Gl(e),clickedPoints:Jr.selectors.getClickedScatterPoints(e),categoricalFeatures:eo.selectors.getCategoricalFeatureKeys(e),filtersToExclude:Jr.selectors.getFiltersToExclude(e),galleryCollapsed:Jr.selectors.getGalleryCollapsed(e),hoveredPointData:ti(e),mousePosition:Jr.selectors.getMousePosition(e),plotDataArray:ql(e),thumbnailRoot:Jr.selectors.getThumbnailRoot(e),xDropDownOptions:Xl(e),xDropDownValue:Jr.selectors.getPlotByOnX(e),xTickConversion:$l(e),yDropDownOptions:Yl(e),yDropDownValue:Jr.selectors.getPlotByOnY(e),yTickConversion:ei(e),xAxisRange:ri(e),yAxisRange:ai(e)}},ki)(Di);function Oi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Oi=function(){return!!e})()}var xi=W.A.Content,_i=W.A.Sider,Ii=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,Oi()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"state",{defaultActiveKey:[t.panelKeys[0]],openKeys:[t.panelKeys[0]],width:window.innerWidth}),(0,f.A)(e,"onSelectionToolUsed",function(){e.setState({openKeys:(0,he.uniq)([].concat((0,It.A)(e.state.openKeys),[t.panelKeys[1]]))})}),(0,f.A)(e,"onPanelClicked",function(t){e.setState({openKeys:t})}),e}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.state,n=e.openKeys,r=e.defaultActiveKey;return g.createElement(W.A,null,g.createElement(_i,{className:"style__color-menu--BxPlR",width:500,collapsible:!1,collapsedWidth:250},g.createElement(ui,{panelKeys:t.panelKeys,openKeys:n,defaultActiveKey:r,onPanelClicked:this.onPanelClicked})),g.createElement(xi,{className:"style__content--Akt8J"},g.createElement("div",null,g.createElement(Pi,{handleSelectionToolUsed:this.onSelectionToolUsed}))))}}])}(g.Component);(0,f.A)(Ii,"panelKeys",["groupings","selections"]);const Ti=Ii;var Fi=n(40961);const Ni=function(e){var t=e.aligned,n=e.setAligned,r=e.parent;return(0,Fi.createPortal)(g.createElement(g.Fragment,null,g.createElement("span",{className:"viewer-toolbar-group"},g.createElement("span",null,"Alignment"),g.createElement(Fo.A,{title:"For the associated publication, single cell images were aligned before feature extraction. The apical basal axis of the cell (which is the z-axis in the lab frame of reference) was preserved and we aligned the cells by rotation in the xy-plane. Cells and nuclei are rotated such that the longest cell axis falls along the x-axis.",placement:"bottom"},g.createElement(fi.A,null))),g.createElement("span",{className:"viewer-toolbar-group"},g.createElement(ue.Ay.Group,{value:t,onChange:function(e){var t=e.target;return n(t.value)}},g.createElement(Fo.A,{title:"Turn off alignment",placement:"bottom"},g.createElement(ue.Ay.Button,{key:0,value:!1},"Off")),g.createElement(Fo.A,{title:"Turn on alignment",placement:"bottom"},g.createElement(ue.Ay.Button,{key:1,value:!0},"On"))))),r)};function Bi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ji(e,t){var n,r=t.unit,a=t.discrete;return null==e?"".concat(e):a?t.options?"".concat(null===(n=t.options[e.toString()])||void 0===n?void 0:n.name):e.toString():r&&!["unitless","stage"].includes(r)?"".concat(e," ").concat({degrees:"deg"}[r]||r):"".concat(e)}var Mi=(0,Pn.Mz)([Xr,Nn],function(e,t){var n,r={},a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Bi(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bi(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,l=e[o.key];r[o.displayName]=ji(l,o)}}catch(e){a.e(e)}finally{a.f()}return{metadata:r}}),Ri=(0,Pn.Mz)([Kr,Er,Cr,jn,Sr,Mi],function(e,t,n,r,a,o){var l,i;if((0,he.isEmpty)(e))return{};var c=e.CellId,s="",u="",d="",f="";return e.volumeviewerPath?(s=e.volumeviewerPath,d=Ee(n,Ce(e?e.CellId:"")),e.fovVolumeviewerPath&&(u=e.fovVolumeviewerPath,f=Ee(n,we(e?e.FOVId:"")))):(s=e.fovVolumeviewerPath,c=e.FOVId,d=Ee(n,we(e?e.FOVId:""))),""===t||t.endsWith("/")||(t+="/"),{cellId:c,baseUrl:t,cellPath:s,fovPath:u,cellDownloadHref:d,fovDownloadHref:f,transform:a?e.transform:void 0,metadata:o.metadata,viewerChannelSettings:r,appProps:null===(l=e.voleUrlParams)||void 0===l?void 0:l.args,viewerSettings:null===(i=e.voleUrlParams)||void 0===i?void 0:i.viewerSettings}}),Ui=(0,Pn.Mz)([Kr,Pr],function(e,t){var n="",r="";return(0,he.isEmpty)(e)?{cellId:"",label:n,value:r}:{cellId:e.volumeviewerPath?e.CellId:e.FOVId,label:n=t.displayName,value:r=e[O]||""}});const Vi={hidden:"style__hidden--Yt5Mb",content:"style__content--Qbl_8",blur:"style__blur--hXBmU",header:"style__header--sNdkU",alert:"style__alert--etQWL","header-main":"style__header-main--QL9nX",headerMain:"style__header-main--QL9nX","viewer-menu-bar":"style__viewer-menu-bar--kpkWV",viewerMenuBar:"style__viewer-menu-bar--kpkWV","viewer-title-container":"style__viewer-title-container--j1Clp",viewerTitleContainer:"style__viewer-title-container--j1Clp","viewer-title":"style__viewer-title--eb2aw",viewerTitle:"style__viewer-title--eb2aw",label:"style__label--LPNpV",sider:"style__sider--ECAaP","tabbed-menu":"style__tabbed-menu--j4E0E",tabbedMenu:"style__tabbed-menu--j4E0E","plot-icon":"style__plot-icon--D0Ck4",plotIcon:"style__plot-icon--D0Ck4","cube-icon":"style__cube-icon--twFXq",cubeIcon:"style__cube-icon--twFXq"};function zi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(zi=function(){return!!e})()}var Gi=W.A.Content,Li=W.A.Sider,Hi="plot",Ki="3d-viewer",Wi=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,zi()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"alignContainer",document.createElement("span")),(0,f.A)(e,"state",{defaultActiveKey:[t.panelKeys[0]],dontShowSmallScreenWarningAgain:!1,openKeys:[t.panelKeys[0]],width:window.innerWidth,currentTab:Hi,controlPanelCollapsed:!1}),(0,f.A)(e,"componentDidMount",function(){e.props.setShowSmallScreenWarning(window.innerWidth<=768),window.addEventListener("resize",e.updateDimensions)}),(0,f.A)(e,"componentDidUpdate",function(t,n){var r,a=e.state.currentTab;e.props.showAlignControl&&(e.alignContainer.style.setProperty("display","flex"),e.alignContainer.style.setProperty("text-wrap","nowrap"),e.alignContainer.style.setProperty("margin-right","6px"),null===(r=document.querySelector(".viewer-toolbar-left"))||void 0===r||r.prepend(e.alignContainer)),n.currentTab!==a&&a===Ki&&window.dispatchEvent(new Event("resize"))}),(0,f.A)(e,"updateDimensions",function(){if(window.innerWidth!==e.state.width){var t=window.innerWidth<=768&&!e.state.dontShowSmallScreenWarningAgain;e.setState({width:window.innerWidth}),e.props.setShowSmallScreenWarning(t)}}),(0,f.A)(e,"onSelectionToolUsed",function(){e.setState({openKeys:(0,he.uniq)([].concat((0,It.A)(e.state.openKeys),[t.panelKeys[1]]))})}),(0,f.A)(e,"onPanelClicked",function(t){e.setState({openKeys:t})}),(0,f.A)(e,"onControlPanelToggle",function(t){e.setState({controlPanelCollapsed:t})}),(0,f.A)(e,"handleClose",function(){e.props.setShowSmallScreenWarning(!1),e.props.requestFeatureData()}),(0,f.A)(e,"onDismissCheckboxChecked",function(t){e.setState({dontShowSmallScreenWarningAgain:t})}),(0,f.A)(e,"handleTabClick",function(t){e.setState({currentTab:t.key})}),e}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.galleryCollapsed,r=t.toggleGallery,a=t.showSmallScreenWarning,o=t.viewerHeader,l=this.state,i=l.currentTab,c=l.controlPanelCollapsed,s=Z()([Vi.content,(0,f.A)({},Vi.hidden,i!==Ki)]),u=Z()([Vi.content,(0,f.A)({},Vi.hidden,i===Ki)]),d=[{label:g.createElement(g.Fragment,null,g.createElement("span",{className:Z()(["icon-moon","anticon",Vi.plotIcon])}),"Plot"),key:Hi},{label:g.createElement(g.Fragment,null,g.createElement("span",{className:Z()(["icon-moon","anticon",Vi.cubeIcon])}),"3D Viewer"),key:Ki}],p=g.createElement(W.A,null,g.createElement(W.A,{className:n?Vi.noBlur:Vi.blur},g.createElement(wo.Y9,{style:{margin:"0",padding:"0",width:"100%"}},g.createElement("div",{className:c?Z()([Vi.viewerMenuBar,Vi.viewerMenuBarCollapsed]):Vi.viewerMenuBar},g.createElement(X.Ay,{theme:{token:{colorPrimary:"#fff",colorSplit:"transparent"}}},g.createElement(Ao.A,{className:Vi.tabbedMenu,onClick:this.handleTabClick,selectedKeys:[this.state.currentTab],mode:"horizontal",items:d})),g.createElement("div",{className:Vi.viewerTitleContainer},g.createElement("p",{className:Vi.viewerTitle,style:this.state.currentTab!==Ki?{display:"none"}:{}},g.createElement("span",{className:Vi.label},"Viewing cell: "),this.props.viewerHeader.cellId,g.createElement("span",{className:Vi.label},", ",o.label,": "),this.props.viewerHeader.value)))),g.createElement(W.A,null,g.createElement(Do,{handleClose:this.handleClose,onDismissCheckboxChecked:this.onDismissCheckboxChecked,visible:a}),g.createElement(Gi,{className:u},g.createElement(Ti,null)),g.createElement(Gi,{className:s},g.createElement(Eo,(0,ro.A)({onControlPanelToggle:this.onControlPanelToggle},this.props.volumeViewerProps)),this.props.showAlignControl&&g.createElement(Ni,{parent:this.alignContainer,aligned:this.props.alignActive,setAligned:this.props.setAlignActive})))),g.createElement(Li,{style:{right:"0",width:"100px",position:"absolute",backgroundColor:G.galleryBackground},width:"100%",collapsible:!0,collapsed:n,onCollapse:r,defaultCollapsed:!0,collapsedWidth:100,className:Vi.sider,reverseArrow:!0},g.createElement(al,{collapsed:n,toggleGallery:r,openViewerTab:function(){return e.setState({currentTab:Ki})}})));return g.createElement(X.Ay,{theme:{components:{Layout:{headerHeight:56},Checkbox:{colorPrimary:G.mediumDarkGray,colorPrimaryHover:G.mediumGray}}}},p)}}])}(g.Component);(0,f.A)(Wi,"panelKeys",["groupings","selections"]);var qi={toggleGallery:Jr.actions.toggleGallery,setShowSmallScreenWarning:eo.actions.setShowSmallScreenWarning,requestFeatureData:eo.actions.requestFeatureData,setAlignActive:Jr.actions.setAlignActive};const Xi=(0,b.Ng)(function(e){return{galleryCollapsed:Jr.selectors.getGalleryCollapsed(e),volumeViewerProps:Ri(e),thumbnailRoot:Jr.selectors.getThumbnailRoot(e),showSmallScreenWarning:eo.selectors.getShowSmallScreenWarning(e),viewerHeader:Ui(e),showAlignControl:Jr.selectors.getSelected3DCellHasTransform(e),alignActive:Jr.selectors.getAlignActive(e)}},qi)(Wi),Yi=function(e){var t=e.isLoading,n=e.loadingText;return t?g.createElement("div",{className:"style__container--JMiFX"},g.createElement("p",{className:"loading-icon"},ee),g.createElement("p",{className:"loading-text"},n||"Loading data...")):null},Zi="style__is-loading--LzhrV";function Qi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Qi=function(){return!!e})()}var Ji=W.A.Header,$i={algorithm:q.A.darkAlgorithm,token:{colorPrimary:G.purple,colorBgBase:G.darkGray,colorTextHeading:G.white,fontWeightStrong:600,borderRadius:4,borderRadiusSM:4,borderRadiusLG:4,colorLink:G.brightBlue,colorLinkHover:G.linkHover,colorIcon:G.white,colorBgElevated:G.darkGray},components:{Button:{colorPrimary:G.purple,primaryShadow:"0 0px 0 transparent",defaultShadow:"0 0px 0 transparent"},Checkbox:{borderRadiusSM:2},Collapse:{contentBg:G.collapseContentGray,headerBg:G.collapseHeaderGray},Layout:{headerBg:G.headerGray,headerColor:G.white,siderBg:G.collapseContentGray},Modal:{contentBg:G.extraLightGray,headerBg:G.extraLightGray,colorIcon:G.mediumGray},Menu:{colorBgElevated:G.darkGray},Select:{colorTextQuaternary:G.white},Slider:{trackBg:G.lightGray,trackHoverBg:G.extraLightGray,handleColor:G.white,dotActiveBorderColor:G.white,handleActiveColor:G.white,colorPrimaryBorderHover:G.white},Tooltip:{colorBgSpotlight:"rgba(0, 0, 0, 0.85)"}}},ec=function(e){function t(){var e,n,r,a;(0,p.A)(this,t);for(var o=arguments.length,l=new Array(o),i=0;i<o;i++)l[i]=arguments[i];return n=this,r=t,a=[].concat(l),r=(0,H.A)(r),e=(0,L.A)(n,Qi()?Reflect.construct(r,a||[],(0,H.A)(n).constructor):r.apply(n,a)),(0,f.A)(e,"componentDidMount",function(){if("csv"===e.props.selectedDataset)if(e.props.csvUrl)try{Xt(e.props.csvUrl).then(function(t){var n=t.text;return e.props.loadCsvDataset(n)})}catch(t){console.error("Error loading CSV dataset from URL:",t),e.props.changeDataset("")}else e.props.changeDataset("");e.props.requestAvailableDatasets()}),(0,f.A)(e,"handleSelectDataset",function(t){e.props.changeDataset(t)}),e}return(0,K.A)(t,e),(0,m.A)(t,[{key:"render",value:function(){var e=this.props,t=e.isLoading,n=e.loadingText,r=e.selectedDataset,a=e.megasets,o=t&&!!r,l=Z()(["style__container--_3WDP",(0,f.A)({},Zi,o)]);return g.createElement(X.Ay,{theme:$i},g.createElement("div",{className:Z()(["style__wrapper--wsMnE",(0,f.A)({},Zi,o)])},g.createElement(W.A,{className:l},g.createElement(Yi,{isLoading:o,loadingText:n}),g.createElement(Ji,{className:"style__nav-bar--q7jPo"},g.createElement(La,{selectedDataset:r})),g.createElement(W.A,null,r?g.createElement(Xi,null):g.createElement(bo,{megasets:a,handleSelectDataset:this.handleSelectDataset})))))}}])}(g.Component),tc={changeDataset:Jr.actions.changeDataset,requestAvailableDatasets:eo.actions.requestAvailableDatasets,loadCsvDataset:Ma.actions.loadCsvDataset};const nc=(0,b.Ng)(function(e){return{isLoading:eo.selectors.getIsLoading(e),loadingText:eo.selectors.getLoadingText(e),selectedDataset:Jr.selectors.getSelectedDataset(e),megasets:eo.selectors.getMegasetsByNewest(e),csvUrl:Jr.selectors.getCsvUrl(e)}},tc)(ec);var rc=n(14644),ac=n(21852);function oc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function lc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oc(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ic=function(e){var t=e.slice(0,5);return e.length>5&&t.push("...and ".concat(e.length-5," more")),t},cc=function(e){return{indices:ic(e.indices),values:(0,he.mapValues)(e.values,ic),labels:(0,he.mapValues)(e.labels,ic)}},sc=function(e){return e.type===Zt?lc(lc({},e),{},{payload:cc(e.payload)}):e.type===be?lc(lc({},e),{},{payload:e.payload.map(sc)}):e},uc=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;uc?uc({actionSanitizer:sc,stateSanitizer:function(e){return lc(lc({},e),{},{metadata:lc(lc({},e.metadata),{},{featureData:cc(e.metadata.featureData)})})}}):rc.Zz;var dc={metadata:eo.reducer,selection:Jr.reducer,imageDataset:Ma.reducer},fc=[].concat((0,It.A)(eo.logics),(0,It.A)(Jr.logics),(0,It.A)(Ma.logics)),pc={httpClient:xa.A},mc=Object.freeze({metadata:$a,selection:Nt,imageDataset:ja});function hc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function yc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hc(Object(n),!0).forEach(function(t){(0,f.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var gc=function(){return(0,m.A)(function e(t){(0,p.A)(this,e),this.history=t},[{key:"getParams",value:function(){return function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],o=e[a];("string"==typeof o||Array.isArray(o)&&"string"==typeof o[0])&&(t[a]=o)}return t}((0,y.parse)(this.history.location.search,{ignoreQueryPrefix:!0}))}},{key:"pushParams",value:function(e){this.history.push(yc(yc({},this.history.location),{},{search:(0,y.stringify)(e)}))}},{key:"pushParam",value:function(e,t){this.pushParams(yc(yc({},this.getParams()),{},(0,f.A)({},e,t)))}},{key:"replaceParams",value:function(e){this.history.replace(yc(yc({},this.history.location),{},{search:(0,y.stringify)(e)}))}},{key:"onParamRemoved",value:function(e,t){var n=!1;this.history.listen(function(r){(0,y.parse)(r.search,{ignoreQueryPrefix:!0})[e]?n=!0:n&&(t(),n=!1)})}}])}(),vc=new gc((0,h.zR)()),bc=function(e){var t=(0,ac.A)(fc);t.addDeps(pc);var n=(0,rc.Tw)(t),r=function(e,t){return function n(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=arguments.length>1?arguments[1]:void 0;return function(e){return e&&e.batch&&Array.isArray(e.payload)}(a)?a.payload.reduce(n,r):e(r,a)}}((0,rc.HY)(dc),mc);if(e){var a=(0,he.merge)({},mc,e);return(0,rc.y$)(r,a,n)}return(0,rc.y$)(r,n)}({selection:yc(yc({},Nt),Ut.toAppState(vc.getParams()))});bc.dispatch(Jr.actions.syncStateWithURL(vc.getParams())),vc.onParamRemoved("dataset",function(){bc.dispatch(Jr.actions.clearDataset()),bc.dispatch(eo.actions.clearDatasetValues())}),bc.subscribe(function(){var e=bc.getState(),t=Ut.toUrlSearchParameterMap(e.selection),n=vc.getParams();Ut.paramChanged(Rt.dataset,t,n)&&vc.pushParam(Rt.dataset,t.dataset),Ut.paramsChanged(t,n)&&vc.replaceParams(t)});var Ac=document.getElementById(C);null===Ac?console.error("App container (#".concat(C,") missing!")):(0,v.H)(Ac).render(g.createElement(b.Kq,{store:bc},g.createElement(nc,null)))},42634:()=>{},56266:()=>{},56504:()=>{}},e=>{e.O(0,[962,617,681],()=>e(e.s=30626)),e.O()}]);